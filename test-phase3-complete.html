<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phase 3 ì™„ì „ í†µí•© í…ŒìŠ¤íŠ¸</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
            text-align: center;
        }

        .header h1 {
            color: #667eea;
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            font-size: 16px;
        }

        .system-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .status-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .status-card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .status-card .value {
            font-size: 24px;
            font-weight: bold;
        }

        .test-sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .test-section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .test-section h2 {
            color: #667eea;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .test-button {
            width: 100%;
            padding: 15px;
            margin-bottom: 10px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .test-button.secondary {
            background: #6c757d;
        }

        .test-button.success {
            background: #28a745;
        }

        .test-button.danger {
            background: #dc3545;
        }

        .result-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 13px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            line-height: 1.6;
        }

        .log-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 400px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #667eea;
            padding-left: 10px;
        }

        .log-entry.success {
            border-left-color: #28a745;
            color: #4dff88;
        }

        .log-entry.error {
            border-left-color: #dc3545;
            color: #ff6b6b;
        }

        .log-entry.info {
            border-left-color: #17a2b8;
            color: #4fc3f7;
        }

        .character-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .character-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: #667eea;
        }

        .character-btn.selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .input-group {
            margin-bottom: 15px;
        }

        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #333;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-item .label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .stat-item .value {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        .achievement-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            max-width: 300px;
            animation: slideIn 0.5s ease;
            z-index: 1000;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .quick-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .quick-actions button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ® Phase 3 ì™„ì „ í†µí•© í…ŒìŠ¤íŠ¸</h1>
            <p>ëª¨ë“  ì‹œìŠ¤í…œì„ í…ŒìŠ¤íŠ¸í•˜ê³  ê²Œì„ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
        </div>

        <!-- ì‹œìŠ¤í…œ ìƒíƒœ -->
        <div class="system-status" id="systemStatus">
            <!-- ë™ì  ìƒì„± -->
        </div>

        <!-- ìºë¦­í„° ì„ íƒ -->
        <div class="test-section" style="grid-column: 1 / -1;">
            <h2>ğŸ¯ í…ŒìŠ¤íŠ¸í•  ìºë¦­í„° ì„ íƒ</h2>
            <div class="character-selector">
                <button class="character-btn" onclick="selectCharacter('test_enfp')">ENFP ìºë¦­í„°</button>
                <button class="character-btn" onclick="selectCharacter('test_infp')">INFP ìºë¦­í„°</button>
                <button class="character-btn" onclick="selectCharacter('test_intj')">INTJ ìºë¦­í„°</button>
                <button class="character-btn" onclick="createNewCharacter()">+ ìƒˆ ìºë¦­í„° ìƒì„±</button>
            </div>
            <div id="selectedCharacterInfo"></div>
        </div>

        <!-- í…ŒìŠ¤íŠ¸ ì„¹ì…˜ë“¤ -->
        <div class="test-sections">
            <!-- 1. í†µê³„ & ì—…ì  í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ“Š í†µê³„ & ì—…ì  ì‹œìŠ¤í…œ</h2>
                <button class="test-button" onclick="testStatistics()">ğŸ“ˆ í†µê³„ ì¡°íšŒ</button>
                <button class="test-button" onclick="testAchievements()">ğŸ† ì—…ì  ì²´í¬</button>
                <button class="test-button secondary" onclick="simulatePlaySession()">ğŸ® í”Œë ˆì´ ì„¸ì…˜ ì‹œë®¬ë ˆì´ì…˜</button>
                <div id="statsResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- 2. ê°ì • & ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ˜Š ê°ì • & ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ</h2>
                <button class="test-button" onclick="testEmotionSystem()">ğŸ˜Š ê°ì • ìƒíƒœ ì¡°íšŒ</button>
                <button class="test-button" onclick="changeEmotion()">ğŸ­ ê°ì • ë³€ê²½ í…ŒìŠ¤íŠ¸</button>
                <button class="test-button" onclick="checkSpecialEvents()">ğŸ‰ íŠ¹ë³„ ì´ë²¤íŠ¸ ì²´í¬</button>
                <button class="test-button secondary" onclick="triggerRandomEvent()">ğŸ² ëœë¤ ì´ë²¤íŠ¸ ë°œë™</button>
                <div id="emotionResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- 3. ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ§  ëŒ€í™” ê¸°ì–µ ì‹œìŠ¤í…œ</h2>
                <div class="input-group">
                    <label>í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ì…ë ¥</label>
                    <textarea id="testMessage" rows="3" placeholder="ì˜ˆ: ë‚˜ëŠ” ì˜í™” ë³´ëŠ” ê±¸ ì •ë§ ì¢‹ì•„í•´"></textarea>
                </div>
                <button class="test-button" onclick="testMemoryAdd()">ğŸ’¬ ë©”ì‹œì§€ ì¶”ê°€</button>
                <button class="test-button" onclick="testMemorySearch()">ğŸ” ë©”ëª¨ë¦¬ ê²€ìƒ‰</button>
                <button class="test-button" onclick="testMemoryContext()">ğŸ“ AI ì»¨í…ìŠ¤íŠ¸ ìƒì„±</button>
                <div id="memoryResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- 4. ì—”ë”© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ ì—”ë”© ì‹œìŠ¤í…œ</h2>
                <div class="input-group">
                    <label>í˜¸ê°ë„ ì„¤ì • (-100 ~ 100)</label>
                    <input type="number" id="affectionInput" min="-100" max="100" value="0">
                </div>
                <button class="test-button" onclick="setAffection()">ğŸ’• í˜¸ê°ë„ ì„¤ì •</button>
                <button class="test-button" onclick="checkEnding()">ğŸ ì—”ë”© ì¡°ê±´ ì²´í¬</button>
                <button class="test-button success" onclick="testTrueEnding()">ğŸ’– íŠ¸ë£¨ ì—”ë”© ì‹œë®¬ë ˆì´ì…˜</button>
                <div id="endingResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- 5. í†µí•© ê´€ë¦¬ì í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ® í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
                <button class="test-button" onclick="testIntegration()">ğŸ”„ í†µí•© ì´ë²¤íŠ¸ ì²˜ë¦¬</button>
                <button class="test-button" onclick="testFullGameState()">ğŸ“Š ì „ì²´ ê²Œì„ ìƒíƒœ</button>
                <button class="test-button" onclick="testPerformance()">âš¡ ì„±ëŠ¥ ë©”íŠ¸ë¦­</button>
                <button class="test-button danger" onclick="testSystemHealth()">ğŸ¥ ì‹œìŠ¤í…œ í—¬ìŠ¤ ì²´í¬</button>
                <div id="integrationResult" class="result-box" style="display: none;"></div>
            </div>

            <!-- 6. ì¢…í•© ì‹œë‚˜ë¦¬ì˜¤ í…ŒìŠ¤íŠ¸ -->
            <div class="test-section">
                <h2>ğŸ¬ ì¢…í•© ì‹œë‚˜ë¦¬ì˜¤</h2>
                <button class="test-button" onclick="runFullScenario()">ğŸ¯ ì™„ì „í•œ ê²Œì„ í”Œë¡œìš°</button>
                <button class="test-button secondary" onclick="runSpeedrunScenario()">âš¡ ìŠ¤í”¼ë“œëŸ° ì‹œë‚˜ë¦¬ì˜¤</button>
                <button class="test-button secondary" onclick="runBadEndingScenario()">ğŸ’” ë°°ë“œì—”ë”© ì‹œë‚˜ë¦¬ì˜¤</button>
                <div id="scenarioResult" class="result-box" style="display: none;"></div>
            </div>
        </div>

        <!-- ì‹¤ì‹œê°„ ë¡œê·¸ -->
        <div class="test-section" style="margin-top: 20px;">
            <h2>ğŸ“ ì‹¤ì‹œê°„ ì‹œìŠ¤í…œ ë¡œê·¸</h2>
            <div class="quick-actions">
                <button onclick="clearLog()">ğŸ—‘ï¸ ë¡œê·¸ ì§€ìš°ê¸°</button>
                <button onclick="exportLog()">ğŸ’¾ ë¡œê·¸ ì €ì¥</button>
            </div>
            <div id="systemLog" class="log-box"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="js/multi-character-state.js"></script>
    <script src="js/statistics-manager.js"></script>
    <script src="js/achievement-system.js"></script>
    <script src="js/emotion-state-system.js"></script>
    <script src="js/special-event-system.js"></script>
    <script src="js/conversation-memory-system.js"></script>
    <script src="js/memory-keywords.js"></script>
    <script src="js/ending-system.js"></script>
    <script src="js/game-integration-manager.js"></script>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let multiCharacterState;
        let selectedCharacterId = null;

        // ì´ˆê¸°í™”
        window.onload = function() {
            log('ğŸ® Phase 3 í†µí•© í…ŒìŠ¤íŠ¸ ì‹œì‘', 'info');

            // MultiCharacterState ì´ˆê¸°í™”
            multiCharacterState = new MultiCharacterState();

            // ì‹œìŠ¤í…œ ìƒíƒœ í‘œì‹œ
            updateSystemStatus();

            log('âœ… ëª¨ë“  ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ', 'success');
        };

        // ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateSystemStatus() {
            const systems = {
                'StatisticsManager': !!multiCharacterState.statisticsManager,
                'AchievementSystem': !!multiCharacterState.achievementSystem,
                'EmotionSystem': Object.keys(multiCharacterState.emotionSystems).length > 0,
                'EventSystem': Object.keys(multiCharacterState.eventSystems).length > 0,
                'MemorySystem': Object.keys(multiCharacterState.memorySystems).length > 0,
                'EndingManager': !!multiCharacterState.endingManager,
                'IntegrationManager': !!multiCharacterState.integrationManager
            };

            const statusHtml = Object.entries(systems).map(([name, active]) => `
                <div class="status-card ${active ? 'active' : ''}">
                    <h3>${name}</h3>
                    <div class="value">${active ? 'âœ… í™œì„±' : 'âŒ ë¹„í™œì„±'}</div>
                </div>
            `).join('');

            document.getElementById('systemStatus').innerHTML = statusHtml;
        }

        // ìºë¦­í„° ì„ íƒ
        function selectCharacter(characterId) {
            selectedCharacterId = characterId;

            // ìºë¦­í„°ê°€ ì—†ìœ¼ë©´ ìƒì„±
            if (!multiCharacterState.getState(characterId)) {
                const mbtiType = characterId.includes('enfp') ? 'ENFP' :
                               characterId.includes('infp') ? 'INFP' : 'INTJ';
                multiCharacterState.createState(characterId, mbtiType);
                log(`ìƒˆ ìºë¦­í„° ìƒì„±: ${characterId} (${mbtiType})`, 'success');
            }

            // UI ì—…ë°ì´íŠ¸
            document.querySelectorAll('.character-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');

            // ìºë¦­í„° ì •ë³´ í‘œì‹œ
            const state = multiCharacterState.getState(characterId);
            document.getElementById('selectedCharacterInfo').innerHTML = `
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="label">í˜¸ê°ë„</div>
                        <div class="value">${state.affection}</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">ë©”ì‹œì§€ ìˆ˜</div>
                        <div class="value">${state.messageCount}</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">ê´€ê³„ ë‹¨ê³„</div>
                        <div class="value">${state.relationshipStage}</div>
                    </div>
                    <div class="stat-item">
                        <div class="label">MBTI</div>
                        <div class="value">${state.mbtiType || 'ENFP'}</div>
                    </div>
                </div>
            `;

            log(`ìºë¦­í„° ì„ íƒ: ${characterId}`, 'info');
        }

        // ìƒˆ ìºë¦­í„° ìƒì„±
        function createNewCharacter() {
            const id = `test_${Date.now()}`;
            const mbti = prompt('MBTI íƒ€ì…ì„ ì…ë ¥í•˜ì„¸ìš” (ENFP, INFP, INTJ ë“±):', 'ENFP');
            if (mbti) {
                multiCharacterState.createState(id, mbti.toUpperCase());
                log(`ìƒˆ ìºë¦­í„° ìƒì„±: ${id} (${mbti})`, 'success');
                alert(`ìºë¦­í„° ìƒì„± ì™„ë£Œ: ${id}`);
            }
        }

        // 1. í†µê³„ í…ŒìŠ¤íŠ¸
        function testStatistics() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const stats = multiCharacterState.statisticsManager.getCharacterStats(selectedCharacterId);
            showResult('statsResult', JSON.stringify(stats, null, 2));
            log('í†µê³„ ì¡°íšŒ ì™„ë£Œ', 'success');
        }

        function testAchievements() {
            if (!multiCharacterState.achievementSystem) {
                alert('AchievementSystemì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            multiCharacterState.achievementSystem.checkAllAchievements();
            const achievements = multiCharacterState.achievementSystem.getAchievementStats();
            showResult('statsResult', JSON.stringify(achievements, null, 2));
            log('ì—…ì  ì²´í¬ ì™„ë£Œ', 'success');
        }

        function simulatePlaySession() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            log('í”Œë ˆì´ ì„¸ì…˜ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...', 'info');

            // ì„¸ì…˜ ì‹œì‘
            multiCharacterState.startSession();

            // 10ë²ˆ ë©”ì‹œì§€ ì‹œë®¬ë ˆì´ì…˜
            for (let i = 0; i < 10; i++) {
                multiCharacterState.notifyUserResponse(
                    selectedCharacterId,
                    `í…ŒìŠ¤íŠ¸ ë©”ì‹œì§€ ${i + 1}`,
                    { affectionChange: Math.random() > 0.5 ? 2 : -1 }
                );
                multiCharacterState.notifyCharacterMessage(
                    selectedCharacterId,
                    `ì‘ë‹µ ë©”ì‹œì§€ ${i + 1}`
                );
            }

            // ì„¸ì…˜ ì¢…ë£Œ
            multiCharacterState.endSession(selectedCharacterId);

            const stats = multiCharacterState.statisticsManager.getCharacterStats(selectedCharacterId);
            showResult('statsResult', `ì„¸ì…˜ ì™„ë£Œ!\n\n${JSON.stringify(stats, null, 2)}`);
            log('í”Œë ˆì´ ì„¸ì…˜ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ', 'success');
        }

        // 2. ê°ì • & ì´ë²¤íŠ¸ í…ŒìŠ¤íŠ¸
        function testEmotionSystem() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const emotionSystem = multiCharacterState.getEmotionSystem(selectedCharacterId);
            if (!emotionSystem) {
                showResult('emotionResult', 'ê°ì • ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const state = emotionSystem.getState();
            showResult('emotionResult', JSON.stringify(state, null, 2));
            log('ê°ì • ìƒíƒœ ì¡°íšŒ ì™„ë£Œ', 'success');
        }

        function changeEmotion() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const emotions = ['happy', 'excited', 'calm', 'sad', 'anxious', 'angry'];
            const emotion = emotions[Math.floor(Math.random() * emotions.length)];
            const intensity = Math.random();

            const emotionSystem = multiCharacterState.getEmotionSystem(selectedCharacterId);
            if (emotionSystem) {
                emotionSystem.changeEmotion(emotion, intensity, 'test');
                showResult('emotionResult', `ê°ì • ë³€ê²½: ${emotion} (ê°•ë„: ${intensity.toFixed(2)})`);
                log(`ê°ì • ë³€ê²½: ${emotion}`, 'success');
            }
        }

        function checkSpecialEvents() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const eventSystem = multiCharacterState.getEventSystem(selectedCharacterId);
            if (!eventSystem) {
                showResult('emotionResult', 'ì´ë²¤íŠ¸ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const event = eventSystem.checkAllEvents();
            if (event) {
                showResult('emotionResult', `íŠ¹ë³„ ì´ë²¤íŠ¸ ë°œìƒ!\n\n${JSON.stringify(event, null, 2)}`);
                log(`íŠ¹ë³„ ì´ë²¤íŠ¸: ${event.name}`, 'success');
            } else {
                showResult('emotionResult', 'ë°œë™ ê°€ëŠ¥í•œ ì´ë²¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
                log('ì´ë²¤íŠ¸ ì—†ìŒ', 'info');
            }
        }

        function triggerRandomEvent() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            // í˜¸ê°ë„ë¥¼ ëœë¤í•˜ê²Œ ì„¤ì •
            const randomAffection = Math.floor(Math.random() * 100);
            multiCharacterState.changeAffection(selectedCharacterId, randomAffection);

            checkSpecialEvents();
        }

        // 3. ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        function testMemoryAdd() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const message = document.getElementById('testMessage').value;
            if (!message) {
                alert('ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”!');
                return;
            }

            multiCharacterState.notifyUserResponse(
                selectedCharacterId,
                message,
                { affectionChange: 2 }
            );

            const memorySystem = multiCharacterState.getMemorySystem(selectedCharacterId);
            const stats = memorySystem.getStats();
            showResult('memoryResult', `ë©”ì‹œì§€ ì¶”ê°€ ì™„ë£Œ!\n\n${JSON.stringify(stats, null, 2)}`);
            log('ë©”ëª¨ë¦¬ì— ë©”ì‹œì§€ ì¶”ê°€', 'success');
        }

        function testMemorySearch() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const query = document.getElementById('testMessage').value || 'ì¢‹ì•„';
            const memorySystem = multiCharacterState.getMemorySystem(selectedCharacterId);

            if (!memorySystem) {
                showResult('memoryResult', 'ë©”ëª¨ë¦¬ ì‹œìŠ¤í…œì´ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const results = memorySystem.searchMemory(query, 5);
            showResult('memoryResult', `ê²€ìƒ‰ ê²°ê³¼ (${query}):\n\n${JSON.stringify(results, null, 2)}`);
            log(`ë©”ëª¨ë¦¬ ê²€ìƒ‰: ${query}`, 'success');
        }

        function testMemoryContext() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const context = multiCharacterState.generateMemoryContext(selectedCharacterId);
            showResult('memoryResult', JSON.stringify(context, null, 2));
            log('AI ì»¨í…ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ', 'success');
        }

        // 4. ì—”ë”© ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸
        function setAffection() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const value = parseInt(document.getElementById('affectionInput').value);
            const state = multiCharacterState.getState(selectedCharacterId);
            const delta = value - state.affection;

            multiCharacterState.changeAffection(selectedCharacterId, delta);
            showResult('endingResult', `í˜¸ê°ë„ ì„¤ì • ì™„ë£Œ: ${state.affection} â†’ ${value}`);
            log(`í˜¸ê°ë„ ë³€ê²½: ${delta > 0 ? '+' : ''}${delta}`, 'success');

            // ìºë¦­í„° ì •ë³´ ì—…ë°ì´íŠ¸
            selectCharacter(selectedCharacterId);
        }

        function checkEnding() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const ending = multiCharacterState.checkEndingConditions(selectedCharacterId);

            if (ending) {
                showResult('endingResult', `ë‹¬ì„± ê°€ëŠ¥í•œ ì—”ë”©:\n\n${JSON.stringify(ending, null, 2)}`);
                log(`ì—”ë”© ë°œê²¬: ${ending.name}`, 'success');
            } else {
                showResult('endingResult', 'ì•„ì§ ë‹¬ì„± ê°€ëŠ¥í•œ ì—”ë”©ì´ ì—†ìŠµë‹ˆë‹¤.\n\në” ë§ì€ ëŒ€í™”ì™€ í˜¸ê°ë„ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                log('ì—”ë”© ì¡°ê±´ ë¯¸ë‹¬', 'info');
            }
        }

        function testTrueEnding() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            log('íŠ¸ë£¨ ì—”ë”© ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘...', 'info');

            // í˜¸ê°ë„ 95ë¡œ ì„¤ì •
            const state = multiCharacterState.getState(selectedCharacterId);
            multiCharacterState.changeAffection(selectedCharacterId, 95 - state.affection);

            // ë©”ì‹œì§€ 100ê°œ ì‹œë®¬ë ˆì´ì…˜
            for (let i = 0; i < 100; i++) {
                state.messageCount++;
            }

            // ì—°ì† 14ì¼ ì„¤ì •
            if (multiCharacterState.statisticsManager) {
                const stats = multiCharacterState.statisticsManager.getCharacterStats(selectedCharacterId);
                // ì„ì‹œë¡œ í†µê³„ ìˆ˜ì • (ì‹¤ì œë¡œëŠ” 14ì¼ í”Œë ˆì´ í•„ìš”)
            }

            // ì—”ë”© ì²´í¬
            const ending = multiCharacterState.checkEndingConditions(selectedCharacterId);

            if (ending) {
                const result = multiCharacterState.triggerEnding(selectedCharacterId, ending);
                showResult('endingResult', `ğŸ‰ ì—”ë”© ë‹¬ì„±!\n\n${JSON.stringify(result, null, 2)}`);
                log(`ì—”ë”© ë‹¬ì„±: ${ending.name}`, 'success');
            } else {
                showResult('endingResult', 'ì—”ë”© ì¡°ê±´ì„ ë§Œì¡±í•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // 5. í†µí•© ê´€ë¦¬ì í…ŒìŠ¤íŠ¸
        function testIntegration() {
            if (!selectedCharacterId || !multiCharacterState.integrationManager) {
                alert('ìºë¦­í„°ë¥¼ ì„ íƒí•˜ê³  í†µí•© ê´€ë¦¬ìë¥¼ í™•ì¸í•˜ì„¸ìš”!');
                return;
            }

            // í†µí•© ì´ë²¤íŠ¸ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸
            multiCharacterState.integrationManager.onAffectionChange(
                selectedCharacterId,
                5,
                'ENFP',
                { test: true }
            );

            const report = multiCharacterState.integrationManager.getPerformanceReport();
            showResult('integrationResult', JSON.stringify(report, null, 2));
            log('í†µí•© ì´ë²¤íŠ¸ ì²˜ë¦¬ ì™„ë£Œ', 'success');
        }

        function testFullGameState() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            const fullState = multiCharacterState.getFullGameState(selectedCharacterId);
            showResult('integrationResult', JSON.stringify(fullState, null, 2));
            log('ì „ì²´ ê²Œì„ ìƒíƒœ ì¡°íšŒ ì™„ë£Œ', 'success');
        }

        function testPerformance() {
            if (!multiCharacterState.integrationManager) {
                alert('í†µí•© ê´€ë¦¬ìê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const report = multiCharacterState.integrationManager.getPerformanceReport();
            showResult('integrationResult', JSON.stringify(report, null, 2));
            log('ì„±ëŠ¥ ë©”íŠ¸ë¦­ ì¡°íšŒ ì™„ë£Œ', 'success');
        }

        function testSystemHealth() {
            if (!multiCharacterState.integrationManager) {
                alert('í†µí•© ê´€ë¦¬ìê°€ ì´ˆê¸°í™”ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                return;
            }

            const health = multiCharacterState.integrationManager.checkSystemHealth();
            showResult('integrationResult', JSON.stringify(health, null, 2));

            if (health.healthy) {
                log('ì‹œìŠ¤í…œ ì •ìƒ âœ…', 'success');
            } else {
                log('ì‹œìŠ¤í…œ ë¬¸ì œ ë°œê²¬ âš ï¸', 'error');
            }
        }

        // 6. ì¢…í•© ì‹œë‚˜ë¦¬ì˜¤
        function runFullScenario() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            log('=== ì™„ì „í•œ ê²Œì„ í”Œë¡œìš° ì‹œì‘ ===', 'info');
            let result = '';

            // 1ë‹¨ê³„: ì²« ë§Œë‚¨
            result += '1ï¸âƒ£ ì²« ë§Œë‚¨\n';
            multiCharacterState.notifyUserResponse(selectedCharacterId, 'ì•ˆë…•í•˜ì„¸ìš”!', {});
            multiCharacterState.changeAffection(selectedCharacterId, 5);
            result += `   í˜¸ê°ë„: ${multiCharacterState.getState(selectedCharacterId).affection}\n\n`;

            // 2ë‹¨ê³„: ëŒ€í™” ì§„í–‰
            result += '2ï¸âƒ£ ëŒ€í™” ì§„í–‰ (20íšŒ)\n';
            for (let i = 0; i < 20; i++) {
                multiCharacterState.notifyUserResponse(
                    selectedCharacterId,
                    `ëŒ€í™” ${i + 1}`,
                    { affectionChange: Math.random() > 0.3 ? 2 : -1 }
                );
            }
            result += `   í˜¸ê°ë„: ${multiCharacterState.getState(selectedCharacterId).affection}\n\n`;

            // 3ë‹¨ê³„: ê°ì • ë³€í™”
            result += '3ï¸âƒ£ ê°ì • ë³€í™”\n';
            const emotionSystem = multiCharacterState.getEmotionSystem(selectedCharacterId);
            if (emotionSystem) {
                emotionSystem.changeEmotion('happy', 0.8, 'conversation');
                result += `   í˜„ì¬ ê°ì •: ${emotionSystem.getState().currentEmotion}\n\n`;
            }

            // 4ë‹¨ê³„: íŠ¹ë³„ ì´ë²¤íŠ¸
            result += '4ï¸âƒ£ íŠ¹ë³„ ì´ë²¤íŠ¸ ì²´í¬\n';
            const event = multiCharacterState.getEventSystem(selectedCharacterId)?.checkAllEvents();
            result += event ? `   ë°œìƒ: ${event.name}\n\n` : '   ì—†ìŒ\n\n';

            // 5ë‹¨ê³„: ì—…ì  ì²´í¬
            result += '5ï¸âƒ£ ì—…ì  ì²´í¬\n';
            multiCharacterState.achievementSystem?.checkAllAchievements();
            const achievements = multiCharacterState.achievementSystem?.getAchievementStats();
            result += `   í•´ì œëœ ì—…ì : ${achievements?.unlockedCount || 0}ê°œ\n\n`;

            // 6ë‹¨ê³„: ì—”ë”© ì¡°ê±´
            result += '6ï¸âƒ£ ì—”ë”© ì¡°ê±´ ì²´í¬\n';
            const ending = multiCharacterState.checkEndingConditions(selectedCharacterId);
            result += ending ? `   ë‹¬ì„± ê°€ëŠ¥: ${ending.name}\n` : '   ì•„ì§ ì—†ìŒ\n';

            showResult('scenarioResult', result);
            log('ì™„ì „í•œ ê²Œì„ í”Œë¡œìš° ì™„ë£Œ', 'success');
        }

        function runSpeedrunScenario() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            log('=== ìŠ¤í”¼ë“œëŸ° ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘ ===', 'info');

            // ë¹ ë¥´ê²Œ í˜¸ê°ë„ 80 ë‹¬ì„±
            multiCharacterState.changeAffection(selectedCharacterId, 80);

            // 30ê°œ ë©”ì‹œì§€
            const state = multiCharacterState.getState(selectedCharacterId);
            state.messageCount = 30;

            // ì—”ë”© ì²´í¬
            const ending = multiCharacterState.checkEndingConditions(selectedCharacterId);

            let result = 'âš¡ ìŠ¤í”¼ë“œëŸ° ê²°ê³¼\n\n';
            result += `í˜¸ê°ë„: ${state.affection}\n`;
            result += `ë©”ì‹œì§€: ${state.messageCount}\n`;
            result += `ê²½ê³¼ ì‹œê°„: 3ì¼ ë¯¸ë§Œ\n\n`;
            result += ending ? `ì—”ë”©: ${ending.name}` : 'ì—”ë”© ì—†ìŒ';

            showResult('scenarioResult', result);
            log('ìŠ¤í”¼ë“œëŸ° ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ', 'success');
        }

        function runBadEndingScenario() {
            if (!selectedCharacterId) {
                alert('ìºë¦­í„°ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”!');
                return;
            }

            log('=== ë°°ë“œì—”ë”© ì‹œë‚˜ë¦¬ì˜¤ ì‹œì‘ ===', 'info');

            // í˜¸ê°ë„ -50ìœ¼ë¡œ í•˜ë½
            const state = multiCharacterState.getState(selectedCharacterId);
            multiCharacterState.changeAffection(selectedCharacterId, -50 - state.affection);

            // 20ê°œ ë©”ì‹œì§€
            state.messageCount = 20;

            // ì—”ë”© ì²´í¬
            const ending = multiCharacterState.checkEndingConditions(selectedCharacterId);

            let result = 'ğŸ’” ë°°ë“œì—”ë”© ê²°ê³¼\n\n';
            result += `í˜¸ê°ë„: ${state.affection}\n`;
            result += `ë©”ì‹œì§€: ${state.messageCount}\n\n`;
            result += ending ? `ì—”ë”©: ${ending.name}\n\n${ending.description}` : 'ì—”ë”© ì—†ìŒ';

            showResult('scenarioResult', result);
            log('ë°°ë“œì—”ë”© ì‹œë‚˜ë¦¬ì˜¤ ì™„ë£Œ', 'success');
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
        function showResult(elementId, content) {
            const element = document.getElementById(elementId);
            element.textContent = content;
            element.style.display = 'block';
        }

        function log(message, type = 'info') {
            const logBox = document.getElementById('systemLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            logBox.insertBefore(entry, logBox.firstChild);

            // ì½˜ì†”ì—ë„ ì¶œë ¥
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        function clearLog() {
            document.getElementById('systemLog').innerHTML = '';
            log('ë¡œê·¸ ì´ˆê¸°í™” ì™„ë£Œ', 'info');
        }

        function exportLog() {
            const logBox = document.getElementById('systemLog');
            const text = logBox.textContent;
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `phase3-test-log-${Date.now()}.txt`;
            a.click();
            log('ë¡œê·¸ íŒŒì¼ ì €ì¥ ì™„ë£Œ', 'success');
        }
    </script>
</body>
</html>
