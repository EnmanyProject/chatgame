# 📌 현재 작업 가이드 (MASTER)

**최종 업데이트**: 2025-10-09 오후
**현재 Phase**: 에피소드 관리 시스템 완성

---

## 🎯 현재 상태

**작업**: 에피소드 관리 시스템 완전 구현 - 생성/삭제/상세보기 완료 ✅
**버전**: v1.19.5
**상태**: 완료
**다음**: 사용자 요청 대기

---

## ✅ 최근 완료 작업 (2025-10-09)

### 🎯 오후 작업: 에피소드 관리 시스템 완성 (v1.19.2 → v1.19.5)

**총 4개 버전 업데이트** - 에피소드 시스템 완전 구현

#### 핵심 기능 완성
1. **504 타임아웃 에러 처리** (v1.19.2)
   - OpenAI API 10초 초과 시 명확한 에러 메시지
   - 해결 방법 안내 (짧음 선택, gpt-3.5-turbo 사용)
   - JSON 파싱 에러 방지

2. **dialogue_flow 완전 표시** (v1.19.3)
   - 4가지 대화 타입 색상 구분 (narration, character_dialogue, multiple_choice, free_input)
   - 호감도/친밀도 변화량 표시
   - AI 평가 기준 상세 표시
   - 에피소드 통계 표시

3. **에피소드 삭제 오류 수정** (v1.19.4)
   - DELETE 요청 400 Bad Request 해결
   - RESTful API 표준 준수 (쿼리 파라미터)

4. **상세보기 기능 연결** (v1.19.5)
   - stub 함수 → 실제 기능 구현
   - API 통합 및 실시간 데이터 로드
   - 메타데이터 및 상태 라벨 표시

---

### 🚀 오전 작업: 시나리오 생성 시스템 (v1.13.1 → v1.19.1)

**총 10개 버전 업데이트** - 시나리오 생성 시스템 대폭 강화

#### 핵심 기능 추가
1. **분위기 조절 시스템** (v1.14.0)
   - 3단계: 가벼움(light) / 보통(balanced) / 진지함(serious)
   - temperature 자동 조정 (0.7 ~ 0.9)
   - 분위기별 프롬프트 자동 적용

2. **AI 프롬프트 어드민 편집** (v1.16.0)
   - 실시간 프롬프트 수정 및 저장
   - ai-prompts.json 즉시 반영
   - 시나리오 생성에 바로 적용

3. **시간 개념 확장** (v1.17.0)
   - 과거/현재/미래 모두 지원
   - 예: "어제 키스했다" / "지금 데이트 중" / "내일 고백할 예정"
   - 기승전결 구조 상세화 (2-3문장)

4. **섹시 레벨 반영** (v1.18.0)
   - 5단계 자동 프롬프트 조정 (1-2: 순수 ~ 9-10: 매우 관능)
   - AI 생성 시 자동 적용

5. **메신저 대화 중심 전환** (v1.19.0)
   - 소설풍 → 단막극 스타일
   - 400-600자 짧은 배경 스토리
   - 일상 소재 강조

6. **AI 생성 스토리 편집** (v1.19.1)
   - readonly → 편집 가능
   - 생성 후 자유롭게 수정 가능
   - 저장 시 자동 반영

#### 버그 수정
- v1.13.1: 시나리오 생성 null 체크 오류 해결
- v1.14.1: 로그인 401 에러 로그 개선
- v1.15.0: 시나리오 생성 정확도 개선 (제목/설명 무시 문제 해결)
- v1.17.1: JSON 파싱 오류 수정

#### 데이터 작업
- 캐릭터 6개 업데이트 (시은_istp, 미나_isfp 등)
- 시나리오 6개 업데이트
- 사진 5개 추가

---

## 📋 시나리오 관리 시스템 현황

### 완료된 기능 ✅
1. **시나리오 CRUD**: 생성/수정/삭제/조회 완전 구현
2. **AI 자동 생성**: 기승전결 구조 + 장문 스토리 자동 생성
3. **분위기 조절**: 3단계 시스템 (가벼움/보통/진지함)
4. **AI 프롬프트 편집**: 어드민에서 실시간 수정 가능
5. **시간 개념**: 과거/현재/미래 모두 지원
6. **섹시 레벨**: 5단계 자동 프롬프트 반영
7. **GitHub API 통합**: 모든 데이터 GitHub 저장소에 영구 저장
8. **캐시 문제 해결**: 즉시 로컬 업데이트 + 지연 동기화

### 시스템 구조
```
시나리오 생성 워크플로우:
1. 제목/설명/메타데이터 입력
   - 장르 선택 (15개 감정 기반)
   - 섹시 레벨 선택 (1-10)
   - 분위기 선택 (가벼움/보통/진지함)

2. 🤖 AI 자동 생성 클릭
   → 기승전결 구조 생성 (OpenAI)
   → 장문 스토리 생성 (400-600자, 메신저 대화 배경)
   → 생성된 스토리 편집 가능

3. 저장 → GitHub API로 영구 저장
```

### 주요 파일
- `scenario-admin.html`: 통합 관리 시스템 (v1.19.5)
- `api/scenario-manager.js`: 시나리오 API
- `data/ai-prompts.json`: AI 프롬프트 설정 (v1.6.0)
- `data/scenarios/scenario-database.json`: 시나리오 DB
- `data/characters.json`: 캐릭터 DB

---

## 🎬 에피소드 관리 시스템 현황

### 완료된 기능 ✅
1. **에피소드 AI 생성**: OpenAI 기반 dialogue_flow 자동 생성
2. **에피소드 CRUD**: 생성/수정/삭제/조회 완전 구현
3. **dialogue_flow 표시**: 4가지 대화 타입 색상 구분 시스템
4. **시나리오 연동**: 시나리오 선택 시 상세 정보 미리보기
5. **상세보기 모달**: 에피소드 전체 내용 및 통계 표시
6. **호감도/친밀도 시스템**: 선택지별 변화량 표시
7. **AI 평가 기준**: 주관식 입력 평가 기준 상세 표시
8. **GitHub API 통합**: 캐릭터별 에피소드 파일 관리

### 시스템 구조
```
에피소드 생성 워크플로우:
1. 캐릭터 선택
2. 시나리오 템플릿 선택
   - 시나리오 상세 정보 미리보기
3. 생성 컨텍스트 설정
   - 기본 호감도/친밀도
   - 시나리오 길이 (짧음/보통/김)
   - AI 모델 선택
4. 🤖 AI 자동 생성 클릭
   → dialogue_flow 생성 (3-5개 대화)
   → 4가지 타입: narration, character_dialogue, multiple_choice, free_input
5. 저장 → GitHub API로 캐릭터별 에피소드 파일에 저장
```

### dialogue_flow 구조
- **narration** (노란색): 상황 설명
- **character_dialogue** (파란색): 캐릭터 대사 + 감정 + 나레이션
- **multiple_choice** (보라색): 객관식 선택지 + 호감도/친밀도 변화
- **free_input** (초록색): 주관식 입력 + AI 평가 기준

### 주요 파일
- `scenario-admin.html`: 에피소드 관리 탭 (v1.19.5)
- `api/episode-manager.js`: 에피소드 API (v2.1.0)
- `data/episodes/`: 캐릭터별 에피소드 파일 (`{character_id}_episodes.json`)

---

## 🚨 작업 규칙

### 1. 버전 업데이트 필수 체크리스트
```bash
# scenario-admin.html 수정 시 무조건 실행
1. 버전 번호 업데이트 (Line 4560)
   <span id="systemVersion">v1.x.x</span>

2. Git 커밋 및 푸시
   git add -A
   git commit -m "v1.x.x: [변경 내용]"
   git push origin main

3. CLAUDE.md 히스토리 추가

4. 테스트 URL 안내
   https://chatgame-seven.vercel.app/scenario-admin.html
```

### 2. 문서 동기화
- **PROJECT.md**: 큰 변화 시에만 수정
- **MASTER.md** (이 파일): 매 작업마다 업데이트
- **CLAUDE.md**: 버전 히스토리 추가 (append only)

---

## 🔗 중요 링크

- **배포**: https://chatgame-seven.vercel.app
- **어드민**: https://chatgame-seven.vercel.app/scenario-admin.html (비번: a6979)
- **Git**: https://github.com/EnmanyProject/chatgame

---

**작성일**: 2025-10-09
**용도**: 현재 작업 상태 및 완료 내역 추적
