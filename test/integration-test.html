<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Phase 1 í†µí•© í…ŒìŠ¤íŠ¸</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background-color: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      color: #3a5068;
      margin-bottom: 10px;
    }

    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }

    .test-controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: bold;
      transition: all 0.2s;
    }

    .btn-primary {
      background-color: #3a5068;
      color: white;
    }

    .btn-primary:hover {
      background-color: #2a3f52;
    }

    .btn-success {
      background-color: #28a745;
      color: white;
    }

    .btn-danger {
      background-color: #dc3545;
      color: white;
    }

    .btn-warning {
      background-color: #ffc107;
      color: #333;
    }

    .test-scenario {
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      transition: all 0.3s;
    }

    .test-scenario.running {
      border-color: #ffc107;
      background-color: #fff9e6;
    }

    .test-scenario.passed {
      border-color: #28a745;
      background-color: #e6f9ea;
    }

    .test-scenario.failed {
      border-color: #dc3545;
      background-color: #fce8e8;
    }

    .scenario-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .scenario-title {
      font-size: 18px;
      font-weight: bold;
      color: #333;
    }

    .scenario-status {
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-pending {
      background-color: #e0e0e0;
      color: #666;
    }

    .status-running {
      background-color: #ffc107;
      color: #333;
    }

    .status-passed {
      background-color: #28a745;
      color: white;
    }

    .status-failed {
      background-color: #dc3545;
      color: white;
    }

    .scenario-description {
      color: #666;
      margin-bottom: 15px;
    }

    .test-steps {
      margin-top: 10px;
    }

    .test-step {
      padding: 10px;
      margin-bottom: 5px;
      background-color: #f8f9fa;
      border-radius: 5px;
      font-size: 14px;
    }

    .test-step.passed {
      background-color: #d4edda;
      color: #155724;
    }

    .test-step.failed {
      background-color: #f8d7da;
      color: #721c24;
    }

    .test-step.running {
      background-color: #fff3cd;
      color: #856404;
    }

    .test-results {
      margin-top: 30px;
      padding: 20px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    .result-summary {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }

    .result-item {
      text-align: center;
    }

    .result-number {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .result-label {
      color: #666;
      font-size: 14px;
    }

    .progress-bar {
      width: 100%;
      height: 30px;
      background-color: #e0e0e0;
      border-radius: 15px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #28a745, #20c997);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
    }

    .console-output {
      background-color: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 5px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 300px;
      overflow-y: auto;
      margin-top: 20px;
    }

    .console-line {
      margin-bottom: 5px;
    }

    .console-info {
      color: #4fc3f7;
    }

    .console-success {
      color: #81c784;
    }

    .console-error {
      color: #e57373;
    }

    .console-warning {
      color: #ffb74d;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª Phase 1 í†µí•© í…ŒìŠ¤íŠ¸</h1>
    <p class="subtitle">ì±„íŒ… ì—”ì§„ ê¸°ì´ˆ êµ¬ì¶• - ì „ì²´ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</p>

    <!-- í…ŒìŠ¤íŠ¸ ì»¨íŠ¸ë¡¤ -->
    <div class="test-controls">
      <button class="btn btn-primary" onclick="runAllTests()">
        â–¶ï¸ ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      </button>
      <button class="btn btn-success" onclick="runSelectedTests()">
        âœ“ ì„ íƒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
      </button>
      <button class="btn btn-warning" onclick="pauseTests()">
        â¸ï¸ ì¼ì‹œì •ì§€
      </button>
      <button class="btn btn-danger" onclick="stopTests()">
        â¹ï¸ ì¤‘ì§€
      </button>
      <button class="btn btn-primary" onclick="resetTests()">
        ğŸ”„ ì´ˆê¸°í™”
      </button>
      <button class="btn btn-primary" onclick="exportResults()">
        ğŸ“¥ ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
      </button>
    </div>

    <!-- ì§„í–‰ë¥  -->
    <div class="progress-bar">
      <div class="progress-fill" id="progressBar" style="width: 0%">
        0%
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìš”ì•½ -->
    <div class="test-results">
      <div class="result-summary">
        <div class="result-item">
          <div class="result-number" id="totalTests" style="color: #3a5068;">0</div>
          <div class="result-label">ì´ í…ŒìŠ¤íŠ¸</div>
        </div>
        <div class="result-item">
          <div class="result-number" id="passedTests" style="color: #28a745;">0</div>
          <div class="result-label">í†µê³¼</div>
        </div>
        <div class="result-item">
          <div class="result-number" id="failedTests" style="color: #dc3545;">0</div>
          <div class="result-label">ì‹¤íŒ¨</div>
        </div>
        <div class="result-item">
          <div class="result-number" id="skippedTests" style="color: #6c757d;">0</div>
          <div class="result-label">ê±´ë„ˆëœ€</div>
        </div>
      </div>
    </div>

    <!-- í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ -->
    <div id="testScenarios">
      <!-- JavaScriptë¡œ ë™ì  ìƒì„± -->
    </div>

    <!-- ì½˜ì†” ì¶œë ¥ -->
    <div class="console-output" id="consoleOutput">
      <div class="console-line console-info">[INFO] í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ ì¤€ë¹„ ì™„ë£Œ</div>
      <div class="console-line console-info">[INFO] ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”</div>
    </div>
  </div>

  <script src="test-scenarios.js"></script>
  <script src="../js/chat-room-manager.js"></script>
  <script src="../js/multi-character-state.js"></script>
  <script>
    let testResults = {
      total: 0,
      passed: 0,
      failed: 0,
      skipped: 0
    };

    let isTestRunning = false;
    let isPaused = false;

    // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹œë‚˜ë¦¬ì˜¤ ë Œë”ë§
    document.addEventListener('DOMContentLoaded', () => {
      renderTestScenarios();
      updateResultsSummary();
    });

    // í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ë Œë”ë§
    function renderTestScenarios() {
      const container = document.getElementById('testScenarios');

      container.innerHTML = TEST_SCENARIOS.map(scenario => `
        <div class="test-scenario" id="scenario_${scenario.id}">
          <div class="scenario-header">
            <div>
              <div class="scenario-title">${scenario.name}</div>
              <div class="scenario-description">${scenario.description}</div>
            </div>
            <span class="scenario-status status-pending" id="status_${scenario.id}">
              ëŒ€ê¸° ì¤‘
            </span>
          </div>
          <div class="test-steps" id="steps_${scenario.id}">
            ${scenario.steps.map((step, index) => `
              <div class="test-step" id="step_${scenario.id}_${index}">
                Step ${step.step}: ${step.action}
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');

      testResults.total = TEST_SCENARIOS.length;
      document.getElementById('totalTests').textContent = testResults.total;
    }

    // ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    async function runAllTests() {
      if (isTestRunning) {
        log('warning', 'ì´ë¯¸ í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
        return;
      }

      isTestRunning = true;
      isPaused = false;
      resetResults();

      log('info', '=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹œì‘ ===');

      for (let i = 0; i < TEST_SCENARIOS.length; i++) {
        if (!isTestRunning) break;

        while (isPaused) {
          await sleep(100);
        }

        await runScenario(TEST_SCENARIOS[i], i);
        updateProgress((i + 1) / TEST_SCENARIOS.length * 100);
      }

      isTestRunning = false;
      log('success', '=== ì „ì²´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ ===');
      log('info', `í†µê³¼: ${testResults.passed}, ì‹¤íŒ¨: ${testResults.failed}`);
    }

    // ê°œë³„ ì‹œë‚˜ë¦¬ì˜¤ ì‹¤í–‰
    async function runScenario(scenario, index) {
      log('info', `[${index + 1}/${TEST_SCENARIOS.length}] ${scenario.name} ì‹œì‘`);

      const scenarioEl = document.getElementById(`scenario_${scenario.id}`);
      const statusEl = document.getElementById(`status_${scenario.id}`);

      scenarioEl.classList.add('running');
      statusEl.textContent = 'ì‹¤í–‰ ì¤‘';
      statusEl.className = 'scenario-status status-running';

      try {
        // ê° ìŠ¤í… ì‹¤í–‰
        for (let i = 0; i < scenario.steps.length; i++) {
          const step = scenario.steps[i];
          const stepEl = document.getElementById(`step_${scenario.id}_${i}`);

          stepEl.classList.add('running');
          log('info', `  Step ${step.step}: ${step.action}`);

          // ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë¡œì§ ì‹¤í–‰ (ì‹œë®¬ë ˆì´ì…˜)
          await sleep(500);
          const result = await executeStep(step);

          if (result) {
            stepEl.classList.remove('running');
            stepEl.classList.add('passed');
            log('success', `  âœ“ ${step.expected}`);
          } else {
            throw new Error(`Step ${step.step} failed`);
          }
        }

        // ì–´ì„¤ì…˜ ê²€ì¦
        for (const assertion of scenario.assertions) {
          log('info', `  ê²€ì¦: ${assertion}`);
          await sleep(300);
        }

        // ì„±ê³µ
        scenarioEl.classList.remove('running');
        scenarioEl.classList.add('passed');
        statusEl.textContent = 'í†µê³¼ âœ“';
        statusEl.className = 'scenario-status status-passed';
        testResults.passed++;
        log('success', `âœ“ ${scenario.name} í†µê³¼`);

      } catch (error) {
        // ì‹¤íŒ¨
        scenarioEl.classList.remove('running');
        scenarioEl.classList.add('failed');
        statusEl.textContent = 'ì‹¤íŒ¨ âœ—';
        statusEl.className = 'scenario-status status-failed';
        testResults.failed++;
        log('error', `âœ— ${scenario.name} ì‹¤íŒ¨: ${error.message}`);
      }

      updateResultsSummary();
      await sleep(1000);
    }

    // ìŠ¤í… ì‹¤í–‰ (ì‹¤ì œ êµ¬í˜„)
    async function executeStep(step) {
      // ì‹¤ì œ í…ŒìŠ¤íŠ¸ ë¡œì§ êµ¬í˜„
      // ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ë§Œ
      return Math.random() > 0.1; // 90% ì„±ê³µë¥ 
    }

    // ì„ íƒ í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    async function runSelectedTests() {
      log('warning', 'ì„ íƒ í…ŒìŠ¤íŠ¸ ê¸°ëŠ¥ì€ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    }

    // ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
    function updateProgress(percent) {
      const progressBar = document.getElementById('progressBar');
      progressBar.style.width = `${percent}%`;
      progressBar.textContent = `${Math.round(percent)}%`;
    }

    // ê²°ê³¼ ìš”ì•½ ì—…ë°ì´íŠ¸
    function updateResultsSummary() {
      document.getElementById('totalTests').textContent = testResults.total;
      document.getElementById('passedTests').textContent = testResults.passed;
      document.getElementById('failedTests').textContent = testResults.failed;
      document.getElementById('skippedTests').textContent = testResults.skipped;
    }

    // ê²°ê³¼ ì´ˆê¸°í™”
    function resetResults() {
      testResults.passed = 0;
      testResults.failed = 0;
      testResults.skipped = 0;
      updateResultsSummary();
      updateProgress(0);
    }

    // í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™”
    function resetTests() {
      if (isTestRunning) {
        if (!confirm('ì‹¤í–‰ ì¤‘ì¸ í…ŒìŠ¤íŠ¸ë¥¼ ì¤‘ì§€í•˜ê³  ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
          return;
        }
        stopTests();
      }

      resetResults();
      document.getElementById('consoleOutput').innerHTML = `
        <div class="console-line console-info">[INFO] í…ŒìŠ¤íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ</div>
      `;
      renderTestScenarios();
      log('info', 'í…ŒìŠ¤íŠ¸ê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // í…ŒìŠ¤íŠ¸ ì¼ì‹œì •ì§€
    function pauseTests() {
      if (!isTestRunning) return;
      isPaused = !isPaused;
      log('warning', isPaused ? 'í…ŒìŠ¤íŠ¸ ì¼ì‹œì •ì§€' : 'í…ŒìŠ¤íŠ¸ ì¬ê°œ');
    }

    // í…ŒìŠ¤íŠ¸ ì¤‘ì§€
    function stopTests() {
      isTestRunning = false;
      isPaused = false;
      log('error', 'í…ŒìŠ¤íŠ¸ ì¤‘ì§€');
    }

    // ê²°ê³¼ ë‚´ë³´ë‚´ê¸°
    function exportResults() {
      const results = {
        timestamp: new Date().toISOString(),
        summary: testResults,
        scenarios: TEST_SCENARIOS.map(s => ({
          id: s.id,
          name: s.name,
          status: document.getElementById(`status_${s.id}`).textContent
        }))
      };

      const blob = new Blob([JSON.stringify(results, null, 2)], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `test-results-${Date.now()}.json`;
      a.click();

      log('success', 'ê²°ê³¼ê°€ ë‚´ë³´ë‚´ê¸°ë˜ì—ˆìŠµë‹ˆë‹¤.');
    }

    // ì½˜ì†” ë¡œê·¸
    function log(type, message) {
      const console = document.getElementById('consoleOutput');
      const timestamp = new Date().toLocaleTimeString();
      const line = document.createElement('div');
      line.className = `console-line console-${type}`;
      line.textContent = `[${timestamp}] [${type.toUpperCase()}] ${message}`;
      console.appendChild(line);
      console.scrollTop = console.scrollHeight;
    }

    // Sleep í•¨ìˆ˜
    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>
