<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ì§„ API ë””ë²„ê¹…</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>ğŸ” ì‚¬ì§„ API ë””ë²„ê¹… ë„êµ¬</h1>

    <button onclick="testPhotoAPI()">API í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
    <button onclick="clearResults()">ê²°ê³¼ ì§€ìš°ê¸°</button>

    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testPhotoAPI() {
            log('ğŸš€ ì‚¬ì§„ API í…ŒìŠ¤íŠ¸ ì‹œì‘');

            const characterIds = [
                'ë‚˜ì—°_enfp_1759240894283',
                'ì†Œìš´_esfp_1759284829045'
            ];

            for (const characterId of characterIds) {
                log(`ğŸ“¸ ìºë¦­í„° í…ŒìŠ¤íŠ¸: ${characterId}`);

                try {
                    const encodedId = encodeURIComponent(characterId);
                    const url = `/api/character-ai-generator?action=get_character_photos_v2&character_id=${encodedId}&_t=${Date.now()}`;

                    log(`ğŸ“¡ API í˜¸ì¶œ: ${url}`);

                    const response = await fetch(url);
                    log(`ğŸ“¥ ì‘ë‹µ ìƒíƒœ: ${response.status}`, response.ok ? 'success' : 'error');

                    if (!response.ok) {
                        log(`âŒ API ì˜¤ë¥˜: ${response.status} ${response.statusText}`, 'error');
                        continue;
                    }

                    const result = await response.json();

                    log('ğŸ“Š API ì‘ë‹µ ë¶„ì„:', 'success');
                    log(`<pre>ì „ì²´ ì‘ë‹µ: ${JSON.stringify(result, null, 2)}</pre>`);

                    if (result.data && result.data.photos) {
                        log('ğŸ“· Photos ê°ì²´ ìƒì„¸:', 'success');
                        log(`<pre>Photos: ${JSON.stringify(result.data.photos, null, 2)}</pre>`);

                        // ê° ì¹´í…Œê³ ë¦¬ë³„ í™•ì¸
                        const categories = ['profile', 'casual', 'romantic', 'emotional', 'special'];
                        categories.forEach(cat => {
                            const value = result.data.photos[cat];
                            const type = value === null ? 'null' :
                                        value === undefined ? 'undefined' :
                                        Array.isArray(value) ? `array(${value.length})` :
                                        typeof value;
                            log(`  ${cat}: ${type}`);
                        });
                    }

                    // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥
                    if (result.debug_info) {
                        log('ğŸ”§ GitHub API ë””ë²„ê·¸ ì •ë³´:', 'success');
                        log(`<pre>Debug Info: ${JSON.stringify(result.debug_info, null, 2)}</pre>`);

                        if (result.debug_info.files_searched_in_github) {
                            log('ğŸ“ GitHubì—ì„œ ì°¾ì€ íŒŒì¼ë“¤:', 'success');
                            result.debug_info.files_searched_in_github.forEach(filename => {
                                log(`  - ${filename}`);
                            });
                        }
                    }

                    log(`âœ… ${characterId} í…ŒìŠ¤íŠ¸ ì™„ë£Œ\n`, 'success');

                } catch (error) {
                    log(`ğŸ’¥ ${characterId} í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
                    log(`<pre>${error.stack}</pre>`, 'error');
                }
            }

            log('ğŸ ëª¨ë“  í…ŒìŠ¤íŠ¸ ì™„ë£Œ', 'success');
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ìë™ ì‹¤í–‰
        window.addEventListener('load', () => {
            log('ğŸ“‹ ì‚¬ì§„ API ë””ë²„ê¹… ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
            log('ğŸ’¡ "API í…ŒìŠ¤íŠ¸ ì‹¤í–‰" ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì‹œì‘í•˜ì„¸ìš”');
        });
    </script>
</body>
</html>