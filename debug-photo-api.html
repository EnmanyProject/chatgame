<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>사진 API 디버깅</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e9; color: #2e7d32; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>🔍 사진 API 디버깅 도구</h1>

    <button onclick="testPhotoAPI()">API 테스트 실행</button>
    <button onclick="clearResults()">결과 지우기</button>

    <div id="results"></div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testPhotoAPI() {
            log('🚀 사진 API 테스트 시작');

            const characterIds = [
                '나연_enfp_1759240894283',
                '소운_esfp_1759284829045'
            ];

            for (const characterId of characterIds) {
                log(`📸 캐릭터 테스트: ${characterId}`);

                try {
                    const encodedId = encodeURIComponent(characterId);
                    const url = `/api/character-ai-generator?action=get_character_photos_v2&character_id=${encodedId}&_t=${Date.now()}`;

                    log(`📡 API 호출: ${url}`);

                    const response = await fetch(url);
                    log(`📥 응답 상태: ${response.status}`, response.ok ? 'success' : 'error');

                    if (!response.ok) {
                        log(`❌ API 오류: ${response.status} ${response.statusText}`, 'error');
                        continue;
                    }

                    const result = await response.json();

                    log('📊 API 응답 분석:', 'success');
                    log(`<pre>전체 응답: ${JSON.stringify(result, null, 2)}</pre>`);

                    if (result.data && result.data.photos) {
                        log('📷 Photos 객체 상세:', 'success');
                        log(`<pre>Photos: ${JSON.stringify(result.data.photos, null, 2)}</pre>`);

                        // 각 카테고리별 확인
                        const categories = ['profile', 'casual', 'romantic', 'emotional', 'special'];
                        categories.forEach(cat => {
                            const value = result.data.photos[cat];
                            const type = value === null ? 'null' :
                                        value === undefined ? 'undefined' :
                                        Array.isArray(value) ? `array(${value.length})` :
                                        typeof value;
                            log(`  ${cat}: ${type}`);
                        });
                    }

                    // 디버그 정보 출력
                    if (result.debug_info) {
                        log('🔧 GitHub API 디버그 정보:', 'success');
                        log(`<pre>Debug Info: ${JSON.stringify(result.debug_info, null, 2)}</pre>`);

                        if (result.debug_info.files_searched_in_github) {
                            log('📁 GitHub에서 찾은 파일들:', 'success');
                            result.debug_info.files_searched_in_github.forEach(filename => {
                                log(`  - ${filename}`);
                            });
                        }
                    }

                    log(`✅ ${characterId} 테스트 완료\n`, 'success');

                } catch (error) {
                    log(`💥 ${characterId} 테스트 오류: ${error.message}`, 'error');
                    log(`<pre>${error.stack}</pre>`, 'error');
                }
            }

            log('🏁 모든 테스트 완료', 'success');
        }

        // 페이지 로드시 자동 실행
        window.addEventListener('load', () => {
            log('📋 사진 API 디버깅 도구 준비 완료');
            log('💡 "API 테스트 실행" 버튼을 클릭하여 시작하세요');
        });
    </script>
</body>
</html>