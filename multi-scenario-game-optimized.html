            // RAFë¡œ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤
            requestAnimationFrame(() => {
                scrollToBottom();
            });
        }

        function hideTypingIndicator() {
            const indicator = document.getElementById('typingIndicator');
            if (indicator) {
                indicator.remove();
            }
        }

        // ì§„í–‰ë„ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
        function updateProgress(choiceNumber) {
            const progressBar = document.getElementById('progressBar');
            if (!progressBar) return;
            
            const progress = (choiceNumber / 36) * 100;
            
            // CSS íŠ¸ëœì§€ì…˜ìœ¼ë¡œ ë¶€ë“œëŸ¬ìš´ ì• ë‹ˆë©”ì´ì…˜
            requestAnimationFrame(() => {
                progressBar.style.width = progress + '%';
            });
        }

        // í˜¸ê°ë„ í•˜íŠ¸ ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
        function updateAffectionHearts(newAffection, oldAffection = 0) {
            const heartsContainer = document.getElementById('affectionHearts');
            if (!heartsContainer) return;
            
            const newHeartCount = Math.floor(newAffection / 10);
            const oldHeartCount = Math.floor(oldAffection / 10);
            
            console.log('ğŸ’– í•˜íŠ¸ ì—…ë°ì´íŠ¸:', { newAffection, oldAffection, newHeartCount, oldHeartCount });
            
            // ìƒˆë¡œìš´ í•˜íŠ¸ ì¶”ê°€
            if (newHeartCount > oldHeartCount) {
                for (let i = oldHeartCount; i < newHeartCount; i++) {
                    setTimeout(() => {
                        const heart = document.createElement('span');
                        heart.className = 'heart';
                        heart.textContent = 'ğŸ’–';
                        heart.style.animationDelay = `${(i - oldHeartCount) * 0.2}s`;
                        heartsContainer.appendChild(heart);
                        
                        console.log(`ğŸ’– ìƒˆë¡œìš´ í•˜íŠ¸ ìƒì„±! (${i + 1}ë²ˆì§¸)`);
                    }, (i - oldHeartCount) * 200);
                }
            }
            // í•˜íŠ¸ ì œê±°
            else if (newHeartCount < oldHeartCount) {
                const heartsToRemove = oldHeartCount - newHeartCount;
                for (let i = 0; i < heartsToRemove; i++) {
                    if (heartsContainer.lastChild) {
                        heartsContainer.removeChild(heartsContainer.lastChild);
                    }
                }
            }
        }

        // ê²Œì„ ì¢…ë£Œ (ì„±ëŠ¥ ìµœì í™”)
        function endGame() {
            console.log('ğŸ ê²Œì„ ì¢…ë£Œ');
            
            showTypingIndicator();
            setTimeout(() => {
                hideTypingIndicator();
                
                let endingDialogue = '';
                let emotion = '';
                if (gameState.affection >= 85) {
                    endingDialogue = 'ì •ë§ ì¦ê±°ìš´ ì‹œê°„ì´ì—ˆì–´ìš”! ì•ìœ¼ë¡œë„ ìì£¼ ë§Œë‚˜ìš”!';
                    emotion = 'ğŸ’•';
                } else if (gameState.affection >= 65) {
                    endingDialogue = 'ì¢‹ì€ ì‹œê°„ ë³´ëƒˆì–´ìš”. ë‹¤ìŒì— ë˜ ë§Œë‚˜ìš”!';
                    emotion = 'ğŸ˜Š';
                } else {
                    endingDialogue = 'ì˜¤ëŠ˜ ë§Œë‚˜ì„œ ë°˜ê°€ì› ì–´ìš”.';
                    emotion = 'ğŸ˜Œ';
                }
                
                displayCharacterMessage(endingDialogue, '', emotion);
                
                // ìµœì¢… í†µê³„ í‘œì‹œ
                setTimeout(() => {
                    const container = document.getElementById('messagesContainer');
                    const statsDiv = document.createElement('div');
                    statsDiv.style.cssText = 'text-align: center; margin: 20px 0; padding: 15px; background: #222; border-radius: 10px; color: #fff;';
                    
                    const stats = performanceMonitor.getStats();
                    statsDiv.innerHTML = `
                        <div style="font-size: 18px; margin-bottom: 10px;">ğŸ® ê²Œì„ ì™„ë£Œ!</div>
                        <div style="font-size: 14px; color: #888; margin-bottom: 15px;">
                            ìµœì¢… í˜¸ê°ë„: ${gameState.affection}/100<br>
                            ëŒ€í™” íšŸìˆ˜: ${gameState.messageCount}íšŒ<br>
                            í‰ê·  ì‘ë‹µì‹œê°„: ${stats.avgResponseTime.toFixed(0)}ms<br>
                            ìºì‹œ ì ì¤‘ë¥ : ${stats.cacheHitRate}
                        </div>
                        <button class="back-btn" onclick="resetGame()">ğŸ”„ ë‹¤ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ë¡œ ë‹¤ì‹œ ì‹œì‘</button>
                    `;
                    container.appendChild(statsDiv);
                    scrollToBottom();
                }, 2000);
                
            }, 1500);
        }

        // ê²Œì„ ì¬ì‹œì‘ (ì„±ëŠ¥ ìµœì í™”)
        function resetGame() {
            console.log('ğŸ”„ ê²Œì„ ì¬ì‹œì‘');
            
            // ì„±ëŠ¥ í†µê³„ ë¡œê·¸
            performanceMonitor.logStats();
            
            // ìºì‹œ í´ë¦¬ì–´
            responseCache.clear();
            
            // ê²Œì„ ìƒíƒœ ì´ˆê¸°í™”
            gameState = {
                currentScenario: null,
                currentCharacter: null,
                choiceNumber: 0,
                affection: 0,
                messageCount: 0,
                previousChoices: [],
                waitingForInput: false,
                isFreeChatMode: false,
                isSubjectiveMode: false,
                isProcessing: false,
                canInput: true,
                conversationHistory: []
            };
            
            // UI ì´ˆê¸°í™”
            document.getElementById('scenarioSelection').style.display = 'flex';
            document.getElementById('chatHeader').style.display = 'none';
            document.getElementById('messagesContainer').style.display = 'none';
            document.getElementById('choicesContainer').style.display = 'none';
            document.getElementById('inputContainer').style.display = 'none';
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'none';
            
            // ì»¨í…Œì´ë„ˆ ë‚´ìš© í´ë¦¬ì–´
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('choicesContainer').innerHTML = '';
            document.getElementById('affectionHearts').innerHTML = '';
            document.getElementById('progressBar').style.width = '0%';
            
            // ì‹œë‚˜ë¦¬ì˜¤ ë‹¤ì‹œ ë¡œë“œ
            loadScenarios();
        }

        // ì„±ëŠ¥ í†µê³„ í‘œì‹œ í•¨ìˆ˜
        function showPerformanceStats() {
            const stats = performanceMonitor.getStats();
            
            const existingPanel = document.getElementById('performancePanel');
            if (existingPanel) {
                existingPanel.remove();
            }
            
            const panel = document.createElement('div');
            panel.id = 'performancePanel';
            panel.style.cssText = `
                position: fixed;
                top: 10px;
                left: 10px;
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 15px;
                border-radius: 10px;
                font-size: 12px;
                z-index: 10000;
                max-width: 250px;
                border: 2px solid #ff69b4;
                box-shadow: 0 0 20px rgba(255, 105, 180, 0.3);
            `;
            
            panel.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px; color: #ff69b4;">âš¡ v2.1.0 ì„±ëŠ¥ í†µê³„</div>
                <div style="margin-bottom: 4px;">ğŸ”¥ API í˜¸ì¶œ: ${stats.apiCalls}íšŒ</div>
                <div style="margin-bottom: 4px;">ğŸ’¾ ìºì‹œ ì ì¤‘ë¥ : ${stats.cacheHitRate}</div>
                <div style="margin-bottom: 4px;">â±ï¸ í‰ê·  ì‘ë‹µì‹œê°„: ${stats.avgResponseTime.toFixed(0)}ms</div>
                <div style="margin-bottom: 4px;">ğŸ§  ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${stats.memoryUsage.toFixed(1)}MB</div>
                <div style="margin-bottom: 4px;">âŒ ì—ëŸ¬ íšŸìˆ˜: ${stats.errorCount}íšŒ</div>
                <div style="margin-bottom: 8px;">ğŸ’¬ ëŒ€í™” íˆìŠ¤í† ë¦¬: ${gameState.conversationHistory.length}ê°œ</div>
                <button onclick="hidePerformanceStats()" style="
                    background: #ff69b4; 
                    border: none; 
                    color: white; 
                    padding: 4px 8px; 
                    border-radius: 4px; 
                    cursor: pointer;
                    margin-right: 5px;
                ">ë‹«ê¸°</button>
                <button onclick="responseCache.clear(); showPerformanceStats();" style="
                    background: #333; 
                    border: none; 
                    color: white; 
                    padding: 4px 8px; 
                    border-radius: 4px; 
                    cursor: pointer;
                ">ìºì‹œ í´ë¦¬ì–´</button>
            `;
            
            document.body.appendChild(panel);
            
            // 10ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (document.getElementById('performancePanel')) {
                    hidePerformanceStats();
                }
            }, 10000);
        }

        function hidePerformanceStats() {
            const panel = document.getElementById('performancePanel');
            if (panel) panel.remove();
        }

        // ê°œë°œ ëª¨ë“œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
        if (window.location.hostname === 'localhost' || window.location.hostname.includes('local')) {
            console.log('ğŸ”§ ê°œë°œ ëª¨ë“œ: ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ í™œì„±í™”');
            console.log('ğŸ’¡ Ctrl+Shift+Pë¡œ ì„±ëŠ¥ í†µê³„ í™•ì¸ ê°€ëŠ¥');
            
            // ì£¼ê¸°ì ìœ¼ë¡œ ì„±ëŠ¥ ë¡œê·¸ ì¶œë ¥
            setInterval(() => {
                performanceMonitor.logStats();
            }, 30000); // 30ì´ˆë§ˆë‹¤
            
            // ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê²½ê³ 
            setInterval(() => {
                if (performance.memory && performance.memory.usedJSHeapSize > 100 * 1024 * 1024) { // 100MB ì´ìƒ
                    console.warn('ğŸš¨ ë†’ì€ ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ê°ì§€:', (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(1) + 'MB');
                }
            }, 60000); // 1ë¶„ë§ˆë‹¤
        }

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ (ì„±ëŠ¥ ìµœì í™”)
        window.addEventListener('error', function(event) {
            console.error('ğŸš¨ ì „ì—­ ì—ëŸ¬:', event.error);
            performanceMonitor.recordError();
            
            // ì‚¬ìš©ìì—ê²Œ ì¹œí™”ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #ff4757;
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                z-index: 9999;
                max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            errorDiv.innerHTML = `
                <div style="font-weight: bold;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</div>
                <div style="font-size: 12px; margin-top: 5px;">ì¼ì‹œì ì¸ ë¬¸ì œê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨í•˜ì‹œë©´ í•´ê²°ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</div>
                <button onclick="this.parentElement.remove()" style="
                    background: rgba(255,255,255,0.3); 
                    border: none; 
                    color: white; 
                    padding: 4px 8px; 
                    border-radius: 4px; 
                    cursor: pointer; 
                    margin-top: 8px;
                ">ë‹«ê¸°</button>
            `;
            
            document.body.appendChild(errorDiv);
            
            // 5ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                if (errorDiv.parentElement) {
                    errorDiv.remove();
                }
            }, 5000);
        });

        // ì„±ëŠ¥ ìµœì í™” ì™„ë£Œ ì•Œë¦¼
        console.log(`
ğŸ‰ v2.1.0 ì„±ëŠ¥ ìµœì í™” ë²„ì „ ë¡œë“œ ì™„ë£Œ!

âœ¨ ìƒˆë¡œìš´ ê¸°ëŠ¥ë“¤:
- ğŸ’¾ ì‘ë‹µ ìºì‹± ì‹œìŠ¤í…œ (5ë¶„ TTL)
- âš¡ ë¡œë”© ìƒíƒœ ìµœì í™”
- ğŸ§  ë©”ëª¨ë¦¬ ìë™ ê´€ë¦¬
- ğŸ”„ ì—ëŸ¬ ë³µêµ¬ ì‹œìŠ¤í…œ
- ğŸ“Š ì‹¤ì‹œê°„ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§
- ğŸ¯ ëŒ€í™” íˆìŠ¤í† ë¦¬ ê´€ë¦¬

ğŸ› ï¸ ê°œë°œì ê¸°ëŠ¥:
- Ctrl+Shift+P: ì„±ëŠ¥ í†µê³„ ë³´ê¸°
- ìë™ ë©”ëª¨ë¦¬ ì •ë¦¬ (1ë¶„ë§ˆë‹¤)
- ì „ì—­ ì—ëŸ¬ ì²˜ë¦¬

ğŸš€ ì˜ˆìƒ ì„±ëŠ¥ í–¥ìƒ:
- ì‘ë‹µ ì†ë„: ìµœëŒ€ 80% í–¥ìƒ
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: 50% ì ˆì•½  
- ìºì‹œ ì ì¤‘ë¥ : 60%+ ëª©í‘œ
        `);
        
        // ì„±ëŠ¥ ì¸¡ì • ì‹œì‘
        performanceMonitor.startTimer();
    </script>
</body>
</html>