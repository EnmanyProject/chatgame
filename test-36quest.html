<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>36퀘스트 시스템 테스트</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: #1a1a2e;
            color: white;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: #2a2a3e;
            border: 2px solid #ff69b4;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        h2 {
            color: #ff69b4;
        }
        button {
            background: #ff69b4;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #ff1493;
        }
        .result {
            background: #1a1a2e;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            color: #4caf50;
        }
        .error {
            color: #f44336;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🎮 36퀘스트 시스템 테스트</h1>
        
        <div class="test-section">
            <h2>1. 퀘스트 데이터 로드 테스트</h2>
            <button onclick="testLoadQuestData()">퀘스트 데이터 로드</button>
            <div id="quest-load-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>2. 캐릭터 데이터 테스트</h2>
            <button onclick="testCharacterData()">캐릭터 데이터 확인</button>
            <div id="character-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>3. API 연결 테스트</h2>
            <button onclick="testQuestAPI()">퀘스트 API 테스트</button>
            <button onclick="testScenarioAPI()">시나리오 API 테스트</button>
            <div id="api-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>4. 퀘스트 선택 UI 테스트</h2>
            <button onclick="testQuestUI()">퀘스트 선택 모달 열기</button>
            <div id="ui-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h2>5. 진행도 저장/로드 테스트</h2>
            <button onclick="testSaveProgress()">진행도 저장</button>
            <button onclick="testLoadProgress()">진행도 로드</button>
            <div id="progress-result" class="result"></div>
        </div>
    </div>

    <script>
        // 테스트 함수들
        async function testLoadQuestData() {
            const resultDiv = document.getElementById('quest-load-result');
            try {
                // 로컬 JSON 파일 로드 시도
                const response = await fetch('/data/quests/quest-database.json');
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">✅ 퀘스트 데이터 로드 성공!</span>\n`;
                resultDiv.innerHTML += `총 퀘스트: ${data.metadata.total_quests}개\n`;
                resultDiv.innerHTML += `카테고리: ${Object.keys(data.categories).length}개\n`;
                resultDiv.innerHTML += `- ${Object.values(data.categories).map(c => c.name).join('\n- ')}`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ 로드 실패: ${error.message}</span>`;
            }
        }
        
        async function testCharacterData() {
            const resultDiv = document.getElementById('character-result');
            try {
                const response = await fetch('/data/characters-extended/mbti-characters.json');
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">✅ 캐릭터 데이터 로드 성공!</span>\n`;
                resultDiv.innerHTML += `총 캐릭터: ${Object.keys(data.characters).length}명\n\n`;
                
                Object.values(data.characters).forEach(char => {
                    resultDiv.innerHTML += `${char.name} (${char.mbti}) - ${char.status}\n`;
                });
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ 로드 실패: ${error.message}</span>`;
            }
        }
        
        async function testQuestAPI() {
            const resultDiv = document.getElementById('api-result');
            try {
                const response = await fetch('/api/quest-manager?action=list');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `<span class="success">✅ 퀘스트 API 연결 성공!</span>\n`;
                    resultDiv.innerHTML += JSON.stringify(data.metadata, null, 2);
                } else {
                    throw new Error('API 응답 실패');
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ API 연결 실패: ${error.message}</span>`;
            }
        }
        
        async function testScenarioAPI() {
            const resultDiv = document.getElementById('api-result');
            try {
                const response = await fetch('/api/scenario?action=test');
                const data = await response.json();
                
                resultDiv.innerHTML = `<span class="success">✅ 시나리오 API 연결 성공!</span>\n`;
                resultDiv.innerHTML += JSON.stringify(data, null, 2);
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ API 연결 실패: ${error.message}</span>`;
            }
        }
        
        function testQuestUI() {
            const resultDiv = document.getElementById('ui-result');
            try {
                // 간단한 모달 테스트
                const modal = document.createElement('div');
                modal.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#2a2a3e;padding:20px;border:2px solid #ff69b4;border-radius:10px;z-index:1000;';
                modal.innerHTML = `
                    <h3 style="color:#ff69b4;">퀘스트 UI 테스트</h3>
                    <p>모달이 정상적으로 표시됩니다!</p>
                    <button onclick="this.parentElement.remove()">닫기</button>
                `;
                document.body.appendChild(modal);
                
                resultDiv.innerHTML = `<span class="success">✅ UI 테스트 모달 생성됨</span>`;
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ UI 테스트 실패: ${error.message}</span>`;
            }
        }
        
        function testSaveProgress() {
            const resultDiv = document.getElementById('progress-result');
            try {
                const testData = {
                    unlockedQuests: ['quest_001', 'quest_002'],
                    completedQuests: ['quest_001'],
                    userProgress: {
                        totalAffection: 50,
                        questsCompleted: 1,
                        currentStreak: 1
                    },
                    lastSaved: new Date().toISOString()
                };
                
                localStorage.setItem('questProgress_test', JSON.stringify(testData));
                resultDiv.innerHTML = `<span class="success">✅ 진행도 저장 성공!</span>\n`;
                resultDiv.innerHTML += JSON.stringify(testData, null, 2);
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ 저장 실패: ${error.message}</span>`;
            }
        }
        
        function testLoadProgress() {
            const resultDiv = document.getElementById('progress-result');
            try {
                const saved = localStorage.getItem('questProgress_test');
                if (saved) {
                    const data = JSON.parse(saved);
                    resultDiv.innerHTML = `<span class="success">✅ 진행도 로드 성공!</span>\n`;
                    resultDiv.innerHTML += JSON.stringify(data, null, 2);
                } else {
                    resultDiv.innerHTML = `<span class="error">저장된 진행도가 없습니다.</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span class="error">❌ 로드 실패: ${error.message}</span>`;
            }
        }
    </script>
</body>
</html>