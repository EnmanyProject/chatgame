<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📝 시나리오 관리 - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #121212;
            color: #ffffff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .admin-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .panel-section {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
        }

        .section-title {
            color: #ff69b4;
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metadata-form, .message-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            color: #ccc;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            background: #222;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #ff69b4;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
        }

        .btn-secondary {
            background: #666;
        }

        .btn-danger {
            background: #dc3545;
        }

        .messages-list {
            max-height: 400px;
            overflow-y: auto;
            background: #222;
            border-radius: 8px;
            padding: 15px;
        }

        .message-item {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #ff69b4;
        }

        .message-item:last-child {
            margin-bottom: 0;
        }

        .message-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .message-id {
            color: #ff69b4;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .message-type {
            background: #444;
            color: #ccc;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .message-text {
            color: #fff;
            margin: 10px 0;
        }

        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .status-bar {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-text {
            color: #ff69b4;
            font-weight: 600;
        }

        .choices-preview {
            background: #333;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .choice-item {
            background: #444;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .choice-text {
            color: #fff;
        }

        .choice-delta {
            color: #ff69b4;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .admin-panel {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📝 시나리오 관리</h1>
            <p>채팅 게임의 시나리오를 생성, 편집, 관리할 수 있습니다</p>
        </div>

        <div class="status-bar">
            <span class="status-text" id="statusText">시나리오 로드 중...</span>
        </div>

        <div class="admin-panel">
            <!-- AI 설정 섹션 -->
            <div class="panel-section">
                <h2 class="section-title">
                    🤖 AI 서버 관리
                </h2>
                <div class="form-group">
                    <label for="adminPassword">관리자 비밀번호</label>
                    <input type="password" id="adminPassword" placeholder="관리자 비밀번호를 입력하세요">
                </div>
                <button type="button" class="btn" onclick="connectToServer()">서버 연결</button>
                
                <div id="serverStatus" style="margin: 15px 0; padding: 10px; background: #333; border-radius: 8px; display: none;">
                    <div class="status-text" id="serverStatusText">연결 상태 확인 중...</div>
                </div>
                
                <div id="aiSettings" style="display: none;">
                    <h3 style="color: #ff69b4; margin: 20px 0 10px 0;">AI 모델 설정</h3>
                    <div class="form-group">
                        <label for="aiModel">AI 모델</label>
                        <select id="aiModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo-preview">GPT-4 Turbo Preview</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="aiTemperature">Temperature (0.0-2.0)</label>
                        <input type="number" id="aiTemperature" min="0" max="2" step="0.1" value="0.8">
                    </div>
                    <div class="form-group">
                        <label for="aiMaxTokens">최대 토큰 수</label>
                        <input type="number" id="aiMaxTokens" min="10" max="1000" value="150">
                    </div>
                    <div class="form-group">
                        <label for="aiSystemPrompt">시스템 프롬프트</label>
                        <textarea id="aiSystemPrompt" rows="8" placeholder="AI 캐릭터 설정 프롬프트를 입력하세요..."></textarea>
                    </div>
                    <button type="button" class="btn" onclick="updateAISettings()">AI 설정 저장</button>
                    
                    <h3 style="color: #ff69b4; margin: 20px 0 10px 0;">서버 통계</h3>
                    <div id="serverStats" style="background: #333; padding: 15px; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; color: #ccc;">
                            <div>총 요청 수: <span id="totalRequests">-</span></div>
                            <div>사용된 토큰: <span id="totalTokens">-</span></div>
                            <div>고유 사용자: <span id="uniqueUsers">-</span></div>
                            <div>가동 시간: <span id="uptime">-</span></div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="refreshStats()" style="margin-top: 10px;">통계 새로고침</button>
                    </div>
                </div>
            </div>
            
            <!-- 메타데이터 섹션 -->
            <div class="panel-section">
                <h2 class="section-title">
                    ⚙️ 게임 메타데이터
                </h2>
                <form class="metadata-form" id="metadataForm">
                    <div class="form-group">
                        <label for="gameTitle">게임 제목</label>
                        <input type="text" id="gameTitle" placeholder="게임의 제목을 입력하세요">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterName">캐릭터 이름</label>
                        <input type="text" id="characterName" placeholder="주인공 이름">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterAge">캐릭터 나이</label>
                        <input type="number" id="characterAge" placeholder="나이">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterRelation">관계</label>
                        <input type="text" id="characterRelation" placeholder="주인공과의 관계">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterPersonality">성격</label>
                        <textarea id="characterPersonality" placeholder="캐릭터의 성격을 설명해주세요"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="initialAffection">초기 호감도</label>
                        <input type="number" id="initialAffection" min="0" max="100" placeholder="0-100">
                    </div>
                    
                    <div class="form-group">
                        <label for="gameSetting">게임 설정</label>
                        <textarea id="gameSetting" placeholder="게임의 배경과 상황을 설명해주세요"></textarea>
                    </div>
                    
                    <button type="button" class="btn" onclick="updateMetadata()">메타데이터 저장</button>
                </form>
            </div>

            <!-- 메시지 관리 섹션 -->
            <div class="panel-section">
                <h2 class="section-title">
                    💬 메시지 관리
                </h2>
                <form class="message-form" id="messageForm">
                    <div class="form-group">
                        <label for="messageType">메시지 타입</label>
                        <select id="messageType" onchange="toggleFormFields()">
                            <option value="received">받은 메시지</option>
                            <option value="stage_direction">상황 설명</option>
                            <option value="choice">선택지</option>
                            <option value="input">입력 요청</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="textGroup">
                        <label for="messageText">메시지 내용</label>
                        <textarea id="messageText" placeholder="메시지 내용을 입력하세요"></textarea>
                    </div>
                    
                    <div class="form-group" id="emotionGroup">
                        <label for="messageEmotion">감정 상태</label>
                        <select id="messageEmotion">
                            <option value="neutral">중립</option>
                            <option value="excited">흥분</option>
                            <option value="happy">기쁨</option>
                            <option value="shy">부끄러움</option>
                            <option value="sad">슬픔</option>
                            <option value="angry">화남</option>
                            <option value="nervous">긴장</option>
                            <option value="romantic">로맨틱</option>
                            <option value="playful">장난스러움</option>
                        </select>
                    </div>
                    
                    <!-- 선택지용 폼 -->
                    <div id="choiceFields" style="display: none;">
                        <div class="form-group">
                            <label for="choicePrompt">선택지 프롬프트</label>
                            <input type="text" id="choicePrompt" placeholder="예: 창용이 뭐라고 답할까요?">
                        </div>
                        <div id="choiceOptions">
                            <h4 style="color: #ff69b4; margin-bottom: 10px;">선택지 옵션들</h4>
                            <div class="choice-option">
                                <input type="text" placeholder="선택지 1 텍스트" class="choice-text">
                                <input type="number" placeholder="호감도 변화" class="choice-delta" min="-10" max="10">
                            </div>
                            <div class="choice-option">
                                <input type="text" placeholder="선택지 2 텍스트" class="choice-text">
                                <input type="number" placeholder="호감도 변화" class="choice-delta" min="-10" max="10">
                            </div>
                            <div class="choice-option">
                                <input type="text" placeholder="선택지 3 텍스트" class="choice-text">
                                <input type="number" placeholder="호감도 변화" class="choice-delta" min="-10" max="10">
                            </div>
                        </div>
                    </div>
                    
                    <!-- 입력 요청용 폼 -->
                    <div id="inputFields" style="display: none;">
                        <div class="form-group">
                            <label for="inputPrompt">입력 프롬프트</label>
                            <input type="text" id="inputPrompt" placeholder="예: 창용이 윤아에게 하고 싶은 말이 있나요?">
                        </div>
                        <div class="form-group">
                            <label for="inputPlaceholder">입력창 힌트</label>
                            <input type="text" id="inputPlaceholder" placeholder="예: 윤아에게 전하고 싶은 말...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn" onclick="addMessage()">메시지 추가</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">폼 초기화</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- 메시지 목록 -->
        <div class="panel-section" style="margin-top: 30px;">
            <h2 class="section-title">
                📋 현재 시나리오 메시지 목록
            </h2>
            <div class="messages-list" id="messagesList">
                <!-- 메시지들이 동적으로 추가됩니다 -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button type="button" class="btn" onclick="saveScenario()">💾 시나리오 저장</button>
                <button type="button" class="btn btn-secondary" onclick="loadScenario()">📁 시나리오 불러오기</button>
                <button type="button" class="btn btn-secondary" onclick="exportScenario()">📤 JSON 내보내기</button>
                <button type="button" class="btn btn-danger" onclick="clearAllMessages()">🗑️ 전체 삭제</button>
            </div>
        </div>
    </div>

    <script>
        let scenarioData = {
            metadata: {
                title: "",
                character: {
                    name: "",
                    age: 0,
                    relationship: "",
                    personality: "",
                    initialAffection: 75
                },
                setting: ""
            },
            messages: []
        };

        let currentMessageId = 1;

        // 초기화
        document.addEventListener('DOMContentLoaded', function() {
            loadScenario();
            updateStatus('시나리오 관리자가 준비되었습니다.');
        });

        // 상태 업데이트
        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }

        // 메시지 타입에 따른 폼 필드 토글
        function toggleFormFields() {
            const messageType = document.getElementById('messageType').value;
            const choiceFields = document.getElementById('choiceFields');
            const inputFields = document.getElementById('inputFields');
            const emotionGroup = document.getElementById('emotionGroup');
            
            choiceFields.style.display = messageType === 'choice' ? 'block' : 'none';
            inputFields.style.display = messageType === 'input' ? 'block' : 'none';
            emotionGroup.style.display = messageType === 'received' ? 'block' : 'none';
        }

        // 메타데이터 업데이트
        function updateMetadata() {
            scenarioData.metadata = {
                title: document.getElementById('gameTitle').value,
                character: {
                    name: document.getElementById('characterName').value,
                    age: parseInt(document.getElementById('characterAge').value) || 0,
                    relationship: document.getElementById('characterRelation').value,
                    personality: document.getElementById('characterPersonality').value,
                    initialAffection: parseInt(document.getElementById('initialAffection').value) || 75
                },
                setting: document.getElementById('gameSetting').value
            };
            
            updateStatus('메타데이터가 업데이트되었습니다.');
            updateMessagesList();
        }

        // 메시지 추가
        function addMessage() {
            const messageType = document.getElementById('messageType').value;
            const messageText = document.getElementById('messageText').value;
            
            if (!messageText.trim() && messageType !== 'choice' && messageType !== 'input') {
                alert('메시지 내용을 입력해주세요.');
                return;
            }

            const newMessage = {
                id: currentMessageId++,
                type: messageType,
                text: messageText
            };

            // 타입별 추가 필드
            if (messageType === 'received') {
                newMessage.timestamp = new Date().toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                newMessage.emotion = document.getElementById('messageEmotion').value;
            } else if (messageType === 'choice') {
                newMessage.prompt = document.getElementById('choicePrompt').value;
                newMessage.options = [];
                
                const choiceTexts = document.querySelectorAll('.choice-text');
                const choiceDeltas = document.querySelectorAll('.choice-delta');
                
                for (let i = 0; i < choiceTexts.length; i++) {
                    if (choiceTexts[i].value.trim()) {
                        newMessage.options.push({
                            text: choiceTexts[i].value,
                            affection_delta: parseInt(choiceDeltas[i].value) || 0,
                            next: currentMessageId
                        });
                    }
                }
            } else if (messageType === 'input') {
                newMessage.prompt = document.getElementById('inputPrompt').value;
                newMessage.placeholder = document.getElementById('inputPlaceholder').value;
                newMessage.next = currentMessageId;
            }

            scenarioData.messages.push(newMessage);
            updateMessagesList();
            clearForm();
            updateStatus(`메시지 ID ${newMessage.id}가 추가되었습니다.`);
        }

        // 메시지 목록 업데이트
        function updateMessagesList() {
            const messagesList = document.getElementById('messagesList');
            messagesList.innerHTML = '';

            scenarioData.messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-item';
                
                let messageContent = `
                    <div class="message-header">
                        <span class="message-id">ID: ${message.id}</span>
                        <span class="message-type">${message.type}</span>
                    </div>
                    <div class="message-text">${message.text || message.prompt || '(시스템 메시지)'}</div>
                `;

                // 선택지 미리보기
                if (message.type === 'choice' && message.options) {
                    messageContent += '<div class="choices-preview">';
                    message.options.forEach(option => {
                        messageContent += `
                            <div class="choice-item">
                                <span class="choice-text">${option.text}</span>
                                <span class="choice-delta">${option.affection_delta > 0 ? '+' : ''}${option.affection_delta}</span>
                            </div>
                        `;
                    });
                    messageContent += '</div>';
                }

                messageContent += `
                    <div class="message-actions">
                        <button class="btn btn-small" onclick="editMessage(${message.id})">✏️ 편집</button>
                        <button class="btn btn-danger btn-small" onclick="deleteMessage(${message.id})">🗑️ 삭제</button>
                    </div>
                `;

                messageDiv.innerHTML = messageContent;
                messagesList.appendChild(messageDiv);
            });
        }

        // 메시지 삭제
        function deleteMessage(messageId) {
            if (confirm('이 메시지를 삭제하시겠습니까?')) {
                scenarioData.messages = scenarioData.messages.filter(msg => msg.id !== messageId);
                updateMessagesList();
                updateStatus(`메시지 ID ${messageId}가 삭제되었습니다.`);
            }
        }

        // 폼 초기화
        function clearForm() {
            document.getElementById('messageText').value = '';
            document.getElementById('choicePrompt').value = '';
            document.getElementById('inputPrompt').value = '';
            document.getElementById('inputPlaceholder').value = '';
            
            // 선택지 초기화
            document.querySelectorAll('.choice-text').forEach(input => input.value = '');
            document.querySelectorAll('.choice-delta').forEach(input => input.value = '');
        }

        // 모든 메시지 삭제
        function clearAllMessages() {
            if (confirm('모든 메시지를 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.')) {
                scenarioData.messages = [];
                currentMessageId = 1;
                updateMessagesList();
                updateStatus('모든 메시지가 삭제되었습니다.');
            }
        }

        // 시나리오 저장 (로컬 스토리지)
        function saveScenario() {
            try {
                localStorage.setItem('chat_scenario_data', JSON.stringify(scenarioData));
                updateStatus('시나리오가 로컬에 저장되었습니다.');
            } catch (error) {
                alert('저장 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 시나리오 불러오기
        function loadScenario() {
            try {
                // 먼저 로컬 스토리지에서 시도
                const localData = localStorage.getItem('chat_scenario_data');
                if (localData) {
                    scenarioData = JSON.parse(localData);
                    loadDataToForm();
                    updateStatus('로컬 저장된 시나리오를 불러왔습니다.');
                } else {
                    // 기본 시나리오 파일에서 로드
                    fetch('assets/scenarios/chat_story.json')
                        .then(response => response.json())
                        .then(data => {
                            scenarioData = data;
                            loadDataToForm();
                            updateStatus('기본 시나리오 파일을 불러왔습니다.');
                        })
                        .catch(error => {
                            updateStatus('시나리오 파일을 불러올 수 없습니다.');
                            console.error('Error loading scenario:', error);
                        });
                }
            } catch (error) {
                updateStatus('데이터 로드 중 오류가 발생했습니다.');
                console.error('Error:', error);
            }
        }

        // 데이터를 폼에 로드
        function loadDataToForm() {
            if (scenarioData.metadata) {
                document.getElementById('gameTitle').value = scenarioData.metadata.title || '';
                if (scenarioData.metadata.character) {
                    document.getElementById('characterName').value = scenarioData.metadata.character.name || '';
                    document.getElementById('characterAge').value = scenarioData.metadata.character.age || '';
                    document.getElementById('characterRelation').value = scenarioData.metadata.character.relationship || '';
                    document.getElementById('characterPersonality').value = scenarioData.metadata.character.personality || '';
                    document.getElementById('initialAffection').value = scenarioData.metadata.character.initialAffection || 75;
                }
                document.getElementById('gameSetting').value = scenarioData.metadata.setting || '';
            }
            
            if (scenarioData.messages && scenarioData.messages.length > 0) {
                currentMessageId = Math.max(...scenarioData.messages.map(msg => msg.id)) + 1;
            }
            
            updateMessagesList();
        }

        // JSON 내보내기
        function exportScenario() {
            const jsonData = JSON.stringify(scenarioData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chat_story.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateStatus('시나리오 JSON 파일을 다운로드했습니다.');
        }

        // AI 서버 관리 기능
        let serverUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://your-server-domain.com';
        
        let adminPassword = '';
        let serverConnected = false;
        
        // 서버 연결
        async function connectToServer() {
            const password = document.getElementById('adminPassword').value;
            if (!password) {
                alert('관리자 비밀번호를 입력해주세요.');
                return;
            }
            
            adminPassword = password;
            document.getElementById('serverStatus').style.display = 'block';
            document.getElementById('serverStatusText').textContent = '서버 연결 중...';
            
            try {
                // 서버 상태 확인
                const healthResponse = await fetch(`${serverUrl}/health`);
                if (!healthResponse.ok) {
                    throw new Error('Server not responding');
                }
                
                // 관리자 인증 확인
                const settingsResponse = await fetch(`${serverUrl}/api/admin/settings`, {
                    headers: {
                        'admin-password': adminPassword
                    }
                });
                
                if (!settingsResponse.ok) {
                    throw new Error('Authentication failed');
                }
                
                const data = await settingsResponse.json();
                serverConnected = true;
                
                document.getElementById('serverStatusText').textContent = '✅ 서버 연결 성공!';
                document.getElementById('aiSettings').style.display = 'block';
                
                // 현재 설정 로드
                loadAISettings(data.settings);
                loadServerStats(data.stats);
                
                updateStatus('AI 서버에 연결되었습니다.');
                
            } catch (error) {
                document.getElementById('serverStatusText').textContent = '❌ 연결 실패: ' + error.message;
                serverConnected = false;
            }
        }
        
        // AI 설정 로드
        function loadAISettings(settings) {
            document.getElementById('aiModel').value = settings.model || 'gpt-3.5-turbo';
            document.getElementById('aiTemperature').value = settings.temperature || 0.8;
            document.getElementById('aiMaxTokens').value = settings.max_tokens || 150;
            document.getElementById('aiSystemPrompt').value = settings.system_prompt || '';
        }
        
        // 서버 통계 로드
        function loadServerStats(stats) {
            document.getElementById('totalRequests').textContent = stats.totalRequests || 0;
            document.getElementById('totalTokens').textContent = stats.totalTokensUsed || 0;
            document.getElementById('uniqueUsers').textContent = stats.uniqueUsers || 0;
            document.getElementById('uptime').textContent = stats.uptimeFormatted || '-';
        }
        
        // AI 설정 업데이트
        async function updateAISettings() {
            if (!serverConnected) {
                alert('먼저 서버에 연결해주세요.');
                return;
            }
            
            const settings = {
                model: document.getElementById('aiModel').value,
                temperature: parseFloat(document.getElementById('aiTemperature').value),
                max_tokens: parseInt(document.getElementById('aiMaxTokens').value),
                system_prompt: document.getElementById('aiSystemPrompt').value
            };
            
            try {
                const response = await fetch(`${serverUrl}/api/admin/settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'admin-password': adminPassword
                    },
                    body: JSON.stringify(settings)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update settings');
                }
                
                const data = await response.json();
                updateStatus('AI 설정이 업데이트되었습니다.');
                
                // 알림 표시
                alert('AI 설정이 성공적으로 저장되었습니다!');
                
            } catch (error) {
                alert('설정 저장 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        // 통계 새로고침
        async function refreshStats() {
            if (!serverConnected) {
                alert('먼저 서버에 연결해주세요.');
                return;
            }
            
            try {
                const response = await fetch(`${serverUrl}/api/admin/stats`, {
                    headers: {
                        'admin-password': adminPassword
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch stats');
                }
                
                const data = await response.json();
                loadServerStats(data.stats);
                updateStatus('서버 통계를 새로고침했습니다.');
                
            } catch (error) {
                alert('통계 로드 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 메시지 편집 (간단한 구현)
        function editMessage(messageId) {
            const message = scenarioData.messages.find(msg => msg.id === messageId);
            if (message) {
                const newText = prompt('메시지 내용을 수정하세요:', message.text || message.prompt);
                if (newText !== null) {
                    if (message.text !== undefined) {
                        message.text = newText;
                    } else if (message.prompt !== undefined) {
                        message.prompt = newText;
                    }
                    updateMessagesList();
                    updateStatus(`메시지 ID ${messageId}가 수정되었습니다.`);
                }
            }
        }
    </script>
</body>
</html>