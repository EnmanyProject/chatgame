<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ ì˜¨ë¼ì¸ ê´€ë¦¬ ì‹œìŠ¤í…œ - ì±„íŒ… ê¸°ìˆ  í›ˆë ¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .admin-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .header p {
            color: #7f8c8d;
            font-size: 1.1em;
        }

        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            background: #f8f9fa;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e9ecef;
        }

        .nav-tab .badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e74c3c;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8em;
        }

        /* ì½˜í…ì¸  ì„¹ì…˜ */
        .content-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 30px;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* í†µê³„ ì¹´ë“œ */
        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .stat-card h3 {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .stat-card .value {
            color: #2c3e50;
            font-size: 2em;
            font-weight: bold;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102,126,234,0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        /* ì˜ˆì‹œ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
        .examples-container {
            margin-top: 8px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
        }
        .examples-label {
            font-size: 12px;
            color: #6c757d;
            font-weight: 500;
            margin-bottom: 8px;
            display: block;
        }
        .examples-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .example-tag {
            display: inline-block;
            padding: 4px 8px;
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 12px;
            font-size: 11px;
            color: #495057;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
            line-height: 1.2;
        }
        .example-tag:hover {
            background: #007bff;
            color: white;
            border-color: #007bff;
            transform: translateY(-1px);
        }
        .example-tag.selected {
            background: #28a745;
            color: white;
            border-color: #28a745;
            transform: scale(0.95);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-warning {
            background: #f39c12;
            color: white;
        }

        /* ì‹œë‚˜ë¦¬ì˜¤ ê·¸ë¦¬ë“œ */
        .scenarios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .scenario-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border: 2px solid transparent;
        }

        .scenario-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .scenario-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .scenario-card .description {
            color: #7f8c8d;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .scenario-card .metadata {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        .tag {
            background: #f0f2ff;
            color: #667eea;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.85em;
        }

        .scenario-card .actions {
            display: flex;
            gap: 10px;
        }

        .scenario-card .actions button {
            flex: 1;
            padding: 8px;
            font-size: 0.9em;
        }

        /* ì—í”¼ì†Œë“œ ê·¸ë¦¬ë“œ */
        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .episode-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border: 2px solid transparent;
        }

        .episode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .episode-card.empty {
            border: 2px dashed #e0e0e0;
            background: #fafafa;
        }

        .episode-card.empty:hover {
            border-color: #667eea;
            background: white;
        }

        .episode-card .episode-number {
            font-size: 1.5em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .episode-card.completed {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: white;
        }

        .episode-card.completed .episode-number {
            color: white;
        }

        /* ë‚œì´ë„ íƒ­ */
        .difficulty-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
        }

        .difficulty-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .difficulty-tab:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .difficulty-tab.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        /* ìºë¦­í„° ê·¸ë¦¬ë“œ */
        .characters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .character-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .character-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            border-color: #667eea;
        }

        .character-image {
            width: 80px;
            height: 80px;
            margin-bottom: 15px;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }

        .character-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .character-image .no-image {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: bold;
            border-radius: 50%;
        }

        .character-info {
            text-align: center;
            width: 100%;
        }

        .character-card .mbti {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            margin-bottom: 10px;
            font-size: 0.85em;
        }

        .character-card h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .character-card .traits {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 25px;
            border-radius: 15px 15px 0 0;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5em;
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .modal-footer {
            background: #f5f5f5;
            padding: 20px 30px;
            border-radius: 0 0 15px 15px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        .close {
            color: white;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        }

        .close:hover {
            opacity: 1;
        }

        /* AI ì»¨í…ìŠ¤íŠ¸ */
        .ai-context {
            background: #f8f9ff;
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            min-height: 100px;
        }

        /* ëŒ€í™” ë¯¸ë¦¬ë³´ê¸° */
        .dialogue-preview {
            background: #f8f9ff;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .dialogue-text {
            color: #2c3e50;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .narration-text {
            color: #7f8c8d;
            font-style: italic;
            margin-bottom: 15px;
        }

        .choices-list {
            list-style: none;
        }

        .choice-item {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .choice-item .impact {
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: 0.85em;
        }

        /* ìºë¦­í„° ì„ íƒê¸° */
        .character-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .character-option {
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .character-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .character-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        /* ë¡œë”© */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 60px;
            background: #f8f9fa;
            border-radius: 15px;
            border: 2px dashed #e0e0e0;
        }

        .empty-state h3 {
            color: #7f8c8d;
            margin-bottom: 20px;
        }

        .empty-state p {
            color: #95a5a6;
            margin-bottom: 30px;
        }

        /* ì§„í–‰ë°” */
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .episodes-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .scenarios-grid {
                grid-template-columns: 1fr;
            }
            
            .characters-grid {
                grid-template-columns: 1fr;
            }
        }

        /* AI ê´€ë¦¬ ì‹œìŠ¤í…œ ìŠ¤íƒ€ì¼ */
        .ai-tuning-container {
            margin-top: 30px;
        }

        .ai-tuning-container h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }

        .tuning-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 5px solid #667eea;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }

        .tuning-section h4 {
            color: #495057;
            margin-bottom: 20px;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .tuning-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tuning-controls .form-group {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e9ecef;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .tuning-controls .form-group label {
            display: block;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .tuning-controls .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            background: white;
            font-size: 0.95em;
            transition: all 0.3s ease;
        }

        .tuning-controls .form-group select:focus {
            border-color: #667eea;
            outline: none;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-help {
            display: block;
            color: #6c757d;
            font-size: 0.85em;
            margin-top: 5px;
            line-height: 1.4;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin: 30px 0;
            justify-content: center;
            flex-wrap: wrap;
        }

        .test-results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #28a745;
        }

        .test-results h4 {
            color: #495057;
            margin-bottom: 15px;
        }

        .ai-performance-log {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-top: 30px;
        }

        .ai-performance-log h4 {
            color: #495057;
            margin-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
        }

        .log-entry {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.9em;
        }

        .log-entry:last-child {
            border-bottom: none;
        }

        .log-time {
            color: #6c757d;
            font-weight: 600;
            min-width: 50px;
        }

        .log-type {
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.8em;
            font-weight: 600;
            min-width: 80px;
            text-align: center;
        }

        .log-type.success {
            background: #d1ecf1;
            color: #0c5460;
        }

        .log-type.info {
            background: #d4edda;
            color: #155724;
        }

        .log-type.warning {
            background: #fff3cd;
            color: #856404;
        }

        .log-message {
            color: #495057;
            flex: 1;
        }

        /* AI ìºë¦­í„° ìƒì„±ê¸° ì „ìš© ìŠ¤íƒ€ì¼ */
        .ai-character-generator .modal-content {
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .char-category {
            margin-bottom: 20px;
            padding: 25px;
            border: 2px solid #e1e5e9;
            border-radius: 20px;
            background: linear-gradient(135deg, #fdf7f9 0%, #fef9fc 100%);
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .char-category:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }

        .char-category h3 {
            color: #d63384;
            margin-bottom: 15px;
            font-size: 18px;
            font-weight: bold;
        }

        .category-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .appearance-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .genre-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        /* MBTI ì„ íƒ ë²„íŠ¼ */
        .mbti-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .mbti-btn {
            padding: 15px 10px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .mbti-btn:hover {
            border-color: #d63384;
            background: #fdf2f8;
        }

        .mbti-btn.selected {
            border-color: #d63384;
            background: #d63384;
            color: white;
        }

        .mbti-btn small {
            display: block;
            font-size: 11px;
            font-weight: normal;
            opacity: 0.8;
        }

        /* ì„±ê²© íŠ¹ì„± ë²„íŠ¼ */
        .trait-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .trait-btn {
            padding: 10px 8px;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 13px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .trait-btn:hover {
            border-color: #fd7e14;
            background: #fff3cd;
        }

        .trait-btn.selected {
            border-color: #fd7e14;
            background: #fd7e14;
            color: white;
        }

        /* ê´€ê³„ ì„¤ì • ë²„íŠ¼ */
        .relationship-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .relationship-btn {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .relationship-btn:hover {
            border-color: #e83e8c;
            background: #f8d7da;
        }

        .relationship-btn.selected {
            border-color: #e83e8c;
            background: #e83e8c;
            color: white;
        }

        /* ì·¨ë¯¸ ì„ íƒ ë²„íŠ¼ */
        .hobby-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-bottom: 15px;
        }

        .hobby-btn {
            padding: 10px 8px;
            border: 1px solid #dee2e6;
            border-radius: 15px;
            background: white;
            cursor: pointer;
            font-size: 12px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .hobby-btn:hover {
            border-color: #20c997;
            background: #d1ecf1;
        }

        .hobby-btn.selected {
            border-color: #20c997;
            background: #20c997;
            color: white;
        }

        /* ë§íˆ¬ ìŠ¤íƒ€ì¼ ë²„íŠ¼ */
        .speech-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .speech-btn {
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 13px;
        }

        .speech-btn:hover {
            border-color: #6f42c1;
            background: #f8f9fa;
        }

        .speech-btn.selected {
            border-color: #6f42c1;
            background: #6f42c1;
            color: white;
        }

        /* AI ìƒì„± ì˜ì—­ */
        .ai-generation {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #6c757d;
        }

        .ai-controls {
            text-align: center;
            margin-bottom: 15px;
        }

        .btn-ai {
            background: linear-gradient(45deg, #6f42c1, #e83e8c);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-ai:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(111, 66, 193, 0.3);
        }

        .generation-status {
            margin-top: 10px;
            font-style: italic;
            color: #6c757d;
        }

        .generated-preview {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #dee2e6;
        }

        /* ë°˜ì‘í˜• ì¡°ì • */
        @media (max-width: 768px) {
            .ai-character-generator .modal-content {
                max-width: 95%;
                margin: 2% auto;
            }
            
            .category-grid {
                grid-template-columns: 1fr;
            }
            
            .mbti-options {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .trait-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .relationship-options {
                grid-template-columns: 1fr;
            }
            
            .hobby-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .speech-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        /* Episode Preview Modal Styles */
        .preview-section {
            margin-bottom: 25px;
        }

        .preview-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #667eea;
        }

        .metadata-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .metadata-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .metadata-label {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 5px;
        }

        .metadata-value {
            font-weight: bold;
            color: #333;
        }

        .dialogue-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .character-message {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
            font-size: 1.1em;
            line-height: 1.5;
        }

        .narration {
            background: #e3f2fd;
            padding: 12px;
            border-radius: 8px;
            font-style: italic;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .choices-container {
            display: grid;
            gap: 10px;
        }

        .choice-preview {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .choice-preview:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .choice-text {
            flex: 1;
            font-weight: 500;
        }

        .choice-impact {
            margin-left: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .impact-positive {
            background: #e8f5e8;
            color: #2e7d32;
        }

        .impact-negative {
            background: #ffebee;
            color: #c62828;
        }

        .impact-neutral {
            background: #f5f5f5;
            color: #666;
        }

        /* API Settings Styles */
        .api-settings-container {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
        }

        .api-key-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .api-key-input-group input {
            flex: 1;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        .api-key-input-group button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .api-key-input-group button:hover {
            background: #5a67d8;
        }

        .form-help {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
            display: block;
        }

        .test-results {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }

        .test-results.success {
            border-left-color: #28a745;
            background: #f8fff9;
        }

        .test-results.error {
            border-left-color: #dc3545;
            background: #fff8f8;
        }

        .api-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .api-info h4 {
            color: #333;
            margin-bottom: 15px;
        }

        .api-info ol, .api-info ul {
            padding-left: 20px;
        }

        .api-info li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .api-info a {
            color: #667eea;
            text-decoration: none;
        }

        .api-info a:hover {
            text-decoration: underline;
        }

        .api-usage-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .api-usage-info h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }

        .status-connected {
            color: #28a745;
            font-weight: bold;
        }

        .status-disconnected {
            color: #dc3545;
            font-weight: bold;
        }

        .status-warning {
            color: #ffc107;
            font-weight: bold;
        }

        .status-unknown {
            color: #6c757d;
            font-weight: bold;
        }

        .status-testing {
            color: #17a2b8;
            font-weight: bold;
        }

        /* API ì‚¬ìš©ëŸ‰ í‘œì‹œ ê°œì„  */
        #apiUsage {
            font-size: 0.9em;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="header">
            <h1>ğŸ® í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <p>MBTI ë¡œë§¨ìŠ¤ ê²Œì„ì˜ ì‹œë‚˜ë¦¬ì˜¤, ì—í”¼ì†Œë“œ, ìºë¦­í„°ë¥¼ í•œ ê³³ì—ì„œ ê´€ë¦¬í•©ë‹ˆë‹¤</p>

            <!-- ë°ì´í„° ê´€ë¦¬ ë²„íŠ¼ë“¤ -->
            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button onclick="resetAllDataWithConfirm()"
                        style="background: linear-gradient(135deg, #e74c3c, #c0392b); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(231,76,60,0.3);">
                    ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                </button>
                <button onclick="window.onlineDataClient.resetCharacters().then(() => { alert('âœ… ìºë¦­í„° ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ'); loadCharacters(); }).catch(err => alert('âŒ ì˜¤ë¥˜: ' + err.message))"
                        style="background: linear-gradient(135deg, #f39c12, #e67e22); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(243,156,18,0.3);">
                    ğŸ‘¥ ìºë¦­í„°ë§Œ ì´ˆê¸°í™”
                </button>
                <button onclick="window.onlineDataClient.resetScenarios().then(() => { alert('âœ… ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ'); loadScenarios(); }).catch(err => alert('âŒ ì˜¤ë¥˜: ' + err.message))"
                        style="background: linear-gradient(135deg, #9b59b6, #8e44ad); color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(155,89,182,0.3);">
                    ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ë§Œ ì´ˆê¸°í™”
                </button>
            </div>
        </div>

        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('characters')">
                ğŸ‘¥ ìºë¦­í„° ê´€ë¦¬
                <span class="badge" id="characterCount">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('scenarios')">
                ğŸ“š ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬
                <span class="badge" id="scenarioCount">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('episodes')">
                ğŸ“ ì—í”¼ì†Œë“œ ê´€ë¦¬
                <span class="badge" id="episodeCount">0</span>
            </button>
            <button class="nav-tab" onclick="switchTab('ai-management')">
                ğŸ§  AI ê´€ë¦¬
                <span class="badge" id="aiEngineStatus">âœ…</span>
            </button>
            <button class="nav-tab" onclick="switchTab('settings')">
                âš™ï¸ API ì„¤ì •
                <span class="badge" id="apiStatus">âŒ</span>
            </button>
        </div>

        <!-- ìºë¦­í„° ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="characters-section" class="content-section active">
            <div class="stats-row">
                <div class="stat-card">
                    <h3>ì „ì²´ ìºë¦­í„°</h3>
                    <div class="value" id="totalCharacters">0</div>
                </div>
                <div class="stat-card">
                    <h3>í™œì„± ìºë¦­í„°</h3>
                    <div class="value" id="activeCharacters">0</div>
                </div>
                <div class="stat-card">
                    <h3>AI ìƒì„± ìºë¦­í„°</h3>
                    <div class="value" id="aiGeneratedCharacters">0</div>
                </div>
                <div class="stat-card">
                    <h3>ìºë¦­í„° í‰ê·  í˜¸ê°ë„</h3>
                    <div class="value" id="avgCharacterAffection">0</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openCharacterModal('create')" style="background: linear-gradient(135deg, #e91e63, #9c27b0); font-size: 16px; padding: 15px 25px;">
                    ğŸ­âœ¨ AI ìºë¦­í„° ìƒì„±ê¸°
                </button>
                <button class="btn btn-secondary" onclick="loadCharacters()">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
                <button class="btn btn-warning" onclick="resetAllCharacters()" style="background: #ff9800; color: white;">
                    ğŸ—‘ï¸ ëª¨ë“  ë”ë¯¸ ë°ì´í„° ì‚­ì œ
                </button>
            </div>

            <div id="charactersContainer" class="characters-grid">
                <!-- ìºë¦­í„° ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>

        <!-- ì—í”¼ì†Œë“œ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="episodes-section" class="content-section">
            <div class="form-group">
                <label for="episodeScenarioSelect">ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ:</label>
                <select id="episodeScenarioSelect" onchange="loadEpisodes()">
                    <option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                </select>
                <button type="button" class="btn btn-secondary" onclick="refreshEpisodeScenarioList()" style="margin-left: 10px;">
                    ğŸ”„ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>
            
            <!-- ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ í‘œì‹œ -->
            <div id="availableScenariosList" class="scenarios-list" style="margin-bottom: 20px;">
                <h4>ğŸ“‹ ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡</h4>
                <div id="scenariosList">
                    <p class="loading-text">ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì„ ë¡œë”© ì¤‘...</p>
                </div>
            </div>

            <div id="episodeInfo" style="display: none;">
                <div class="stats-row">
                    <div class="stat-card">
                        <h3>ì „ì²´ ì—í”¼ì†Œë“œ</h3>
                        <div class="value" id="totalEpisodes">0/36</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <h3>Easy (1-9)</h3>
                        <div class="value" id="easyCount">0/9</div>
                    </div>
                    <div class="stat-card">
                        <h3>Medium (10-18)</h3>
                        <div class="value" id="mediumCount">0/9</div>
                    </div>
                    <div class="stat-card">
                        <h3>Hard (19-27)</h3>
                        <div class="value" id="hardCount">0/9</div>
                    </div>
                    <div class="stat-card">
                        <h3>Expert (28-36)</h3>
                        <div class="value" id="expertCount">0/9</div>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="openEpisodeModal('create')">
                        âœ¨ ìƒˆ ì—í”¼ì†Œë“œ ìƒì„±
                    </button>
                    <button class="btn btn-secondary" onclick="generateBulkEpisodes()">
                        ğŸš€ ì¼ê´„ ìƒì„± (AI)
                    </button>
                    <button class="btn btn-secondary" onclick="loadEpisodes()">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>

                <div class="difficulty-tabs">
                    <div class="difficulty-tab active" onclick="filterByDifficulty('all')">
                        ì „ì²´ <strong id="allCount">0</strong>
                    </div>
                    <div class="difficulty-tab" onclick="filterByDifficulty('easy')">
                        Easy <strong id="easyTabCount">0</strong>
                    </div>
                    <div class="difficulty-tab" onclick="filterByDifficulty('medium')">
                        Medium <strong id="mediumTabCount">0</strong>
                    </div>
                    <div class="difficulty-tab" onclick="filterByDifficulty('hard')">
                        Hard <strong id="hardTabCount">0</strong>
                    </div>
                    <div class="difficulty-tab" onclick="filterByDifficulty('expert')">
                        Expert <strong id="expertTabCount">0</strong>
                    </div>
                </div>

                <div id="episodesGrid" class="episodes-grid">
                    <!-- 36ê°œì˜ ì—í”¼ì†Œë“œ ì¹´ë“œê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>
            </div>
        </div>

        <!-- API ì„¤ì • ì„¹ì…˜ -->
        <div id="settings-section" class="content-section">
            <div class="stats-row">
                <div class="stat-card">
                    <h3>OpenAI API ìƒíƒœ</h3>
                    <div class="value" id="openaiStatus">âŒ ë¯¸ì—°ê²°</div>
                </div>
                <div class="stat-card">
                    <h3>API ì‚¬ìš©ëŸ‰</h3>
                    <div class="value" id="apiUsage">í™•ì¸ ì¤‘...</div>
                </div>
                <div class="stat-card">
                    <h3>ë§ˆì§€ë§‰ í…ŒìŠ¤íŠ¸</h3>
                    <div class="value" id="lastTest">ì—†ìŒ</div>
                </div>
            </div>

            <div class="api-settings-container">
                <div class="form-group">
                    <label for="openaiApiKey">ğŸ”‘ OpenAI API í‚¤:</label>
                    <div class="api-key-input-group">
                        <input type="password" id="openaiApiKey" placeholder="sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                        <button type="button" id="toggleApiKey" onclick="toggleApiKeyVisibility()">ğŸ‘ï¸</button>
                    </div>
                    <small class="form-help">API í‚¤ëŠ” ì•ˆì „í•˜ê²Œ ì•”í˜¸í™”ë˜ì–´ ì €ì¥ë©ë‹ˆë‹¤</small>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="saveApiKey()">
                        ğŸ’¾ API í‚¤ ì €ì¥
                    </button>
                    <button class="btn btn-secondary" onclick="testApiConnection()">
                        ğŸ§ª ì—°ê²° í…ŒìŠ¤íŠ¸
                    </button>
                    <button class="btn btn-warning" onclick="clearApiKey()">
                        ğŸ—‘ï¸ API í‚¤ ì‚­ì œ
                    </button>
                </div>

                <div id="apiTestResults" class="test-results" style="display: none;">
                    <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
                </div>

                <div class="api-info">
                    <h4>ğŸ“‹ API í‚¤ ì„¤ì • ë°©ë²•:</h4>
                    <ol>
                        <li><a href="https://platform.openai.com/" target="_blank">OpenAI í”Œë«í¼</a>ì—ì„œ ê³„ì •ì„ ë§Œë“¤ê³  ë¡œê·¸ì¸</li>
                        <li>API í‚¤ ì„¹ì…˜ì—ì„œ ìƒˆ API í‚¤ ìƒì„±</li>
                        <li>ìƒì„±ëœ í‚¤ë¥¼ ìœ„ ì…ë ¥ì°½ì— ë¶™ì—¬ë„£ê¸°</li>
                        <li>"API í‚¤ ì €ì¥" ë²„íŠ¼ í´ë¦­</li>
                        <li>"ì—°ê²° í…ŒìŠ¤íŠ¸" ë²„íŠ¼ìœ¼ë¡œ ì •ìƒ ì‘ë™ í™•ì¸</li>
                    </ol>
                    
                    <div class="api-usage-info">
                        <h4>ğŸ’° ì‚¬ìš© ìš”ê¸ˆ:</h4>
                        <ul>
                            <li><strong>GPT-4o-mini</strong>: ìºë¦­í„° ìƒì„±, ì§ˆë¬¸ ìƒì„± (ì €ë ´)</li>
                            <li><strong>GPT-4o Vision</strong>: ì´ë¯¸ì§€ ë¶„ì„ (ì¤‘ê°„ ê°€ê²©)</li>
                            <li>ëŒ€ë¶€ë¶„ì˜ ì‘ì—…ì€ ëª‡ ì„¼íŠ¸ì—ì„œ ëª‡ ë‹¬ëŸ¬ ìˆ˜ì¤€</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="ai-management-section" class="content-section">
            <div class="stats-row">
                <div class="stat-card">
                    <h3>ğŸ§  AI ì—”ì§„ ìƒíƒœ</h3>
                    <div class="value" id="aiEngineCurrentStatus">ì •ìƒ</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ“Š ì˜¤ëŠ˜ ìƒì„±ëŸ‰</h3>
                    <div class="value" id="todayGenerationCount">0</div>
                </div>
                <div class="stat-card">
                    <h3>ğŸ¯ í’ˆì§ˆ ì ìˆ˜</h3>
                    <div class="value" id="aiQualityScore">85%</div>
                </div>
            </div>

            <!-- AI ì„±ëŠ¥ íŠœë‹ -->
            <div class="ai-tuning-container">
                <h3>ğŸ›ï¸ AI ì„±ëŠ¥ íŠœë‹</h3>

                <!-- ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± ì„¤ì • -->
                <div class="tuning-section">
                    <h4>ğŸ“š ì‹œë‚˜ë¦¬ì˜¤ ìƒì„± í–¥ìƒ</h4>
                    <div class="tuning-controls">
                        <div class="form-group">
                            <label for="scenarioContentLength">ğŸ“ ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´ (í˜„ì¬: ê¸°ë³¸)</label>
                            <select id="scenarioContentLength">
                                <option value="basic">ê¸°ë³¸ (í˜„ì¬)</option>
                                <option value="extended" selected>í™•ì¥ (3ë°° ê¸¸ì´)</option>
                                <option value="detailed">ìƒì„¸ (5ë°° ê¸¸ì´)</option>
                            </select>
                            <small class="form-help">ì‹œë‚˜ë¦¬ì˜¤ ë°°ê²½ ì„¤ì •ê³¼ ìƒí™© ì„¤ëª…ì„ ë” í’ë¶€í•˜ê²Œ ìƒì„±</small>
                        </div>

                        <div class="form-group">
                            <label for="scenarioDepth">ğŸ­ ì‹¬ë¦¬ ë¬˜ì‚¬ ê¹Šì´</label>
                            <select id="scenarioDepth">
                                <option value="surface">í‘œë©´ì </option>
                                <option value="moderate" selected>ì ë‹¹í•¨</option>
                                <option value="deep">ê¹Šì´ ìˆìŒ</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="scenarioVariety">ğŸ² ìƒí™© ë‹¤ì–‘ì„±</label>
                            <select id="scenarioVariety">
                                <option value="focused">ì§‘ì¤‘í˜•</option>
                                <option value="balanced" selected>ê· í˜•í˜•</option>
                                <option value="diverse">ë‹¤ì–‘í˜•</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ì—í”¼ì†Œë“œ/ëŒ€í™” ìƒì„± ì„¤ì • -->
                <div class="tuning-section">
                    <h4>ğŸ’¬ ëŒ€í™” ìƒì„± í–¥ìƒ</h4>
                    <div class="tuning-controls">
                        <div class="form-group">
                            <label for="dialogueLength">ğŸ“œ ëŒ€í™”ëŸ‰ (í˜„ì¬: ê¸°ë³¸)</label>
                            <select id="dialogueLength">
                                <option value="basic">ê¸°ë³¸ (í˜„ì¬)</option>
                                <option value="extended" selected>í™•ì¥ (5ë°° ëŒ€ì‚¬ëŸ‰)</option>
                                <option value="verbose">í’ë¶€ (10ë°° ëŒ€ì‚¬ëŸ‰)</option>
                            </select>
                            <small class="form-help">í•œ ë²ˆì˜ ìƒí˜¸ì‘ìš©ì—ì„œ ìƒì„±ë˜ëŠ” ëŒ€í™”ì˜ ì–‘ì„ ëŠ˜ë¦¼</small>
                        </div>

                        <div class="form-group">
                            <label for="conversationStyle">ğŸ—£ï¸ ëŒ€í™” ìŠ¤íƒ€ì¼</label>
                            <select id="conversationStyle">
                                <option value="concise">ê°„ê²°í˜•</option>
                                <option value="natural" selected>ìì—°ìŠ¤ëŸ¬ìš´</option>
                                <option value="expressive">í‘œí˜„ë ¥ í’ë¶€</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="emotionalRange">ğŸ’ ê°ì • í‘œí˜„ ë²”ìœ„</label>
                            <select id="emotionalRange">
                                <option value="subtle">ì€ì€í•¨</option>
                                <option value="balanced" selected>ê· í˜•ìˆìŒ</option>
                                <option value="intense">ê°•ë ¬í•¨</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- MBTI ë°˜ì‘ ì‹œìŠ¤í…œ -->
                <div class="tuning-section">
                    <h4>ğŸ§© MBTI ë§ì¶¤ ë°˜ì‘ ê°œì„ </h4>
                    <div class="tuning-controls">
                        <div class="form-group">
                            <label for="mbtiAccuracy">ğŸ¯ MBTI íŠ¹ì„± ë°˜ì˜ë„</label>
                            <select id="mbtiAccuracy">
                                <option value="basic">ê¸°ë³¸ì </option>
                                <option value="enhanced" selected>í–¥ìƒëœ</option>
                                <option value="expert">ì „ë¬¸ê°€ ìˆ˜ì¤€</option>
                            </select>
                            <small class="form-help">ì‚¬ìš©ì ì…ë ¥ì„ MBTI íŠ¹ì„±ì— ë§ê²Œ ë¶„ì„í•˜ì—¬ ìºë¦­í„°ê°€ ë°˜ì‘</small>
                        </div>

                        <div class="form-group">
                            <label for="personalityConsistency">ğŸ‘¤ ì„±ê²© ì¼ê´€ì„±</label>
                            <select id="personalityConsistency">
                                <option value="flexible">ìœ ì—°í•¨</option>
                                <option value="consistent" selected>ì¼ê´€ì </option>
                                <option value="strict">ì—„ê²©í•¨</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="responseIntelligence">ğŸ§  ë°˜ì‘ ì§€ëŠ¥ë„</label>
                            <select id="responseIntelligence">
                                <option value="simple">ë‹¨ìˆœí•¨</option>
                                <option value="smart" selected>ìŠ¤ë§ˆíŠ¸</option>
                                <option value="genius">ì²œì¬ê¸‰</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- ëŒ€í™” ë°˜ë³µ ë°©ì§€ -->
                <div class="tuning-section">
                    <h4>ğŸ”„ ëŒ€í™” ë°˜ë³µ ë°©ì§€ ì‹œìŠ¤í…œ</h4>
                    <div class="tuning-controls">
                        <div class="form-group">
                            <label for="repetitionAvoidance">ğŸš« ë°˜ë³µ ë°©ì§€ ê°•ë„</label>
                            <select id="repetitionAvoidance">
                                <option value="off">ë¹„í™œì„±í™”</option>
                                <option value="mild">ì•½í•¨</option>
                                <option value="moderate" selected>ë³´í†µ</option>
                                <option value="strong">ê°•í•¨</option>
                            </select>
                            <small class="form-help">ì´ì „ ëŒ€í™”ì™€ ìœ ì‚¬í•œ íŒ¨í„´ì„ ê°ì§€í•˜ì—¬ ìƒˆë¡œìš´ ëŒ€í™” ìƒì„±</small>
                        </div>

                        <div class="form-group">
                            <label for="memoryDepth">ğŸ§  ëŒ€í™” ê¸°ì–µ ê¹Šì´</label>
                            <select id="memoryDepth">
                                <option value="short">ë‹¨ê¸° (ìµœê·¼ 3í„´)</option>
                                <option value="medium" selected>ì¤‘ê¸° (ìµœê·¼ 10í„´)</option>
                                <option value="long">ì¥ê¸° (ì„¸ì…˜ ì „ì²´)</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="creativityBoost">âœ¨ ì°½ì˜ì„± ë¶€ìŠ¤íŠ¸</label>
                            <select id="creativityBoost">
                                <option value="conservative">ë³´ìˆ˜ì </option>
                                <option value="balanced" selected>ê· í˜•ì </option>
                                <option value="creative">ì°½ì˜ì </option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI ì„¤ì • ì ìš© ë²„íŠ¼ -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="applyAISettings()">
                    ğŸš€ AI ì„¤ì • ì ìš©
                </button>
                <button class="btn btn-secondary" onclick="testAIGeneration()">
                    ğŸ§ª AI ìƒì„± í…ŒìŠ¤íŠ¸
                </button>
                <button class="btn btn-warning" onclick="resetAISettings()">
                    ğŸ”„ ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                </button>
            </div>

            <!-- AI ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼ -->
            <div id="aiTestResults" class="test-results" style="display: none;">
                <h4>ğŸ§ª AI ìƒì„± í…ŒìŠ¤íŠ¸ ê²°ê³¼</h4>
                <div id="testResultContent"></div>
            </div>

            <!-- AI ì„±ëŠ¥ ë¡œê·¸ -->
            <div class="ai-performance-log">
                <h4>ğŸ“ˆ AI ì„±ëŠ¥ ë¡œê·¸</h4>
                <div id="performanceLogContent">
                    <div class="log-entry">
                        <span class="log-time">14:30</span>
                        <span class="log-type success">ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±</span>
                        <span class="log-message">ìƒˆë¡œìš´ ë¡œë§¨ìŠ¤ ì‹œë‚˜ë¦¬ì˜¤ "ì¹´í˜ì—ì„œì˜ ë§Œë‚¨" ìƒì„± ì™„ë£Œ</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">14:25</span>
                        <span class="log-type info">ëŒ€í™” ìƒì„±</span>
                        <span class="log-message">INFP ìºë¦­í„° ëŒ€í™” 5í„´ ìƒì„±, í’ˆì§ˆ ì ìˆ˜: 87%</span>
                    </div>
                    <div class="log-entry">
                        <span class="log-time">14:20</span>
                        <span class="log-type warning">ë°˜ë³µ ê°ì§€</span>
                        <span class="log-message">ìœ ì‚¬í•œ ëŒ€í™” íŒ¨í„´ ê°ì§€ë¨, ìƒˆë¡œìš´ ë³€í˜• ìƒì„±</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬ ì„¹ì…˜ -->
        <div id="scenarios-section" class="content-section">
            <div class="stats-row">
                <div class="stat-card">
                    <h3>ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤</h3>
                    <div class="value" id="totalScenarios">0</div>
                </div>
                <div class="stat-card">
                    <h3>í™œì„± ì‹œë‚˜ë¦¬ì˜¤</h3>
                    <div class="value" id="activeScenarios">0</div>
                </div>
                <div class="stat-card">
                    <h3>AI ìƒì„± ì‹œë‚˜ë¦¬ì˜¤</h3>
                    <div class="value" id="aiGeneratedScenarios">0</div>
                </div>
                <div class="stat-card">
                    <h3>ì—í”¼ì†Œë“œ ìˆ˜</h3>
                    <div class="value" id="totalDialogues">0</div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="btn btn-primary" onclick="openScenarioModal('create')" style="background: linear-gradient(135deg, #667eea, #764ba2); font-size: 16px; padding: 15px 25px;">
                    âœ¨ ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°
                </button>
                <button class="btn btn-secondary" onclick="loadScenarios()">
                    ğŸ”„ ìƒˆë¡œê³ ì¹¨
                </button>
            </div>

            <div id="scenariosContainer" class="scenarios-grid">
                <!-- ì‹œë‚˜ë¦¬ì˜¤ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
        </div>
    </div>

    <!-- ì‹œë‚˜ë¦¬ì˜¤ ëª¨ë‹¬ -->
    <div id="scenarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('scenarioModal')">&times;</span>
                <h2 id="scenarioModalTitle">ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°</h2>
            </div>
            <div class="modal-body">
                <form id="scenarioForm">
                    <input type="hidden" id="scenarioId" />
                    
                    <div class="form-group">
                        <label for="scenarioTitle">ì‹œë‚˜ë¦¬ì˜¤ ì œëª© *</label>
                        <input type="text" id="scenarioTitle" required placeholder="í´ë¦­í•´ì„œ ì˜ˆì‹œ ì„ íƒ" />
                        <div class="examples-container">
                            <span class="examples-label">ì˜ˆì‹œ:</span>
                            <div class="examples-grid">
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ì–´ì œ ë°¤ì˜ ê¸°ì–µ</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ìš´ëª…ì˜ ë§Œë‚¨</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë„ì„œê´€ì˜ ì†ì‚­ì„</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ì¹´í˜ì˜ íŠ¹ë³„í•œ ì†ë‹˜</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ì²« ëˆˆì´ ë‚´ë¦° ë‚ </span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë²šê½ƒì´ í©ë‚ ë¦¬ë˜ ìˆœê°„</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ìš°ì—°í•œ ì¬íšŒ</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë‹¬ë¹› ì•„ë˜ì˜ ê³ ë°±</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ì§€ê¸ˆ ì´ ìˆœê°„</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë„ˆì—ê²Œ ë‹¿ê¸°ë¥¼</span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë§ˆì§€ë§‰ ì—¬ë¦„ë‚ </span>
                                <span class="example-tag" onclick="fillExample('scenarioTitle', this)">ë¹„ ì˜¤ëŠ” ë‚ ì˜ ìš°ì‚°</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="scenarioDescription">ì‹œë‚˜ë¦¬ì˜¤ ì„¤ëª… *</label>
                        <textarea id="scenarioDescription" required placeholder="í´ë¦­í•´ì„œ ì˜ˆì‹œ ì„ íƒ"></textarea>
                        <div class="examples-container">
                            <span class="examples-label">ì˜ˆì‹œ:</span>
                            <div class="examples-grid">
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ì·¨í•œ ìƒíƒœì—ì„œ ì§„ì‹¬ì„ ê³ ë°±í•œ í›„, ë‹¤ìŒ ë‚  ì–´ìƒ‰í•´ì§„ ë‘ ì‚¬ëŒì˜ ì´ì•¼ê¸°</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ë§¤ì¼ ê°™ì€ ì‹œê°„, ê°™ì€ ì¹´í˜ì—ì„œ ë§ˆì£¼ì¹˜ëŠ” ë‘ ì‚¬ëŒì´ ì„œë¡œì—ê²Œ ê´€ì‹¬ì„ ê°–ê²Œ ë˜ëŠ” ìƒí™©</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ë„ì„œê´€ì—ì„œ ìš°ì—°íˆ ê°™ì€ ì±…ì„ ì½ê³  ìˆë˜ ë‘ ì‚¬ëŒì´ ì¡°ê¸ˆì”© ê°€ê¹Œì›Œì§€ëŠ” ê³¼ì •</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ë™ì•„ë¦¬ MTì—ì„œ ì²˜ìŒ ë§Œë‚œ ì„ í›„ë°°ê°€ íŠ¹ë³„í•œ ê°ì •ì„ ëŠë¼ê²Œ ë˜ëŠ” ì´ì•¼ê¸°</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ë¹„ ì˜¤ëŠ” ë‚  ìš°ì‚°ì„ í•¨ê»˜ ì“°ê²Œ ëœ ë‘ ì‚¬ëŒì˜ ì„¤ë ˆëŠ” ë§Œë‚¨</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ê³¼ì œë¥¼ í•¨ê»˜ í•˜ë©´ì„œ ì„œë¡œë¥¼ ì•Œì•„ê°€ëŠ” íŒ€ì›ë“¤ì˜ ë¡œë§¨ìŠ¤</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ì¡¸ì—…ì„ ì•ë‘ê³  ë§ˆì§€ë§‰ìœ¼ë¡œ ì „í•˜ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì„ ê³ ë°±í•˜ëŠ” ìƒí™©</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ìƒˆ í•™ê¸° ì²«ë‚  ìš°ì—°íˆ ë§ˆì£¼ì¹œ ë‘ ì‚¬ëŒì˜ ì²«ì¸ìƒê³¼ ê·¸ ì´í›„ì˜ ì´ì•¼ê¸°</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ì¶•ì œ ì¤€ë¹„ë¥¼ í•˜ë©´ì„œ ìì—°ìŠ¤ëŸ½ê²Œ ê°€ê¹Œì›Œì§€ëŠ” í•™ìƒíšŒ ë©¤ë²„ë“¤ì˜ ì´ì•¼ê¸°</span>
                                <span class="example-tag" onclick="fillExample('scenarioDescription', this)">ìŠ¤í„°ë”” ê·¸ë£¹ì—ì„œ ë§Œë‚œ ë‘ ì‚¬ëŒì´ í•™ì—…ì„ í†µí•´ ë§ˆìŒì„ ë‚˜ëˆ„ê²Œ ë˜ëŠ” ê³¼ì •</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="backgroundSetting">ë°°ê²½ ì„¤ì • *</label>
                        <input type="text" id="backgroundSetting" required placeholder="í´ë¦­í•´ì„œ ì˜ˆì‹œ ì„ íƒ" />
                        <div class="examples-container">
                            <span class="examples-label">ì˜ˆì‹œ:</span>
                            <div class="examples-grid">
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ëŒ€í•™êµ ìº í¼ìŠ¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ì¡°ìš©í•œ ì¹´í˜</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ì¤‘ì•™ ë„ì„œê´€</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ë²šê½ƒì´ ë§Œë°œí•œ ê³µì›</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ê¸°ìˆ™ì‚¬ ë¼ìš´ì§€</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">í•™êµ ì¶•ì œ í˜„ì¥</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ê°•ì˜ì‹¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ëŒ€í•™ê°€ ìˆ ì§‘</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ìº í¼ìŠ¤ ë’¤ëœ°</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">í•™ìƒì‹ë‹¹</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ë™ì•„ë¦¬ì‹¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ì•¼ê°„ ìº í¼ìŠ¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ê³„ë‹¨ êµì‹¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ìŒì•…ì‹¤</span>
                                <span class="example-tag" onclick="fillExample('backgroundSetting', this)">ì˜¥ìƒ ì •ì›</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="mood">ë¶„ìœ„ê¸°/ë¬´ë“œ *</label>
                        <input type="text" id="mood" required placeholder="í´ë¦­í•´ì„œ ì˜ˆì‹œ ì„ íƒ" />
                        <div class="examples-container">
                            <span class="examples-label">ì˜ˆì‹œ:</span>
                            <div class="examples-grid">
                                <span class="example-tag" onclick="fillExample('mood', this)">ë¡œë§¨í‹±</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ì„¤ë ˜</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ë‹¬ì½¤í•¨</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ê¸´ì¥ê°</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ë“œë¼ë§ˆí‹±</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ì½”ë¯¹</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">í˜„ì‹¤ì </span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ë”°ëœ»í•¨</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ì‹ ë¹„ë¡œì›€</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ì²­ì¶˜</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ìˆœìˆ˜í•¨</span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ê°ì„±ì </span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ëª½í™˜ì </span>
                                <span class="example-tag" onclick="fillExample('mood', this)">ì•„ë ¨í•¨</span>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>ì‚¬ìš© ê°€ëŠ¥í•œ ìºë¦­í„° ì„ íƒ</label>
                        <div id="characterLoadingMsg" style="padding: 20px; text-align: center; color: #666;">
                            ìºë¦­í„° ëª©ë¡ì„ ë¡œë”© ì¤‘ì…ë‹ˆë‹¤...
                        </div>
                        <div class="character-selector" id="characterSelector" style="display: none;">
                            <!-- ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>AI ìƒì„± ì»¨í…ìŠ¤íŠ¸</label>
                        <button type="button" class="btn btn-secondary" onclick="generateAIContext()">
                            ğŸ¤– AI ì»¨í…ìŠ¤íŠ¸ ìƒì„±
                        </button>
                        <div id="aiContext" class="ai-context">
                            AIê°€ ìƒì„±í•œ ì†Œì„¤í’ ì‹œë‚˜ë¦¬ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="customContext">ì»¤ìŠ¤í…€ ì»¨í…ìŠ¤íŠ¸ (ì„ íƒì‚¬í•­)</label>
                        <textarea id="customContext" placeholder="AI ì»¨í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì§ì ‘ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('scenarioModal')">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" onclick="saveScenario()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ì—í”¼ì†Œë“œ ëª¨ë‹¬ -->
    <div id="episodeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('episodeModal')">&times;</span>
                <h2 id="episodeModalTitle">ìƒˆ ì—í”¼ì†Œë“œ ìƒì„±</h2>
            </div>
            <div class="modal-body">
                <form id="episodeForm">
                    <input type="hidden" id="episodeId" />
                    <input type="hidden" id="episodeScenarioId" />
                    
                    <div class="form-group">
                        <label for="episodeScenarioSelect">ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ *</label>
                        <select id="episodeScenarioSelect" required onchange="onScenarioChange()">
                            <option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                        <small class="form-text">ì—í”¼ì†Œë“œë¥¼ ìƒì„±í•  ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.</small>
                    </div>

                    <div class="form-group">
                        <label for="episodeNumber">ì—í”¼ì†Œë“œ ë²ˆí˜¸ (1-36) *</label>
                        <input type="number" id="episodeNumber" min="1" max="36" required />
                    </div>

                    <div class="form-group">
                        <label for="characterSelect">ìºë¦­í„° ì„ íƒ *</label>
                        <select id="characterSelect" required>
                            <option value="">ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                        <small class="form-text">ì„ íƒí•œ ì‹œë‚˜ë¦¬ì˜¤ì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ ìºë¦­í„°ë§Œ í‘œì‹œë©ë‹ˆë‹¤.</small>
                    </div>

                    <div class="form-group">
                        <label for="difficulty">ë‚œì´ë„ *</label>
                        <select id="difficulty" required>
                            <option value="easy">Easy (1-9)</option>
                            <option value="medium">Medium (10-18)</option>
                            <option value="hard">Hard (19-27)</option>
                            <option value="expert">Expert (28-36)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="userPrompt">ìƒí™© í”„ë¡¬í”„íŠ¸ *</label>
                        <textarea id="userPrompt" required placeholder="ì˜ˆ: ìš°ì—°íˆ ë„ì„œê´€ì—ì„œ ë§Œë‚œ ìƒí™©, ê¸´ì¥ê°ê³¼ ì„¤ë ˜ì´ êµì°¨í•˜ëŠ” ìˆœê°„"></textarea>
                    </div>

                    <div class="form-group">
                        <label>AI ëŒ€í™” ìƒì„±</label>
                        <button type="button" class="btn btn-secondary" onclick="generateDialogue()">
                            ğŸ¤– AI ëŒ€í™” ìƒì„±
                        </button>
                    </div>

                    <div id="dialoguePreview" class="dialogue-preview" style="display: none;">
                        <h4>ìƒì„±ëœ ëŒ€í™” ë¯¸ë¦¬ë³´ê¸°</h4>
                        <div class="dialogue-text" id="previewDialogue"></div>
                        <div class="narration-text" id="previewNarration"></div>
                        <ul class="choices-list" id="previewChoices"></ul>
                    </div>

                    <div class="form-group">
                        <label for="customDialogue">ì»¤ìŠ¤í…€ ëŒ€í™” (ì„ íƒì‚¬í•­)</label>
                        <textarea id="customDialogue" placeholder="AIê°€ ìƒì„±í•œ ëŒ€í™”ë¥¼ ìˆ˜ì •í•˜ê±°ë‚˜ ì§ì ‘ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"></textarea>
                    </div>

                    <div class="form-group">
                        <label for="customNarration">ì»¤ìŠ¤í…€ ë‚˜ë ˆì´ì…˜ (ì„ íƒì‚¬í•­)</label>
                        <textarea id="customNarration" placeholder="ìƒí™© ì„¤ëª…ì´ë‚˜ ìºë¦­í„°ì˜ í–‰ë™ì„ ë¬˜ì‚¬í•©ë‹ˆë‹¤"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('episodeModal')">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" onclick="saveEpisode()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- ìºë¦­í„° ëª¨ë‹¬ - AI í†µí•©í˜• ìƒì„± ì‹œìŠ¤í…œ -->
    <div id="characterModal" class="modal">
        <div class="modal-content ai-character-generator">
            <div class="modal-header">
                <span class="close" onclick="closeModal('characterModal')">&times;</span>
                <h2 id="characterModalTitle">ğŸ­âœ¨ ì„¸ê³„ê´€ ìµœê°• AI ìºë¦­í„° ìƒì„±ê¸°</h2>
                <p style="text-align: center; color: #666; margin-top: 5px;">ìŠ¤í¬ë¡¤í•˜ë©° ì›í•˜ëŠ” ìš”ì†Œë“¤ì„ ì„ íƒí•˜ì„¸ìš” ğŸ’–</p>
            </div>
            <div class="modal-body">
                <form id="characterForm">
                    <input type="hidden" id="characterId" />
                    
                    
                    <!-- ê¸°ë³¸ ì •ë³´ -->
                    <div class="char-category">
                        <h3>ğŸ’– ê¸°ë³¸ ì •ë³´</h3>
                        <div class="category-grid">
                            <div class="form-group">
                                <label>ìºë¦­í„° ì´ë¦„</label>
                                <input type="text" id="charName" placeholder="ì˜ˆ: ìœ¤ì•„, ìˆ˜ì§„, í˜œì›" />
                            </div>
                            <div class="form-group">
                                <label>ë‚˜ì´</label>
                                <select id="charAge">
                                    <option value="19">19ì„¸ (ëŒ€í•™ ì‹ ì…ìƒ)</option>
                                    <option value="20" selected>20ì„¸ (ëŒ€í•™ìƒ)</option>
                                    <option value="21">21ì„¸ (ëŒ€í•™ìƒ)</option>
                                    <option value="22">22ì„¸ (ëŒ€í•™ ì„ ë°°)</option>
                                    <option value="23">23ì„¸ (ëŒ€í•™ì›ìƒ)</option>
                                    <option value="24">24ì„¸ (ëŒ€í•™ì›ìƒ)</option>
                                    <option value="25">25ì„¸ (ì‚¬íšŒ ì´ˆë…„ìƒ)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ìºë¦­í„° íƒ€ì…</label>
                                <select id="charType">
                                    <option value="romance_junior">ğŸŒ¸ ë¡œë§¨ìŠ¤ í›„ë°°</option>
                                    <option value="romance_peer">ğŸ’• ë¡œë§¨ìŠ¤ ë™ê°‘</option>
                                    <option value="romance_senior">ğŸ’– ë¡œë§¨ìŠ¤ ì„ ë°°</option>
                                    <option value="childhood_friend">ğŸª ì†Œê¿‰ì¹œêµ¬</option>
                                    <option value="mysterious_girl">ğŸŒ™ ë¯¸ìŠ¤í„°ë¦¬ ì—¬ì„±</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ì„±ê²© ì„¤ì • (MBTI ê¸°ë°˜) -->
                    <div class="char-category">
                        <h3>ğŸ§  ì„±ê²© ì„¤ì •</h3>
                        <div class="mbti-selector">
                            <div class="mbti-group">
                                <label>MBTI ìœ í˜• (16ê°€ì§€ ì „ì²´)</label>
                                <div class="mbti-options">
                                    <button type="button" class="mbti-btn" data-mbti="INFP">INFP<br><small>ê°ì„±ì  ì¤‘ì¬ì</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ENFP">ENFP<br><small>í™œë°œí•œ í™œë™ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="INFJ">INFJ<br><small>ì˜¹í˜¸ì</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ENFJ">ENFJ<br><small>ì •ì˜ë¡œìš´ ì‚¬íšŒìš´ë™ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="INTJ">INTJ<br><small>ì™„ë²½í•œ ì „ëµê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ENTJ">ENTJ<br><small>ëŒ€ë‹´í•œ í†µì†”ì</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="INTP">INTP<br><small>ë…¼ë¦¬ì  ì‚¬ìƒ‰ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ENTP">ENTP<br><small>ëœ¨ê±°ìš´ í† ë¡ ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ISFP">ISFP<br><small>ëª¨í—˜ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ESFP">ESFP<br><small>ììœ ë¡œìš´ ì˜í˜¼</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ISTP">ISTP<br><small>ë§ŒëŠ¥ ì¬ì£¼ê¾¼</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ESTP">ESTP<br><small>ëª¨í—˜ì„ ì¦ê¸°ëŠ” ì‚¬ì—…ê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ISFJ">ISFJ<br><small>ì¡°ìš©í•œ ë³´í˜¸ì</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ESFJ">ESFJ<br><small>ë”°ëœ»í•œ ì‚¬êµê°€</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ISTJ">ISTJ<br><small>ì—„ê²©í•œ ê´€ë¦¬ì</small></button>
                                    <button type="button" class="mbti-btn" data-mbti="ESTJ">ESTJ<br><small>ì—„ê²©í•œ ê´€ë¦¬ì</small></button>
                                </div>
                                <input type="hidden" id="charMbti" />
                            </div>
                            <div class="personality-traits">
                                <label>ì„±ê²© íŠ¹ì„± (ìµœëŒ€ 3ê°œ ì„ íƒ)</label>
                                <div class="trait-options">
                                    <button type="button" class="trait-btn" data-trait="ê°ì„±ì ">ğŸ˜Š ê°ì„±ì </button>
                                    <button type="button" class="trait-btn" data-trait="í™œë°œí•œ">âœ¨ í™œë°œí•œ</button>
                                    <button type="button" class="trait-btn" data-trait="ë‚´í–¥ì ">ğŸŒ¸ ë‚´í–¥ì </button>
                                    <button type="button" class="trait-btn" data-trait="ì´ìƒì£¼ì˜ì ">ğŸŒ™ ì´ìƒì£¼ì˜ì </button>
                                    <button type="button" class="trait-btn" data-trait="ì°½ì˜ì ">ğŸ¨ ì°½ì˜ì </button>
                                    <button type="button" class="trait-btn" data-trait="ë°°ë ¤ì‹¬ ë§ì€">ğŸ’• ë°°ë ¤ì‹¬ ë§ì€</button>
                                    <button type="button" class="trait-btn" data-trait="ì°¨ë¶„í•œ">ğŸƒ ì°¨ë¶„í•œ</button>
                                    <button type="button" class="trait-btn" data-trait="ì—´ì •ì ">ğŸ”¥ ì—´ì •ì </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ë°°ê²½ ì„¤ì • -->
                    <div class="char-category">
                        <h3>ğŸ“ ë°°ê²½ ì„¤ì •</h3>
                        <div class="category-grid">
                            <div class="form-group">
                                <label>ì „ê³µ/ì§ì—…</label>
                                <select id="charMajor">
                                    <option value="art">ğŸ¨ ì˜ˆìˆ ëŒ€í•™ (ë¯¸ìˆ , ë””ìì¸)</option>
                                    <option value="literature">ğŸ“š ë¬¸ê³¼ëŒ€í•™ (ë¬¸í•™, ì–´í•™)</option>
                                    <option value="music">ğŸµ ìŒì•…ëŒ€í•™</option>
                                    <option value="psychology">ğŸ§  ì‹¬ë¦¬í•™ê³¼</option>
                                    <option value="education">ğŸ‘©â€ğŸ« ì‚¬ë²”ëŒ€í•™</option>
                                    <option value="nursing">ğŸ‘©â€âš•ï¸ ê°„í˜¸í•™ê³¼</option>
                                    <option value="business">ğŸ’¼ ê²½ì˜í•™ê³¼</option>
                                    <option value="media">ğŸ“º ì–¸ë¡ ì •ë³´í•™ê³¼</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ê°€ì¡± ê´€ê³„</label>
                                <select id="charFamily">
                                    <option value="only_child">ì™¸ë™ë”¸</option>
                                    <option value="older_sister">ì–¸ë‹ˆê°€ ìˆëŠ” ë§‰ë‚´</option>
                                    <option value="younger_sibling">ë™ìƒì´ ìˆëŠ” ì²«ì§¸</option>
                                    <option value="middle_child">ì¤‘ê°„ ìë…€</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì¶œì‹  ì§€ì—­</label>
                                <select id="charHometown">
                                    <option value="seoul">ì„œìš¸ ì¶œì‹ </option>
                                    <option value="busan">ë¶€ì‚° ì¶œì‹ </option>
                                    <option value="gyeonggi">ê²½ê¸°ë„ ì¶œì‹ </option>
                                    <option value="countryside">ì§€ë°© ì¶œì‹ </option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ê´€ê³„ ì„¤ì • -->
                    <div class="char-category">
                        <h3>ğŸ’ ê´€ê³„ ì„¤ì •</h3>
                        <div class="relationship-options">
                            <button type="button" class="relationship-btn" data-rel="secret_crush">ğŸ’• ëª°ë˜ ì¢‹ì•„í•˜ëŠ” í›„ë°°</button>
                            <button type="button" class="relationship-btn" data-rel="childhood_friend">ğŸª ì–´ë¦´ ë•Œë¶€í„° ì¹œí•œ ì¹œêµ¬</button>
                            <button type="button" class="relationship-btn" data-rel="senior_friend">ğŸ’– ë‹¤ì •í•œ ì„ ë°°</button>
                            <button type="button" class="relationship-btn" data-rel="classmate">ğŸ‘« ê°™ì€ ê³¼ ë™ê¸°</button>
                            <button type="button" class="relationship-btn" data-rel="club_mate">ğŸ¯ ë™ì•„ë¦¬ ì„ í›„ë°°</button>
                            <button type="button" class="relationship-btn" data-rel="neighbor">ğŸ  ì˜†ì§‘ ì´ì›ƒ</button>
                        </div>
                        <input type="hidden" id="charRelationship" />
                    </div>

                    <!-- ì™¸ëª¨ ì„¤ì • -->
                    <div class="char-category">
                        <h3>âœ¨ ì™¸ëª¨ ì„¤ì •</h3>
                        <div class="appearance-grid">
                            <div class="form-group">
                                <label>í—¤ì–´ ìŠ¤íƒ€ì¼</label>
                                <select id="charHair">
                                    <option value="long_straight">ğŸŒ¸ ê¸´ ìƒë¨¸ë¦¬</option>
                                    <option value="shoulder_wave">ğŸŒŠ ì–´ê¹¨ê¸¸ì´ ì›¨ì´ë¸Œ</option>
                                    <option value="short_bob">ğŸ’‡â€â™€ï¸ ë‹¨ë°œ ë³´ë¸Œì»·</option>
                                    <option value="ponytail">ğŸ€ í¬ë‹ˆí…Œì¼</option>
                                    <option value="twin_tail">ğŸª íŠ¸ìœˆí…Œì¼</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ëˆˆ ëª¨ì–‘</label>
                                <select id="charEyes">
                                    <option value="round_cute">ğŸ˜Š ë™ê·¸ë—ê³  ê·€ì—¬ìš´</option>
                                    <option value="almond_elegant">ğŸ˜Œ ì•„ëª¬ë“œí˜• ìš°ì•„í•œ</option>
                                    <option value="cat_like">ğŸ˜¸ ê³ ì–‘ì´ ê°™ì€</option>
                                    <option value="double_eyelid">ğŸ‘ï¸ ë˜ë ·í•œ ìŒêº¼í’€</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>í‚¤/ì²´í˜•</label>
                                <select id="charBody">
                                    <option value="petite">ğŸŒ¸ ì‘ê³  ê·€ì—¬ìš´ (155-160cm)</option>
                                    <option value="average">ğŸ’• í‰ê· ì ì¸ (160-165cm)</option>
                                    <option value="tall">âœ¨ í‚¤ í° (165-170cm)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>íŒ¨ì…˜ ìŠ¤íƒ€ì¼</label>
                                <select id="charStyle">
                                    <option value="cute_casual">ğŸŒ¸ ííŠ¸ ìºì£¼ì–¼</option>
                                    <option value="feminine_lovely">ğŸ’– í˜ë¯¸ë‹Œ ëŸ¬ë¸”ë¦¬</option>
                                    <option value="natural_simple">ğŸƒ ë‚´ì¶”ëŸ´ ì‹¬í”Œ</option>
                                    <option value="elegant_chic">âœ¨ ì—˜ë ˆê°„íŠ¸ ì‹œí¬</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ë‚´ë©´/ìŠµê´€ -->
                    <div class="char-category">
                        <h3>ğŸ’« ë‚´ë©´ & ì·¨ë¯¸</h3>
                        <div class="hobby-interests">
                            <div class="form-group">
                                <label>ì·¨ë¯¸ í™œë™ (ìµœëŒ€ 3ê°œ ì„ íƒ)</label>
                                <div class="hobby-options">
                                    <button type="button" class="hobby-btn" data-hobby="reading">ğŸ“š ë…ì„œ</button>
                                    <button type="button" class="hobby-btn" data-hobby="drawing">ğŸ¨ ê·¸ë¦¼ ê·¸ë¦¬ê¸°</button>
                                    <button type="button" class="hobby-btn" data-hobby="music">ğŸµ ìŒì•… ê°ìƒ</button>
                                    <button type="button" class="hobby-btn" data-hobby="photography">ğŸ“· ì‚¬ì§„ ì´¬ì˜</button>
                                    <button type="button" class="hobby-btn" data-hobby="cooking">ğŸ³ ìš”ë¦¬</button>
                                    <button type="button" class="hobby-btn" data-hobby="exercise">ğŸƒâ€â™€ï¸ ìš´ë™</button>
                                    <button type="button" class="hobby-btn" data-hobby="travel">âœˆï¸ ì—¬í–‰</button>
                                    <button type="button" class="hobby-btn" data-hobby="movies">ğŸ¬ ì˜í™” ê°ìƒ</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>ê°€ì¹˜ê´€</label>
                                <select id="charValues">
                                    <option value="love_family">ê°€ì¡±ê³¼ ì‚¬ë‘ì„ ì¤‘ì‹œ</option>
                                    <option value="personal_growth">ê°œì¸ì  ì„±ì¥ì„ ì¶”êµ¬</option>
                                    <option value="helping_others">íƒ€ì¸ì„ ë•ëŠ” ê²ƒì„ ì¢‹ì•„í•¨</option>
                                    <option value="creative_expression">ì°½ì˜ì  í‘œí˜„ì„ ì¤‘ì‹œ</option>
                                    <option value="stability_security">ì•ˆì •ê³¼ ë³´ì•ˆì„ ì¤‘ì‹œ</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- ë§íˆ¬/ëŒ€í™” ìŠ¤íƒ€ì¼ -->
                    <div class="char-category">
                        <h3>ğŸ’¬ ë§íˆ¬ & ëŒ€í™” ìŠ¤íƒ€ì¼</h3>
                        <div class="speech-style-grid">
                            <div class="speech-options">
                                <button type="button" class="speech-btn" data-speech="soft_warm">ğŸŒ¸ ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ</button>
                                <button type="button" class="speech-btn" data-speech="bright_cheerful">âœ¨ ë°ê³  ê²½ì¾Œí•œ</button>
                                <button type="button" class="speech-btn" data-speech="gentle_caring">ğŸ’• ë‹¤ì •í•˜ê³  ë°°ë ¤ê¹Šì€</button>
                                <button type="button" class="speech-btn" data-speech="shy_cute">ğŸ˜Š ìˆ˜ì¤ê³  ê·€ì—¬ìš´</button>
                                <button type="button" class="speech-btn" data-speech="mature_elegant">ğŸ‘‘ ì„±ìˆ™í•˜ê³  ìš°ì•„í•œ</button>
                                <button type="button" class="speech-btn" data-speech="playful_fun">ğŸª ì¥ë‚œìŠ¤ëŸ½ê³  ì¬ë¯¸ìˆëŠ”</button>
                            </div>
                            <div class="form-group">
                                <label>íŠ¹ë³„í•œ ë§ë²„ë¦‡/ìŠµê´€</label>
                                <input type="text" id="charSpeechHabit" placeholder="ì˜ˆ: ì´ëª¨í‹°ì½˜ ìì£¼ ì‚¬ìš©, ~í•´ìš” ë§íˆ¬, ì›ƒì„ ë•Œ ì†ìœ¼ë¡œ ì… ê°€ë¦¬ê¸°" />
                            </div>
                            <input type="hidden" id="charSpeechStyle" />
                        </div>
                    </div>

                    <!-- ì¥ë¥´/ì‹œë‚˜ë¦¬ì˜¤ ì„¤ì • -->
                    <div class="char-category">
                        <h3>ğŸ“– ì¥ë¥´ & ì‹œë‚˜ë¦¬ì˜¤ íƒ€ì…</h3>
                        <div class="genre-grid">
                            <div class="form-group">
                                <label>ë¡œë§¨ìŠ¤ ì¥ë¥´</label>
                                <select id="charGenre">
                                    <option value="school_romance">ğŸ« í•™ì› ë¡œë§¨ìŠ¤</option>
                                    <option value="daily_romance">â˜€ï¸ ì¼ìƒ ë¡œë§¨ìŠ¤</option>
                                    <option value="sweet_romance">ğŸ¯ ë‹¬ì½¤í•œ ë¡œë§¨ìŠ¤</option>
                                    <option value="emotional_romance">ğŸ’” ê°ì„± ë¡œë§¨ìŠ¤</option>
                                    <option value="healing_romance">ğŸŒ¿ íë§ ë¡œë§¨ìŠ¤</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>ì£¼ìš” ì‹œë‚˜ë¦¬ì˜¤ ìƒí™©</label>
                                <select id="charMainSituation">
                                    <option value="confession_aftermath">ê³ ë°± í›„ ì–´ìƒ‰í•œ ìƒí™©</option>
                                    <option value="study_together">í•¨ê»˜ ê³µë¶€í•˜ëŠ” ìƒí™©</option>
                                    <option value="festival_date">ì¶•ì œ ë°ì´íŠ¸ ìƒí™©</option>
                                    <option value="rainy_day">ë¹„ ì˜¤ëŠ” ë‚  ìƒí™©</option>
                                    <option value="cafe_meeting">ì¹´í˜ì—ì„œ ë§Œë‚˜ëŠ” ìƒí™©</option>
                                    <option value="library_encounter">ë„ì„œê´€ì—ì„œ ìš°ì—°í•œ ë§Œë‚¨</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- AI ìƒì„± ì˜ì—­ -->
                    <div class="char-category ai-generation">
                        <h3>ğŸ¤– AI ìë™ ìƒì„± ì˜ì—­</h3>
                        <div class="ai-controls">
                            <button type="button" class="btn btn-ai" onclick="generateAICharacter()">
                                âœ¨ AIë¡œ ìºë¦­í„° ì™„ì„±í•˜ê¸°
                            </button>
                            <div id="aiGenerationStatus" class="generation-status"></div>
                        </div>
                        <div class="generated-preview" id="characterPreview" style="display: none;">
                            <!-- AI ìƒì„± ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸° -->
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('characterModal')">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" onclick="saveCharacter()">ğŸ’– ìºë¦­í„° ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Episode Preview Modal -->
    <div id="episodePreviewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="close" onclick="closeModal('episodePreviewModal')">&times;</span>
                <h2 id="episodePreviewTitle">ğŸ“– ì—í”¼ì†Œë“œ ë¯¸ë¦¬ë³´ê¸°</h2>
            </div>
            <div class="modal-body">
                <div id="episodePreviewContent">
                    <div class="preview-section">
                        <h3>ğŸ“‹ ì—í”¼ì†Œë“œ ì •ë³´</h3>
                        <div id="episodeMetadata" class="metadata-grid">
                            <!-- Episode metadata will be inserted here -->
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h3>ğŸ’¬ ëŒ€í™” ë‚´ìš©</h3>
                        <div id="dialogueDisplay" class="dialogue-container">
                            <div id="characterMessage" class="character-message">
                                <!-- Character message will be inserted here -->
                            </div>
                            <div id="narrationDisplay" class="narration">
                                <!-- Narration will be inserted here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="preview-section">
                        <h3>ğŸ”˜ ì„ íƒì§€</h3>
                        <div id="choicesDisplay" class="choices-container">
                            <!-- Choices will be inserted here -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('episodePreviewModal')">ë‹«ê¸°</button>
                <button type="button" class="btn btn-primary" onclick="editEpisodeFromPreview()">ìˆ˜ì •í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let scenarios = {};
        let episodes = {};
        let characters = {};
        let currentScenarioId = null;
        let currentDifficultyFilter = 'all';
        let currentMode = 'create';
        let selectedCharacters = new Set();
        let generatedDialogue = null;

        // í˜ì´ì§€ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ í†µí•© ê´€ë¦¬ ì‹œìŠ¤í…œ ì´ˆê¸°í™”');

            // API í‚¤ ìë™ ë³µì›
            restoreApiKey();

            // ì˜¨ë¼ì¸ ì‹œìŠ¤í…œìœ¼ë¡œ ì „í™˜: ë³„ë„ ì´ˆê¸°í™” ëŒ€ê¸°
            console.log('â° ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ëŒ€ê¸° ì¤‘...');
            initializeEventListeners();
        });

        // API í‚¤ ìë™ ë³µì› í•¨ìˆ˜
        function restoreApiKey() {
            try {
                const savedKeyData = localStorage.getItem('chatgame_openai_key');
                if (savedKeyData) {
                    const keyData = JSON.parse(savedKeyData);
                    const savedTime = new Date(keyData.timestamp);
                    const now = new Date();
                    const hoursDiff = (now - savedTime) / (1000 * 60 * 60);

                    // 7ì¼ ì´ë‚´ì˜ í‚¤ë§Œ ë³µì› (ë³´ì•ˆ)
                    if (hoursDiff <= 24 * 7) {
                        console.log('ğŸ”‘ ì €ì¥ëœ API í‚¤ ë³µì›:', keyData.key.substring(0, 4) + '...');

                        // ì„œë²„ì— API í‚¤ ì¬ì„¤ì •
                        fetch('/api/save-api-key', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ apiKey: keyData.key })
                        }).then(response => {
                            if (response.ok) {
                                console.log('âœ… API í‚¤ ìë™ ë³µì› ì™„ë£Œ');
                                sessionStorage.setItem('openai_api_key', keyData.key);
                                // ìƒíƒœ ì—…ë°ì´íŠ¸ (1ì´ˆ í›„)
                                setTimeout(checkApiStatus, 1000);
                            } else {
                                console.warn('âš ï¸ API í‚¤ ë³µì› ì‹¤íŒ¨');
                            }
                        }).catch(error => {
                            console.warn('âš ï¸ API í‚¤ ë³µì› ì¤‘ ì˜¤ë¥˜:', error);
                        });
                    } else {
                        console.log('â° ì €ì¥ëœ API í‚¤ê°€ ë„ˆë¬´ ì˜¤ë˜ë¨ (7ì¼ ì´ˆê³¼), ì œê±°');
                        localStorage.removeItem('chatgame_openai_key');
                    }
                } else {
                    console.log('ğŸ” ì €ì¥ëœ API í‚¤ ì—†ìŒ');
                }
            } catch (error) {
                console.error('âŒ API í‚¤ ë³µì› ì˜¤ë¥˜:', error);
            }
        }

        // ëª¨ë“  ë°ì´í„° ë¡œë“œ (LocalStorage ìš°ì„ )
        async function loadAllData() {
            console.log('ğŸ“Š í†µí•© ë°ì´í„° ë¡œë“œ ì‹œì‘...');
            
            try {
                // 1ë‹¨ê³„: LocalStorageì—ì„œ ë¡œë“œ ì‹œë„
                console.log('ğŸ”„ 1ë‹¨ê³„: LocalStorageì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„...');
                const localChars = localStorage.getItem('characters');
                const localScenarios = localStorage.getItem('scenarios');
                
                if (localChars) {
                    const parsedChars = JSON.parse(localChars);
                    if (Object.keys(parsedChars).length > 0) {
                        console.log('âœ… LocalStorageì—ì„œ ìºë¦­í„° ë¡œë“œ ì„±ê³µ:', Object.keys(parsedChars).length, 'ê°œ');
                        // ì „ì—­ ë³€ìˆ˜ì™€ window ì†ì„± ëª¨ë‘ì— ì„¤ì •
                        characters = parsedChars;
                        window.characters = parsedChars;
                        
                        const parsedScenarios = localScenarios ? JSON.parse(localScenarios) : {};
                        scenarios = parsedScenarios;
                        window.scenarios = parsedScenarios;
                        
                        displayCharacters();
                        displayScenarios();
                        updateAllStats();
                        return true;
                    }
                }
                
                // 2ë‹¨ê³„: ê¸°ì¡´ APIì—ì„œ ë¡œë“œ ì‹œë„  
                console.log('ğŸ”„ 2ë‹¨ê³„: ê¸°ì¡´ APIì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„...');
                await loadScenarios();
                await loadCharacters();
                updateAllStats();
                
                if (window.characters && Object.keys(window.characters).length > 0) {
                    console.log('âœ… ê¸°ì¡´ APIì—ì„œ ë°ì´í„° ë¡œë“œ ì„±ê³µ');
                    return true;
                }
                
                // ëª¨ë“  ë°©ë²• ì‹¤íŒ¨
                console.log('âš ï¸ ëª¨ë“  ë°ì´í„° ì†ŒìŠ¤ì—ì„œ ë¡œë“œ ì‹¤íŒ¨ - ë¹ˆ ìƒíƒœë¡œ ì‹œì‘');
                window.characters = {};
                window.scenarios = {};
                updateAllStats();
                return false;
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                // ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •
                window.characters = window.characters || {};
                window.scenarios = window.scenarios || {};
                updateAllStats();
                return false;
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initializeEventListeners() {
            // ìºë¦­í„° ì„ íƒê¸°ëŠ” ë™ì  ë¡œë”©ìœ¼ë¡œ ì´ˆê¸°í™”ë¨
            loadCharacterSelector();

            // ìƒˆë¡œìš´ AI ìºë¦­í„° ìƒì„± ì‹œìŠ¤í…œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
            initializeCharacterGeneratorEvents();

            // ESC í‚¤ë¡œ ëª¨ë‹¬ ë‹«ê¸°
            document.addEventListener('keydown', function(event) {
                if (event.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(modal => {
                        modal.style.display = 'none';
                    });
                }
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ìœ¼ë¡œ ë‹«ê¸°
            window.onclick = function(event) {
                if (event.target.className === 'modal') {
                    event.target.style.display = 'none';
                }
            }
        }
        
        // ìºë¦­í„° ì„ íƒê¸° ë™ì  ë¡œë”©
        async function loadCharacterSelector() {
            console.log('ğŸ”„ ìºë¦­í„° ì„ íƒê¸° ë¡œë”© ì‹œì‘...');
            
            try {
                const charactersData = window.characters || {};
                const characterKeys = Object.keys(charactersData);
                
                console.log('ğŸ“Š ë¡œë“œëœ ìºë¦­í„°:', characterKeys.length, 'ê°œ');
                
                const selector = document.getElementById('characterSelector');
                const loadingMsg = document.getElementById('characterLoadingMsg');
                
                if (characterKeys.length === 0) {
                    loadingMsg.innerHTML = 'âŒ ìƒì„±ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤.<br><small>ë¨¼ì € ìºë¦­í„° íƒ­ì—ì„œ ìºë¦­í„°ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</small>';
                    selector.style.display = 'none';
                    return;
                }
                
                // ìºë¦­í„° ì„ íƒ ì˜µì…˜ ìƒì„±
                let html = '';
                characterKeys.forEach(charId => {
                    const char = charactersData[charId];
                    html += `
                        <div class="character-option" data-id="${charId}">
                            ${char.name} (${char.mbti})<br>
                            <small>${char.personality_traits?.primary?.slice(0, 2).join(', ') || 'ìƒì„±ëœ ìºë¦­í„°'}</small>
                        </div>
                    `;
                });
                
                selector.innerHTML = html;
                selector.style.display = 'grid';
                loadingMsg.style.display = 'none';
                
                // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
                selector.querySelectorAll('.character-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const characterId = this.dataset.id;
                        if (selectedCharacters.has(characterId)) {
                            selectedCharacters.delete(characterId);
                            this.classList.remove('selected');
                        } else {
                            selectedCharacters.add(characterId);
                            this.classList.add('selected');
                        }
                        console.log('âœ… ì„ íƒëœ ìºë¦­í„°ë“¤:', Array.from(selectedCharacters));
                    });
                });
                
                console.log('âœ… ìºë¦­í„° ì„ íƒê¸° ë¡œë”© ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ì„ íƒê¸° ë¡œë”© ì‹¤íŒ¨:', error);
                document.getElementById('characterLoadingMsg').innerHTML = 
                    'âŒ ìºë¦­í„° ë¡œë”© ì‹¤íŒ¨<br><small>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ìºë¦­í„°ë¥¼ ë‹¤ì‹œ ìƒì„±í•´ë³´ì„¸ìš”.</small>';
            }
        }
        
        // ì—í”¼ì†Œë“œ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸° ë¡œë”©
        async function loadEpisodeScenarioSelector() {
            console.log('ğŸ”„ ì—í”¼ì†Œë“œ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸° ë¡œë”© ì‹œì‘...');
            
            try {
                // ëª¨ë“  ì†ŒìŠ¤ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° í†µí•© ë¡œë”©
                let scenariosData = {};
                
                // 1. ì „ì—­ ë³€ìˆ˜ scenarios í™•ì¸
                if (window.scenarios && Object.keys(window.scenarios).length > 0) {
                    scenariosData = { ...window.scenarios };
                    console.log('âœ… window.scenariosì—ì„œ ë¡œë”©:', Object.keys(scenariosData).length, 'ê°œ');
                }
                
                // 2. ì „ì—­ scenarios ë³€ìˆ˜ í™•ì¸
                if (typeof scenarios !== 'undefined' && Object.keys(scenarios).length > 0) {
                    scenariosData = { ...scenariosData, ...scenarios };
                    console.log('âœ… ì „ì—­ scenariosì—ì„œ ì¶”ê°€ ë¡œë”©:', Object.keys(scenariosData).length, 'ê°œ');
                }
                
                // 3. LocalStorageì—ì„œ ë¡œë”©
                const localScenarios = localStorage.getItem('scenarios');
                if (localScenarios) {
                    const parsedLocal = JSON.parse(localScenarios);
                    scenariosData = { ...scenariosData, ...parsedLocal };
                    console.log('âœ… LocalStorageì—ì„œ ì¶”ê°€ ë¡œë”©:', Object.keys(scenariosData).length, 'ê°œ');
                }
                
                // ëª¨ë“  ë³€ìˆ˜ ë™ê¸°í™”
                scenarios = scenariosData;
                window.scenarios = scenariosData;
                
                const scenarioKeys = Object.keys(scenariosData);
                console.log('ğŸ“Š ìµœì¢… ë¡œë“œëœ ì‹œë‚˜ë¦¬ì˜¤:', scenarioKeys.length, 'ê°œ');
                console.log('ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡:', scenarioKeys.map(id => `${id}: ${scenariosData[id]?.title || 'ì œëª©ì—†ìŒ'}`));
                
                const selector = document.getElementById('episodeScenarioSelect');
                if (!selector) {
                    console.error('âŒ episodeScenarioSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                    return;
                }
                
                // ê¸°ë³¸ ì˜µì…˜ ìœ ì§€
                let html = '<option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (scenarioKeys.length === 0) {
                    html += '<option value="" disabled>ìƒì„±ëœ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤</option>';
                } else {
                    scenarioKeys.forEach(scenarioId => {
                        const scenario = scenariosData[scenarioId];
                        if (scenario && scenario.title) {
                            html += `<option value="${scenarioId}">${scenario.title}</option>`;
                        } else {
                            console.warn('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ë¶ˆì™„ì „:', scenarioId, scenario);
                            html += `<option value="${scenarioId}">ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}</option>`;
                        }
                    });
                }
                
                selector.innerHTML = html;
                console.log('âœ… ì—í”¼ì†Œë“œ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸° ë¡œë”© ì™„ë£Œ');
                console.log('ğŸ” ìƒì„±ëœ HTML:', html);
                
            } catch (error) {
                console.error('âŒ ì—í”¼ì†Œë“œ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸° ë¡œë”© ì‹¤íŒ¨:', error);
                // ì—ëŸ¬ ë°œìƒ ì‹œì—ë„ ê¸°ë³¸ ì„ íƒì§€ëŠ” ì œê³µ
                const selector = document.getElementById('episodeScenarioSelect');
                if (selector) {
                    selector.innerHTML = '<option value="">ì‹œë‚˜ë¦¬ì˜¤ ë¡œë”© ì˜¤ë¥˜</option>';
                }
            }
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ ë³€ê²½ ì‹œ ìºë¦­í„° ëª©ë¡ ì—…ë°ì´íŠ¸
        function onScenarioChange() {
            const scenarioId = document.getElementById('episodeScenarioSelect').value;
            console.log('ğŸ”„ ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤:', scenarioId);
            
            const characterSelect = document.getElementById('characterSelect');
            
            if (!scenarioId) {
                characterSelect.innerHTML = '<option value="">ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                return;
            }
            
            try {
                const scenariosData = window.scenarios || {};
                const scenario = scenariosData[scenarioId];
                
                if (!scenario) {
                    characterSelect.innerHTML = '<option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</option>';
                    return;
                }
                
                console.log('ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ì‚¬ìš©ê°€ëŠ¥ ìºë¦­í„°:', scenario.available_characters);
                
                let html = '<option value="">ìºë¦­í„°ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';
                
                if (scenario.available_characters && scenario.available_characters.length > 0) {
                    const charactersData = window.characters || {};
                    
                    scenario.available_characters.forEach(charId => {
                        const character = charactersData[charId];
                        if (character) {
                            html += `<option value="${charId}">${character.name} (${character.mbti})</option>`;
                        } else {
                            // ìºë¦­í„° ì •ë³´ê°€ ì—†ëŠ” ê²½ìš° IDë§Œ í‘œì‹œ
                            html += `<option value="${charId}">${charId}</option>`;
                        }
                    });
                } else {
                    html += '<option value="" disabled>ì´ ì‹œë‚˜ë¦¬ì˜¤ì— ì‚¬ìš©ê°€ëŠ¥í•œ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤</option>';
                }
                
                characterSelect.innerHTML = html;
                
                // ìˆ¨ê²¨ì§„ í•„ë“œì—ë„ ì‹œë‚˜ë¦¬ì˜¤ ID ì„¤ì •
                document.getElementById('episodeScenarioId').value = scenarioId;
                
                console.log('âœ… ìºë¦­í„° ëª©ë¡ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ëª©ë¡ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:', error);
                characterSelect.innerHTML = '<option value="">ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</option>';
            }
        }
        
        // ì—í”¼ì†Œë“œ ì„¹ì…˜ì˜ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨
        function refreshEpisodeScenarioList() {
            console.log('ğŸ”„ ì—í”¼ì†Œë“œ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨...');
            
            // ë‘ ê³³ ëª¨ë‘ ì—…ë°ì´íŠ¸
            loadEpisodeScenarioSelector(); // ëª¨ë‹¬ìš©
            displayAvailableScenarios(); // ì—í”¼ì†Œë“œ ì„¹ì…˜ìš©
            
            // ì—í”¼ì†Œë“œ ì„¹ì…˜ì˜ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ ë“œë¡­ë‹¤ìš´ë„ ì—…ë°ì´íŠ¸
            const episodeSelect = document.getElementById('episodeScenarioSelect');
            if (episodeSelect) {
                loadEpisodeScenarioSelector().then(() => {
                    // ëª¨ë‹¬ìš© ì„ íƒê¸°ì˜ ë‚´ìš©ì„ ì—í”¼ì†Œë“œ ì„¹ì…˜ìœ¼ë¡œ ë³µì‚¬
                    const modalSelect = document.getElementById('episodeScenarioSelect');
                    if (modalSelect) {
                        episodeSelect.innerHTML = modalSelect.innerHTML;
                    }
                });
            }
        }
        
        // ì—í”¼ì†Œë“œ ì„¹ì…˜ì— ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ í‘œì‹œ
        function displayAvailableScenarios() {
            console.log('ğŸ“‹ ì—í”¼ì†Œë“œ ì„¹ì…˜ì— ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ í‘œì‹œ...');
            
            try {
                // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ë¡œë”©
                let scenariosData = window.scenarios || {};
                
                // LocalStorageì—ì„œë„ í™•ì¸
                if (Object.keys(scenariosData).length === 0) {
                    const localScenarios = localStorage.getItem('scenarios');
                    if (localScenarios) {
                        scenariosData = JSON.parse(localScenarios);
                        window.scenarios = scenariosData;
                    }
                }
                
                const scenarioKeys = Object.keys(scenariosData);
                const scenariosListDiv = document.getElementById('scenariosList');
                
                if (scenarioKeys.length === 0) {
                    scenariosListDiv.innerHTML = `
                        <div class="empty-state">
                            <p>âŒ ìƒì„±ëœ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p><small>ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ íƒ­ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</small></p>
                        </div>
                    `;
                    return;
                }
                
                let html = `<div class="scenarios-grid">`;
                scenarioKeys.forEach(scenarioId => {
                    const scenario = scenariosData[scenarioId];
                    if (scenario) {
                        html += `
                            <div class="scenario-item" onclick="selectScenarioForEpisode('${scenarioId}')">
                                <h5>${scenario.title || 'ì œëª© ì—†ìŒ'}</h5>
                                <p>${(scenario.description || '').substring(0, 100)}${scenario.description && scenario.description.length > 100 ? '...' : ''}</p>
                                <div class="scenario-meta">
                                    <span class="episode-count">${scenario.episode_count || 0}/36 ì—í”¼ì†Œë“œ</span>
                                    <span class="character-count">${scenario.available_characters ? scenario.available_characters.length : 0} ìºë¦­í„°</span>
                                </div>
                            </div>
                        `;
                    }
                });
                html += `</div>`;
                
                scenariosListDiv.innerHTML = html;
                console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ í‘œì‹œ ì™„ë£Œ:', scenarioKeys.length, 'ê°œ');
                
            } catch (error) {
                console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ í‘œì‹œ ì‹¤íŒ¨:', error);
                document.getElementById('scenariosList').innerHTML = `
                    <div class="error-state">
                        <p>âŒ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
                        <p><small>ì½˜ì†”ì„ í™•ì¸í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë³´ì„¸ìš”.</small></p>
                    </div>
                `;
            }
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ (ì—í”¼ì†Œë“œ ì„¹ì…˜ì—ì„œ)
        function selectScenarioForEpisode(scenarioId) {
            console.log('ğŸ¯ ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒë¨:', scenarioId);
            
            const episodeSelect = document.getElementById('episodeScenarioSelect');
            if (episodeSelect) {
                episodeSelect.value = scenarioId;
                loadEpisodes(); // ì—í”¼ì†Œë“œ ë¡œë”©
            }
            
            // ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ í•˜ì´ë¼ì´íŠ¸
            document.querySelectorAll('.scenario-item').forEach(item => {
                item.classList.remove('selected');
            });
            event.target.closest('.scenario-item').classList.add('selected');
        }

        // íƒ­ ì „í™˜ (ì „ì—­ í•¨ìˆ˜)
        function switchTab(tabName) {
            // ëª¨ë“  íƒ­ê³¼ ì„¹ì…˜ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));

            // ì„ íƒëœ íƒ­ê³¼ ì„¹ì…˜ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(`${tabName}-section`).classList.add('active');

            // ì—í”¼ì†Œë“œ íƒ­ ì„ íƒ ì‹œ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ì—…ë°ì´íŠ¸
            if (tabName === 'episodes') {
                populateEpisodeScenarioSelect();
            }
            
            // API ì„¤ì • íƒ­ ì„ íƒ ì‹œ ìƒíƒœ í™•ì¸
            if (tabName === 'settings') {
                checkApiStatus();
            }

            // AI ê´€ë¦¬ íƒ­ ì„ íƒ ì‹œ ì„¤ì • ë¡œë“œ
            if (tabName === 'ai-management') {
                loadAISettings();
            }
        }

        // === API ê´€ë¦¬ í•¨ìˆ˜ë“¤ ===
        
        // API í‚¤ í‘œì‹œ/ìˆ¨ê¹€ í† ê¸€
        function toggleApiKeyVisibility() {
            const input = document.getElementById('openaiApiKey');
            const button = document.getElementById('toggleApiKey');
            
            if (input.type === 'password') {
                input.type = 'text';
                button.textContent = 'ğŸ™ˆ';
            } else {
                input.type = 'password';
                button.textContent = 'ğŸ‘ï¸';
            }
        }

        // API í‚¤ ì €ì¥
        async function saveApiKey() {
            const apiKey = document.getElementById('openaiApiKey').value.trim();

            if (!apiKey) {
                showNotification('API í‚¤ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                return;
            }

            if (!apiKey.startsWith('sk-')) {
                showNotification('ìœ íš¨í•œ OpenAI API í‚¤ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤. (sk-ë¡œ ì‹œì‘í•´ì•¼ í•¨)', 'error');
                return;
            }

            try {
                console.log('ğŸ’¾ API í‚¤ ì €ì¥ ì‹œë„...');

                // API í‚¤ë¥¼ Vercel í™˜ê²½ë³€ìˆ˜ì— ì €ì¥í•˜ëŠ” API í˜¸ì¶œ
                const response = await fetch('/api/save-api-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        apiKey: apiKey
                    })
                });

                if (response.ok) {
                    const data = await response.json();

                    // ì§€ì†ì„±ì„ ìœ„í•´ localStorageì— ì•”í˜¸í™” ì €ì¥
                    const keyData = {
                        key: apiKey,
                        timestamp: new Date().toISOString(),
                        validated: data.validated || false
                    };
                    localStorage.setItem('chatgame_openai_key', JSON.stringify(keyData));

                    // ë¸Œë¼ìš°ì € ì„¸ì…˜ì—ë„ API í‚¤ ì €ì¥ (ë³´ì•ˆì„ ìœ„í•´ sessionStorage ì‚¬ìš©)
                    sessionStorage.setItem('openai_api_key', apiKey);

                    showNotification('âœ… API í‚¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n(ë¸Œë¼ìš°ì €ì— ì•ˆì „í•˜ê²Œ ì €ì¥ë˜ì–´ ë‹¤ìŒì—ë„ ìë™ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤)', 'success');

                    // ì €ì¥ í›„ ìƒíƒœ ì—…ë°ì´íŠ¸
                    checkApiStatus();

                    // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™” (ë³´ì•ˆ)
                    document.getElementById('openaiApiKey').value = '';
                } else {
                    const error = await response.json();
                    showNotification('âŒ API í‚¤ ì €ì¥ ì‹¤íŒ¨: ' + (error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'), 'error');
                }

            } catch (error) {
                console.error('API í‚¤ ì €ì¥ ì˜¤ë¥˜:', error);
                showNotification('âŒ API í‚¤ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        // API ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testApiConnection() {
            const testResults = document.getElementById('apiTestResults');
            testResults.style.display = 'block';
            testResults.className = 'test-results';
            testResults.innerHTML = '<div class="loading">ğŸ§ª API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>';
            
            // ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('openaiStatus').textContent = 'ğŸ”„ í…ŒìŠ¤íŠ¸ ì¤‘...';
            document.getElementById('openaiStatus').className = 'status-testing';

            try {
                // ì„¸ì…˜ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
                const sessionApiKey = sessionStorage.getItem('openai_api_key');
                
                // ìºë¦­í„° ìƒì„± APIë¥¼ í†µí•´ ì—°ê²° í…ŒìŠ¤íŠ¸
                const response = await fetch('/api/test-openai-connection', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-OpenAI-Key': sessionApiKey || '' // í—¤ë”ë¡œ API í‚¤ ì „ë‹¬
                    },
                    body: JSON.stringify({
                        useSessionKey: true
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    testResults.className = 'test-results success';
                    testResults.innerHTML = `
                        <h4>âœ… ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ!</h4>
                        <p><strong>ëª¨ë¸:</strong> ${data.model || 'GPT-4o-mini'}</p>
                        <p><strong>ì‘ë‹µ ì‹œê°„:</strong> ${data.responseTime || 'í™•ì¸ ì¤‘'}ms</p>
                        <p><strong>í† í° ì‚¬ìš©ëŸ‰:</strong> ${data.tokensUsed || 'í™•ì¸ ì¤‘'} tokens</p>
                        <p><strong>í…ŒìŠ¤íŠ¸ ì‹œê°„:</strong> ${new Date().toLocaleString()}</p>
                    `;
                    
                    document.getElementById('openaiStatus').textContent = 'âœ… ì—°ê²°ë¨';
                    document.getElementById('openaiStatus').className = 'status-connected';
                    document.getElementById('lastTest').textContent = new Date().toLocaleString();
                    document.getElementById('apiStatus').textContent = 'âœ…';
                } else {
                    throw new Error(data.message || 'í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('API í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                
                testResults.className = 'test-results error';
                testResults.innerHTML = `
                    <h4>âŒ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨</h4>
                    <p><strong>ì˜¤ë¥˜:</strong> ${error.message}</p>
                    <p><strong>í•´ê²° ë°©ë²•:</strong></p>
                    <ul>
                        <li>API í‚¤ê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸</li>
                        <li>OpenAI ê³„ì •ì— ì¶©ë¶„í•œ í¬ë ˆë”§ì´ ìˆëŠ”ì§€ í™•ì¸</li>
                        <li>API í‚¤ ê¶Œí•œ ì„¤ì • í™•ì¸</li>
                    </ul>
                `;
                
                document.getElementById('openaiStatus').textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                document.getElementById('openaiStatus').className = 'status-disconnected';
                document.getElementById('apiStatus').textContent = 'âŒ';
            }
        }

        // API ìƒíƒœ í™•ì¸ (ê°œì„ ëœ ë²„ì „)
        async function checkApiStatus() {
            try {
                console.log('ğŸ” API ìƒíƒœ í™•ì¸ ì‹œì‘...');

                // 1ë‹¨ê³„: API í‚¤ ì„¤ì • ìƒíƒœ í™•ì¸
                const envResponse = await fetch('/api/test-env');
                const envData = await envResponse.json();

                console.log('ğŸ“‹ í™˜ê²½ë³€ìˆ˜ ìƒíƒœ:', envData);

                const statusElement = document.getElementById('openaiStatus');
                const badgeElement = document.getElementById('apiStatus');
                const usageElement = document.getElementById('apiUsage');
                const testElement = document.getElementById('lastTest');

                console.log('ğŸ” API í‚¤ ìƒíƒœ ìƒì„¸ ì •ë³´:', envData.environment.apiKeyDetails);

                if (envData.environment.OPENAI_API_KEY === 'âœ… ì„¤ì •ë¨') {
                    console.log('âœ… API í‚¤ê°€ ì„¤ì •ë˜ì–´ ìˆìŒ, ì‚¬ìš©ëŸ‰ í™•ì¸ ì¤‘...');

                    // 2ë‹¨ê³„: API ì‚¬ìš©ëŸ‰ ë° ìœ íš¨ì„± í™•ì¸
                    try {
                        const usageResponse = await fetch('/api/openai-usage');

                        if (usageResponse.ok) {
                            const usageData = await usageResponse.json();
                            console.log('ğŸ“Š ì‚¬ìš©ëŸ‰ ë°ì´í„°:', usageData);

                            // API ìƒíƒœ ì—…ë°ì´íŠ¸
                            statusElement.textContent = `âœ… API ì—°ê²°ë¨ (${usageData.data.keyPreview})`;
                            statusElement.className = 'status-connected';
                            badgeElement.textContent = 'âœ…';

                            // ì‚¬ìš©ëŸ‰ ì •ë³´ ì—…ë°ì´íŠ¸
                            const rateLimit = usageData.data.rateLimit;
                            let usageText = `ëª¨ë¸ ${usageData.data.totalModels}ê°œ ì‚¬ìš©ê°€ëŠ¥`;

                            if (rateLimit.remainingRequests !== 'Unknown') {
                                usageText += `\nìš”ì²­ í•œë„: ${rateLimit.remainingRequests}/${rateLimit.limitRequests}`;
                            }
                            if (rateLimit.remainingTokens !== 'Unknown') {
                                usageText += `\ní† í° í•œë„: ${rateLimit.remainingTokens}/${rateLimit.limitTokens}`;
                            }

                            usageElement.innerHTML = usageText.replace(/\n/g, '<br>');
                            testElement.textContent = new Date(usageData.data.lastChecked).toLocaleString('ko-KR');

                            console.log('âœ… API ìƒíƒœ ë° ì‚¬ìš©ëŸ‰ í™•ì¸ ì™„ë£Œ');

                        } else {
                            // API í‚¤ëŠ” ìˆì§€ë§Œ ìœ íš¨í•˜ì§€ ì•ŠìŒ
                            const errorData = await usageResponse.json();
                            statusElement.textContent = `âš ï¸ API í‚¤ ì˜¤ë¥˜ (${envData.environment.keyPreview})`;
                            statusElement.className = 'status-warning';
                            badgeElement.textContent = 'âš ï¸';
                            usageElement.textContent = `ì˜¤ë¥˜: ${errorData.message}`;
                            testElement.textContent = new Date().toLocaleString('ko-KR');

                            console.warn('âš ï¸ API í‚¤ëŠ” ì„¤ì •ë˜ì–´ ìˆì§€ë§Œ ìœ íš¨í•˜ì§€ ì•ŠìŒ:', errorData.message);
                        }

                    } catch (usageError) {
                        console.warn('âš ï¸ ì‚¬ìš©ëŸ‰ í™•ì¸ ì¤‘ ì˜¤ë¥˜:', usageError);
                        statusElement.textContent = `âš ï¸ API í™•ì¸ ì‹¤íŒ¨ (${envData.environment.keyPreview})`;
                        statusElement.className = 'status-warning';
                        badgeElement.textContent = 'âš ï¸';
                        usageElement.textContent = 'ì‚¬ìš©ëŸ‰ í™•ì¸ ì‹¤íŒ¨';
                        testElement.textContent = new Date().toLocaleString('ko-KR');
                    }

                } else {
                    // API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ
                    statusElement.textContent = 'âŒ API í‚¤ ë¯¸ì„¤ì •';
                    statusElement.className = 'status-disconnected';
                    badgeElement.textContent = 'âŒ';
                    usageElement.textContent = 'API í‚¤ë¥¼ ë¨¼ì € ì„¤ì •í•´ì£¼ì„¸ìš”';
                    testElement.textContent = 'ì—†ìŒ';

                    console.log('âŒ API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                }

            } catch (error) {
                console.error('âŒ API ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
                document.getElementById('openaiStatus').textContent = 'â“ ì—°ê²° ì‹¤íŒ¨';
                document.getElementById('openaiStatus').className = 'status-unknown';
                document.getElementById('apiStatus').textContent = 'â“';
                document.getElementById('apiUsage').textContent = 'ìƒíƒœ í™•ì¸ ì‹¤íŒ¨';
                document.getElementById('lastTest').textContent = 'ì˜¤ë¥˜';
            }
        }

        // API í‚¤ ì‚­ì œ
        async function clearApiKey() {
            if (!confirm('ì •ë§ë¡œ API í‚¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                return;
            }

            try {
                const response = await fetch('/api/clear-api-key', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    // ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ì—ì„œë„ ì‚­ì œ
                    sessionStorage.removeItem('openai_api_key');
                    
                    alert('âœ… API í‚¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    checkApiStatus();
                    document.getElementById('apiTestResults').style.display = 'none';
                } else {
                    alert('âŒ API í‚¤ ì‚­ì œ ì‹¤íŒ¨');
                }
                
            } catch (error) {
                console.error('API í‚¤ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ API í‚¤ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            }
        }

        // === ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ===
        
        // ğŸš€ GitHub API ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ í•¨ìˆ˜ (í˜ì‹ ì !)
        async function saveScenarioToGitHub(scenario) {
            try {
                console.log('ğŸ™ GitHub APIë¡œ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì‹œì‘:', scenario.title);
                
                // GitHub í† í° í™•ì¸/ë¡œë“œ
                if (!GITHUB_CONFIG.token) {
                    const tokenLoaded = await loadGitHubToken();
                    if (!tokenLoaded) {
                        throw new Error('GitHub token not available');
                    }
                }
                
                // ì‹œë‚˜ë¦¬ì˜¤ ID ìƒì„± (ì—†ìœ¼ë©´)
                if (!scenario.id && !scenario.scenario_id) {
                    scenario.id = `scenario_${Date.now()}`;
                    scenario.scenario_id = scenario.id;
                    console.log('ğŸ”§ ì‹œë‚˜ë¦¬ì˜¤ ID ìƒì„±:', scenario.id);
                }
                
                // ê¸°ì¡´ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ë¡œë“œ
                const existingScenarios = await loadScenariosFromGitHub();
                console.log('ğŸ“Š ê¸°ì¡´ GitHub ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜:', Object.keys(existingScenarios).length);
                
                // ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€
                const scenarioId = scenario.id || scenario.scenario_id;
                existingScenarios[scenarioId] = {
                    ...scenario,
                    last_modified: new Date().toISOString(),
                    source: 'github_api',
                    commit_hash: 'pending'
                };
                
                // GitHubì— ì»¤ë°‹í•  ë°ì´í„° êµ¬ì¡° ìƒì„±
                const scenarioData = {
                    metadata: {
                        version: "1.0.0",
                        created_date: new Date().toISOString().split('T')[0],
                        total_scenarios: Object.keys(existingScenarios).length,
                        ai_context_engine: "claude-3.5-sonnet",
                        source: "github_api"
                    },
                    scenarios: existingScenarios,
                    scenario_templates: {
                        romance_template: {
                            mood_options: ["ì„¤ë ˜", "ë¶€ë„ëŸ¬ì›€", "ê¸´ì¥ê°", "ë‹¬ì½¤í•¨", "ì• ì ˆí•¨"],
                            setting_options: ["ì¹´í˜", "í•™êµ", "ì§‘", "ê³µì›", "ë„ì„œê´€", "ê±°ë¦¬"],
                            time_options: ["ì•„ì¹¨", "ì ì‹¬", "ì €ë…", "ë°¤", "ìƒˆë²½"]
                        }
                    }
                };
                
                // GitHub Repositoryì— ì§ì ‘ ì»¤ë°‹
                const commitMessage = `Add scenario: ${scenario.title}`;
                const commitResult = await commitToGitHub('data/scenarios/scenario-database.json', scenarioData, commitMessage);
                
                if (commitResult.success) {
                    // ì»¤ë°‹ í•´ì‹œ ì—…ë°ì´íŠ¸
                    existingScenarios[scenarioId].commit_hash = commitResult.sha;
                    
                    // ë¡œì»¬ ë°±ì—…ë„ ì €ì¥
                    localStorage.setItem('chatgame_scenarios', JSON.stringify(existingScenarios));
                    
                    console.log('âœ… GitHub API ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì™„ë£Œ! ì»¤ë°‹ SHA:', commitResult.sha);
                    console.log('ğŸ“ GitHubì— ì €ì¥ëœ ì‹œë‚˜ë¦¬ì˜¤ IDë“¤:', Object.keys(existingScenarios));
                    
                    return { success: true, commit_hash: commitResult.sha, url: commitResult.html_url };
                } else {
                    throw new Error('GitHub commit failed: ' + commitResult.error);
                }
                
            } catch (error) {
                console.error('âŒ GitHub API ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì˜¤ë¥˜:', error);
                
                // ì‹¤íŒ¨ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ í´ë°±
                console.log('ğŸ’¾ ì‹œë‚˜ë¦¬ì˜¤ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ í´ë°±...');
                return saveScenarioToLocalStorage(scenario);
            }
        }
        
        // GitHubì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ë¡œë“œ
        async function loadScenariosFromGitHub() {
            try {
                console.log('ğŸ“¥ GitHubì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ë¡œë“œ...');
                const result = await getFileFromGitHub('data/scenarios/scenario-database.json');
                
                if (result.success) {
                    const scenarioData = result.content;
                    if (scenarioData.scenarios) {
                        return scenarioData.scenarios;
                    }
                    return {};
                } else {
                    console.warn('âš ï¸ GitHub ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì‹¤íŒ¨:', result.error);
                    return {};
                }
            } catch (error) {
                console.error('âŒ GitHub ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì˜ˆì™¸:', error);
                return {};
            }
        }
        
        // ì‹œë‚˜ë¦¬ì˜¤ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í´ë°± í•¨ìˆ˜
        function saveScenarioToLocalStorage(scenario) {
            try {
                const scenarioId = scenario.id || scenario.scenario_id || `scenario_${Date.now()}`;
                const existingScenarios = JSON.parse(localStorage.getItem('chatgame_scenarios') || '{}');
                
                existingScenarios[scenarioId] = {
                    ...scenario,
                    id: scenarioId,
                    scenario_id: scenarioId,
                    last_modified: new Date().toISOString(),
                    source: 'local_storage'
                };
                
                localStorage.setItem('chatgame_scenarios', JSON.stringify(existingScenarios));
                console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì™„ë£Œ:', scenarioId);
                
                return { success: true, source: 'localStorage' };
            } catch (error) {
                console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                return { success: false, error: error.message };
            }
        }
        async function loadScenarios() {
            console.log('ğŸ“š === ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì‹œì‘ ===');
            console.log('ğŸ•’ ë¡œë“œ ì‹œê°„:', new Date().toISOString());
            
            try {
                console.log('ğŸ”„ ì‹œë‚˜ë¦¬ì˜¤ API í˜¸ì¶œ...');
                const response = await fetch('/api/scenario-manager?action=list&_t=' + Date.now());
                console.log('ğŸ“¶ API ì‘ë‹µ ìƒíƒœ:', response.status);
                
                const data = await response.json();
                console.log('ğŸ“¦ ì›ì‹œ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°:', JSON.stringify(data, null, 2));

                if (data.success) {
                    scenarios = data.scenarios || {};
                    const scenarioCount = Object.keys(scenarios).length;
                    console.log('âœ… ë¡œë“œëœ ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜:', scenarioCount);
                    
                    if (scenarioCount > 0) {
                        console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ IDë“¤:', Object.keys(scenarios));
                    } else {
                        console.log('ğŸ˜µ ë¹ˆ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡');
                    }
                    
                    displayScenarios();
                    updateScenarioStats();
                    console.log('ğŸ‰ === ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì™„ë£Œ ===');
                } else {
                    console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ API ì˜¤ë¥˜:', data.message);
                    scenarios = {};
                    displayScenarios();
                    updateScenarioStats();
                }
            } catch (error) {
                console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì˜ˆì™¸:', error);
                // í´ë°± ë°ì´í„° ì‚¬ìš©
                scenarios = {};
                displayScenarios();
                updateScenarioStats();
                console.log('ğŸ‰ === ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì™„ë£Œ (í´ë°±) ===');
            }
        }

        function displayScenarios() {
            console.log('ğŸ¨ === ì‹œë‚˜ë¦¬ì˜¤ í‘œì‹œ í•¨ìˆ˜ ì‹œì‘ ===');
            const container = document.getElementById('scenariosContainer');
            
            // window.scenarios ë˜ëŠ” ì „ì—­ scenarios ì‚¬ìš© (í˜¸í™˜ì„±)
            const scenariosData = window.scenarios || scenarios || {};
            const scenarioArray = Object.values(scenariosData);
            console.log('ğŸ“Š í‘œì‹œí•  ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜:', scenarioArray.length);
            console.log('ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ì†ŒìŠ¤:', window.scenarios ? 'window.scenarios' : 'scenarios');
            if (scenarioArray.length > 0) {
                console.log('ğŸ“‹ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡:', scenarioArray.map(s => `${s.title} (${s.id || s.scenario_id})`));
            } else {
                console.log('ğŸ“­ í‘œì‹œí•  ì‹œë‚˜ë¦¬ì˜¤ ì—†ìŒ');
            }
            
            if (scenarioArray.length === 0) {
                console.log('ğŸ“­ ì‹œë‚˜ë¦¬ì˜¤ ì—†ìŒ - ë¹ˆ ìƒíƒœ í‘œì‹œ');
                
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1 / -1;">
                        <h3>ğŸ“­ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤</h3>
                        <p>ì²« ë²ˆì§¸ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
                        <button class="btn btn-primary" onclick="openScenarioModal('create')">
                            âœ¨ ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = scenarioArray.map(scenario => `
                <div class="scenario-card">
                    <h3>${scenario.title}</h3>
                    <p class="description">${scenario.description}</p>
                    <div class="metadata">
                        ${scenario.tags ? scenario.tags.map(tag => `<span class="tag">${tag}</span>`).join('') : ''}
                        <span class="tag">ìºë¦­í„°: ${scenario.available_characters ? scenario.available_characters.length : 0}ëª…</span>
                        <span class="tag">ì—í”¼ì†Œë“œ: ${scenario.episode_count || 0}ê°œ</span>
                    </div>
                    <div class="actions">
                        <button class="btn btn-success" onclick="editScenario('${scenario.id}')">ìˆ˜ì •</button>
                        <button class="btn btn-primary" onclick="manageEpisodes('${scenario.id}')">ì—í”¼ì†Œë“œ</button>
                        <button class="btn btn-danger" onclick="deleteScenario('${scenario.id}')">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }

        function updateScenarioStats() {
            console.log('ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ í†µê³„ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            
            // window.scenarios ë˜ëŠ” ì „ì—­ scenarios ì‚¬ìš© (í˜¸í™˜ì„±)
            const scenariosData = window.scenarios || scenarios || {};
            const scenarioArray = Object.values(scenariosData);
            console.log('ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ë°°ì—´:', scenarioArray.length, 'ê°œ');
            console.log('ğŸ“Š ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° ì†ŒìŠ¤:', window.scenarios ? 'window.scenarios' : 'scenarios');
            
            // ì•ˆì „í•œ ìš”ì†Œ ì—…ë°ì´íŠ¸ (ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ)
            const safeUpdateElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    console.log(`âœ… ${id}: ${value}`);
                } else {
                    console.warn(`âš ï¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${id}`);
                }
            };
            
            // ì‹œë‚˜ë¦¬ì˜¤ í†µê³„ ì—…ë°ì´íŠ¸
            safeUpdateElement('totalScenarios', scenarioArray.length);
            safeUpdateElement('activeScenarios', scenarioArray.filter(s => s.active_status).length);
            safeUpdateElement('scenarioCount', scenarioArray.length);
            
            // AI ìƒì„± ì‹œë‚˜ë¦¬ì˜¤ ê°œìˆ˜
            const aiGeneratedCount = scenarioArray.filter(s => s.ai_generated_context && s.ai_generated_context.length > 0).length;
            safeUpdateElement('aiGeneratedScenarios', aiGeneratedCount);
            
            // ëŒ€í™”/ì—í”¼ì†Œë“œ ìˆ˜ (ì‹œë‚˜ë¦¬ì˜¤ ì„¹ì…˜ì—ëŠ” totalDialogues ì‚¬ìš©)
            const totalEpisodes = scenarioArray.reduce((sum, s) => sum + (s.episode_count || 0), 0);
            safeUpdateElement('totalDialogues', totalEpisodes);
            
            console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ');
        }

        function openScenarioModal(mode, scenarioId = null) {
            currentMode = mode;
            const modal = document.getElementById('scenarioModal');
            
            if (mode === 'create') {
                document.getElementById('scenarioModalTitle').textContent = 'ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ë§Œë“¤ê¸°';
                document.getElementById('scenarioForm').reset();
                document.getElementById('aiContext').innerHTML = 'AIê°€ ìƒì„±í•œ ì†Œì„¤í’ ì‹œë‚˜ë¦¬ì˜¤ ì»¨í…ìŠ¤íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤';
                selectedCharacters.clear();
                // ìºë¦­í„° ì„ íƒê¸°ë¥¼ ë‹¤ì‹œ ë¡œë”©í•˜ì—¬ ìµœì‹  ìºë¦­í„° ëª©ë¡ í‘œì‹œ
                loadCharacterSelector();
            } else if (mode === 'edit' && scenarioId) {
                editScenario(scenarioId);
                return;
            }
            
            modal.style.display = 'block';
        }

        function editScenario(scenarioId) {
            const scenario = scenarios[scenarioId];
            if (!scenario) return;

            currentMode = 'edit';
            document.getElementById('scenarioModalTitle').textContent = 'ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜ì •';
            document.getElementById('scenarioId').value = scenarioId;
            document.getElementById('scenarioTitle').value = scenario.title;
            document.getElementById('scenarioDescription').value = scenario.description;
            document.getElementById('backgroundSetting').value = scenario.background_setting;
            document.getElementById('mood').value = scenario.mood;
            document.getElementById('aiContext').innerHTML = scenario.ai_generated_context || '';
            document.getElementById('customContext').value = scenario.custom_context || '';

            // ìºë¦­í„° ì„ íƒ ìƒíƒœ ë³µì›
            selectedCharacters.clear();
            document.querySelectorAll('.character-option').forEach(opt => opt.classList.remove('selected'));
            
            if (scenario.available_characters) {
                scenario.available_characters.forEach(charId => {
                    selectedCharacters.add(charId);
                    document.querySelector(`.character-option[data-id="${charId}"]`)?.classList.add('selected');
                });
            }

            document.getElementById('scenarioModal').style.display = 'block';
        }

        async function saveScenario() {
            const title = document.getElementById('scenarioTitle').value;
            const description = document.getElementById('scenarioDescription').value;
            const backgroundSetting = document.getElementById('backgroundSetting').value;
            const mood = document.getElementById('mood').value;

            if (!title || !description || !backgroundSetting || !mood) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const scenarioData = {
                title,
                description,
                background_setting: backgroundSetting,
                mood,
                available_characters: Array.from(selectedCharacters)
            };

            if (currentMode === 'create') {
                // ì œëª©ì„ ê¸°ë°˜ìœ¼ë¡œ ê³ ìœ í•œ ID ìƒì„±
                const titleKey = title.toLowerCase()
                    .replace(/[^a-zA-Zê°€-í£0-9]/g, '_') // íŠ¹ìˆ˜ë¬¸ìë¥¼ _ë¡œ ë³€ê²½
                    .replace(/_+/g, '_') // ì—°ì†ëœ _ë¥¼ í•˜ë‚˜ë¡œ
                    .replace(/^_|_$/g, ''); // ì•ë’¤ _ì œê±°
                scenarioData.scenario_id = `scenario_${titleKey}_${Date.now()}`;
                scenarioData.action = 'create';
                
                console.log('ğŸ”§ ì‹œë‚˜ë¦¬ì˜¤ ID ìƒì„±:', scenarioData.scenario_id);
            } else {
                scenarioData.scenario_id = document.getElementById('scenarioId').value;
                scenarioData.action = 'update';
            }

            try {
                // ğŸš€ ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ (ì‚¬ìš©ì ê²½í—˜ ê°œì„ )
                console.log('âš¡ ì¦‰ì‹œ ë¡œì»¬ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ì—…ë°ì´íŠ¸...');
                
                // ì‹œë‚˜ë¦¬ì˜¤ ID í™•ë³´
                const scenarioId = scenarioData.scenario_id;
                
                // ë¡œì»¬ ì‹œë‚˜ë¦¬ì˜¤ ê°ì²´ì— ì¦‰ì‹œ ì¶”ê°€ (UI ë°˜ì‘ì„± ê°œì„ )
                const globalScenarios = window.scenarios || {};
                globalScenarios[scenarioId] = {
                    id: scenarioId,
                    ...scenarioData,
                    created_date: new Date().toISOString().split('T')[0],
                    episode_count: 0,
                    tags: [scenarioData.mood]
                };
                window.scenarios = globalScenarios;
                
                // ì¦‰ì‹œ í™”ë©´ ì—…ë°ì´íŠ¸
                displayScenarios();
                updateScenarioStats();
                console.log('âœ… ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸ ì™„ë£Œ');

                // ğŸ’¾ LocalStorage ì§ì ‘ ì €ì¥ (í™•ì‹¤í•œ ë°©ë²•!)
                console.log('ğŸ’¾ LocalStorageì— ì§ì ‘ ì €ì¥ ì‹œë„...');
                try {
                    // í˜„ì¬ ì €ì¥ëœ ì‹œë‚˜ë¦¬ì˜¤ë“¤ì„ ê°€ì ¸ì˜´
                    const existingScenarios = localStorage.getItem('scenarios');
                    const scenariosData = existingScenarios ? JSON.parse(existingScenarios) : {};
                    
                    // ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ì¶”ê°€/ìˆ˜ì •
                    scenariosData[scenarioId] = globalScenarios[scenarioId];
                    
                    // LocalStorageì— ì €ì¥
                    localStorage.setItem('scenarios', JSON.stringify(scenariosData));
                    console.log('âœ… LocalStorage ì €ì¥ ì„±ê³µ! ì´', Object.keys(scenariosData).length, 'ê°œ ì‹œë‚˜ë¦¬ì˜¤');
                    
                    // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€
                    const successMessage = currentMode === 'create' ? 
                        `ğŸ’– ìƒˆë¡œìš´ ì‹œë‚˜ë¦¬ì˜¤ '${title}'ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\nâœ… ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì—ì„œ í™•ì¸í•˜ì„¸ìš”!` :
                        `âœ¨ì‹œë‚˜ë¦¬ì˜¤ '${title}'ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                    
                    alert(successMessage);
                    closeModal('scenarioModal');
                    
                    // UI ìµœì¢… ì—…ë°ì´íŠ¸
                    console.log('ğŸ”„ ì €ì¥ í›„ ìµœì¢… UI ë™ê¸°í™”...');
                    await loadAllData(); // ìƒˆë¡œìš´ í†µí•© ë¡œë”© í•¨ìˆ˜ ì‚¬ìš©
                    
                    // ìºë¦­í„° ì„ íƒê¸°ë„ ê°±ì‹  (ìƒˆë¡œ ìƒì„±ëœ ìºë¦­í„° ë°˜ì˜)
                    await loadCharacterSelector();
                    
                    console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!');
                    
                } catch (storageError) {
                    console.error('âŒ LocalStorage ì €ì¥ ì‹¤íŒ¨:', storageError);
                    alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + storageError.message);
                }
            } catch (error) {
                console.error('ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì˜¤ë¥˜:', error);
                // ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ì—¬ë„ ë¡œì»¬ UIëŠ” ì´ë¯¸ ì—…ë°ì´íŠ¸ë¨
                alert('âš ï¸ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆì§€ë§Œ ë¡œì»¬ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤!\n\nì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì—ì„œ í™•ì¸í•˜ì„¸ìš”!\n\nì˜¤ë¥˜: ' + error.message);
                closeModal('scenarioModal');
            }
        }

        async function deleteScenario(scenarioId) {
            if (!confirm('ì •ë§ë¡œ ì´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nê´€ë ¨ëœ ëª¨ë“  ì—í”¼ì†Œë“œë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤.')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ì‹œì‘ (LocalStorage):', scenarioId);
                
                // LocalStorageì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ
                const existingScenarios = localStorage.getItem('scenarios');
                const scenariosData = existingScenarios ? JSON.parse(existingScenarios) : {};
                
                if (scenariosData[scenarioId]) {
                    // ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ
                    delete scenariosData[scenarioId];
                    
                    // LocalStorageì— ì €ì¥
                    localStorage.setItem('scenarios', JSON.stringify(scenariosData));
                    console.log('âœ… LocalStorageì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ì™„ë£Œ');
                }
                
                // ì „ì—­ ë³€ìˆ˜ì—ì„œë„ ì‚­ì œ
                if (scenarios[scenarioId]) {
                    delete scenarios[scenarioId];
                }
                if (window.scenarios && window.scenarios[scenarioId]) {
                    delete window.scenarios[scenarioId];
                }
                
                // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                displayScenarios();
                updateScenarioStats();
                
                alert('âœ… ì‹œë‚˜ë¦¬ì˜¤ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ');
                
            } catch (error) {
                console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function generateAIContext() {
            const title = document.getElementById('scenarioTitle').value;
            const description = document.getElementById('scenarioDescription').value;
            const backgroundSetting = document.getElementById('backgroundSetting').value;
            const mood = document.getElementById('mood').value;

            if (!title || !description || !backgroundSetting || !mood) {
                alert('AI ì»¨í…ìŠ¤íŠ¸ ìƒì„±ì„ ìœ„í•´ ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const aiContextDiv = document.getElementById('aiContext');
            aiContextDiv.innerHTML = '<div class="loading"></div> AIê°€ ì»¨í…ìŠ¤íŠ¸ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';

            // Fallback: ë¡œì»¬ í…œí”Œë¦¿ ê¸°ë°˜ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
            setTimeout(() => {
                const context = generateLocalAIContext(title, description, backgroundSetting, mood);
                aiContextDiv.innerHTML = context;
            }, 1500);
        }

        function generateLocalAIContext(title, description, backgroundSetting, mood) {
            const templates = {
                'ë¡œë§¨í‹±': `ëŒ€í•™êµ ${backgroundSetting}ì—ì„œ ë²Œì–´ì§€ëŠ” ë‹¬ì½¤í•œ ë¡œë§¨ìŠ¤. ${description}ë¼ëŠ” ìƒí™© ì†ì—ì„œ ë‘ ì‚¬ëŒì˜ ë§ˆìŒì´ ì„œë¡œë¥¼ í–¥í•´ ë‹¤ê°€ê°€ê³  ìˆë‹¤. ë”°ëœ»í•œ ë´„ë‚ , ë²šê½ƒì´ í©ë‚ ë¦¬ëŠ” ìº í¼ìŠ¤ì—ì„œ ì‹œì‘ëœ ì´ì•¼ê¸°ëŠ” ì ì  ê¹Šì–´ì ¸ê°„ë‹¤.`,
                'ë“œë¼ë§ˆí‹±': `${backgroundSetting}ë¥¼ ë°°ê²½ìœ¼ë¡œ í•œ ê°ì •ì˜ ì†Œìš©ëŒì´. ${description}ë¼ëŠ” ë³µì¡í•œ ìƒí™©ì´ ë‘ ì‚¬ëŒì˜ ê´€ê³„ë¥¼ ì‹œí—˜ì— ë“¤ê²Œ í•œë‹¤. ê°ˆë“±ê³¼ ì˜¤í•´ê°€ ì–½íˆë©´ì„œë„ ì§„ì‹¤í•œ ê°ì •ì„ ì°¾ì•„ê°€ëŠ” ì—¬ì •ì´ í¼ì³ì§„ë‹¤.`,
                'ì½”ë¯¹': `ì›ƒìŒì´ ëŠì´ì§€ ì•ŠëŠ” ${backgroundSetting}ì—ì„œì˜ ìœ ì¾Œí•œ ë§Œë‚¨. ${description}ë¼ëŠ” ì¬ë¯¸ìˆëŠ” ìƒí™©ë“¤ì´ ì—°ì†ìœ¼ë¡œ ì¼ì–´ë‚˜ë©° ë‘ ì‚¬ëŒ ì‚¬ì´ì— íŠ¹ë³„í•œ ì¼€ë¯¸ìŠ¤íŠ¸ë¦¬ê°€ ë§Œë“¤ì–´ì§„ë‹¤. ì†Œì†Œí•œ í•´í”„ë‹ë“¤ì´ ë‹¬ì½¤í•œ ì¶”ì–µìœ¼ë¡œ ë³€í•´ê°„ë‹¤.`,
                'í˜„ì‹¤ì ': `í˜„ì‹¤ì ì´ê³  ì§„ì†”í•œ ${backgroundSetting}ì—ì„œì˜ ì´ì•¼ê¸°. ${description}ë¥¼ í†µí•´ ì§„ì§œ ì‚¬ë‘ì´ ë¬´ì—‡ì¸ì§€ ê³ ë¯¼í•˜ê²Œ ëœë‹¤. ì´ìƒê³¼ í˜„ì‹¤ ì‚¬ì´ì—ì„œ ê· í˜•ì„ ì°¾ì•„ê°€ë©° ì„œë¡œë¥¼ ì´í•´í•´ë‚˜ê°€ëŠ” ê³¼ì •ì´ ê·¸ë ¤ì§„ë‹¤.`
            };
            
            return templates[mood] || templates['ë¡œë§¨í‹±'];
        }


        // === ì˜ˆì‹œ ìë™ ì…ë ¥ ê¸°ëŠ¥ ===
        function fillExample(fieldId, element) {
            const field = document.getElementById(fieldId);
            const text = element.textContent;
            
            if (field.tagName === 'TEXTAREA') {
                field.value = text;
                field.style.height = 'auto';
                field.style.height = field.scrollHeight + 'px';
            } else {
                field.value = text;
            }
            
            // ì‹œê°ì  í”¼ë“œë°±
            element.classList.add('selected');
            setTimeout(() => element.classList.remove('selected'), 300);
            
            // ì…ë ¥ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
            field.dispatchEvent(new Event('input', { bubbles: true }));
        }

        // === ì—í”¼ì†Œë“œ ê´€ë¦¬ í•¨ìˆ˜ë“¤ ===
        function manageEpisodes(scenarioId) {
            switchTab('episodes');
            document.getElementById('episodeScenarioSelect').value = scenarioId;
            loadEpisodes();
        }

        function populateEpisodeScenarioSelect() {
            const select = document.getElementById('episodeScenarioSelect');
            select.innerHTML = '<option value="">ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>';

            Object.values(scenarios).forEach(scenario => {
                const option = document.createElement('option');
                option.value = scenario.id;
                option.textContent = scenario.title;
                select.appendChild(option);
            });
        }

        async function loadEpisodes() {
            const scenarioId = document.getElementById('episodeScenarioSelect').value || currentScenarioId;
            if (!scenarioId) {
                document.getElementById('episodeInfo').style.display = 'none';
                console.log('âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ IDê°€ ì—†ì–´ì„œ ì—í”¼ì†Œë“œ ë¡œë”©ì„ ê±´ë„ˆëœë‹ˆë‹¤.');
                return;
            }

            currentScenarioId = scenarioId;
            document.getElementById('episodeInfo').style.display = 'block';
            console.log('ğŸ“š ì—í”¼ì†Œë“œ ë¡œë”© ì‹œì‘ - ì‹œë‚˜ë¦¬ì˜¤:', scenarioId);

            try {
                // LocalStorageì—ì„œ ì—í”¼ì†Œë“œ ë¡œë”©
                const localEpisodes = localStorage.getItem('episodes');
                let episodesData = {};
                
                if (localEpisodes) {
                    const allEpisodes = JSON.parse(localEpisodes);
                    console.log('ğŸ“Š ì „ì²´ ì—í”¼ì†Œë“œ ìˆ˜:', Object.keys(allEpisodes).length);
                    
                    // ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤ì˜ ì—í”¼ì†Œë“œë§Œ í•„í„°ë§
                    Object.keys(allEpisodes).forEach(key => {
                        const episode = allEpisodes[key];
                        if (episode.scenario_id === scenarioId) {
                            episodesData[episode.episode_number] = episode;
                        }
                    });
                    
                    console.log(`âœ… ì‹œë‚˜ë¦¬ì˜¤ ${scenarioId}ì˜ ì—í”¼ì†Œë“œ:`, Object.keys(episodesData).length, 'ê°œ');
                }
                
                // ì „ì—­ ë³€ìˆ˜ ì—…ë°ì´íŠ¸
                episodes = episodesData;
                window.episodes = episodesData;
                
                // UI ì—…ë°ì´íŠ¸
                displayEpisodes();
                updateEpisodeStats();
                
            } catch (error) {
                console.error('ì—í”¼ì†Œë“œ ë¡œë“œ ì˜¤ë¥˜:', error);
                episodes = {};
                displayEpisodes();
                updateEpisodeStats();
            }
        }

        function displayEpisodes() {
            const grid = document.getElementById('episodesGrid');
            grid.innerHTML = '';

            for (let i = 1; i <= 36; i++) {
                const episode = episodes[i];
                const difficulty = getDifficultyByNumber(i);
                
                if (currentDifficultyFilter !== 'all' && difficulty !== currentDifficultyFilter) {
                    continue;
                }

                const card = createEpisodeCard(i, episode, difficulty);
                grid.innerHTML += card;
            }
        }

        function createEpisodeCard(number, episode, difficulty) {
            if (episode) {
                const characterName = getCharacterName(episode.character_id);
                return `
                    <div class="episode-card completed" onclick="previewEpisode(${number})">
                        <div class="episode-number">#${number}</div>
                        <div style="font-size: 0.9em; color: white;">${characterName}</div>
                        <div style="font-size: 0.8em; opacity: 0.9;">${difficulty.toUpperCase()}</div>
                    </div>
                `;
            } else {
                return `
                    <div class="episode-card empty" onclick="createEpisode(${number})">
                        <div class="episode-number">#${number}</div>
                        <div style="color: #999; font-size: 0.9em;">ë¹„ì–´ìˆìŒ</div>
                        <div style="color: #ccc; font-size: 0.8em;">${difficulty.toUpperCase()}</div>
                    </div>
                `;
            }
        }

        function getDifficultyByNumber(number) {
            if (number <= 9) return 'easy';
            if (number <= 18) return 'medium';
            if (number <= 27) return 'hard';
            return 'expert';
        }

        function getCharacterName(characterId) {
            const names = {
                'yuna_infp': 'ìœ¤ì•„',
                'mina_enfp': 'ë¯¸ë‚˜',
                'seoyeon_intj': 'ì„œì—°',
                'jihye_esfj': 'ì§€í˜œ',
                'hyejin_istp': 'í˜œì§„'
            };
            return names[characterId] || 'ì•Œ ìˆ˜ ì—†ìŒ';
        }

        function updateEpisodeStats() {
            const episodeArray = Object.values(episodes);
            const total = episodeArray.length;
            
            document.getElementById('totalEpisodes').textContent = `${total}/36`;
            document.getElementById('progressBar').style.width = `${(total/36)*100}%`;
            document.getElementById('episodeCount').textContent = total;
            
            // ë‚œì´ë„ë³„ ì¹´ìš´íŠ¸
            let counts = { easy: 0, medium: 0, hard: 0, expert: 0 };
            episodeArray.forEach(ep => {
                const difficulty = getDifficultyByNumber(ep.episode_number);
                counts[difficulty]++;
            });
            
            document.getElementById('easyCount').textContent = `${counts.easy}/9`;
            document.getElementById('mediumCount').textContent = `${counts.medium}/9`;
            document.getElementById('hardCount').textContent = `${counts.hard}/9`;
            document.getElementById('expertCount').textContent = `${counts.expert}/9`;
            
            // íƒ­ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
            document.getElementById('allCount').textContent = total;
            document.getElementById('easyTabCount').textContent = counts.easy;
            document.getElementById('mediumTabCount').textContent = counts.medium;
            document.getElementById('hardTabCount').textContent = counts.hard;
            document.getElementById('expertTabCount').textContent = counts.expert;
        }

        function filterByDifficulty(difficulty) {
            currentDifficultyFilter = difficulty;
            
            // íƒ­ í™œì„±í™” ìƒíƒœ ë³€ê²½
            document.querySelectorAll('.difficulty-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.closest('.difficulty-tab').classList.add('active');
            
            displayEpisodes();
        }

        function openEpisodeModal(mode) {
            currentMode = mode;
            document.getElementById('episodeModalTitle').textContent = 'ìƒˆ ì—í”¼ì†Œë“œ ìƒì„±';
            document.getElementById('episodeForm').reset();
            document.getElementById('dialoguePreview').style.display = 'none';
            generatedDialogue = null;
            
            // ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒê¸° ë™ì  ë¡œë”©
            loadEpisodeScenarioSelector();
            
            // ê¸°ì¡´ ì‹œë‚˜ë¦¬ì˜¤ IDê°€ ìˆìœ¼ë©´ ì„ íƒ ìƒíƒœë¡œ ì„¤ì •
            if (currentScenarioId) {
                // ì„ íƒê¸°ê°€ ë¡œë”©ëœ í›„ ì„¤ì •í•˜ê¸° ìœ„í•´ ì•½ê°„ ì§€ì—°
                setTimeout(() => {
                    const scenarioSelect = document.getElementById('episodeScenarioSelect');
                    if (scenarioSelect.querySelector(`option[value="${currentScenarioId}"]`)) {
                        scenarioSelect.value = currentScenarioId;
                        onScenarioChange(); // ìºë¦­í„° ëª©ë¡ë„ ìë™ ì—…ë°ì´íŠ¸
                    }
                }, 100);
            }
            
            document.getElementById('episodeModal').style.display = 'block';
        }

        function createEpisode(number) {
            openEpisodeModal('create');
            document.getElementById('episodeNumber').value = number;
            
            // ë‚œì´ë„ ìë™ ì„¤ì •
            const difficulty = getDifficultyByNumber(number);
            document.getElementById('difficulty').value = difficulty;
        }

        // Episode Preview Functions
        let currentPreviewEpisodeNumber = null;

        function previewEpisode(number) {
            const episode = episodes[number];
            if (!episode) {
                alert('ì—í”¼ì†Œë“œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            currentPreviewEpisodeNumber = number;
            console.log('ğŸ“– ì—í”¼ì†Œë“œ ë¯¸ë¦¬ë³´ê¸°:', number, episode);

            // Update modal title
            document.getElementById('episodePreviewTitle').textContent = `ğŸ“– ì—í”¼ì†Œë“œ #${number} ë¯¸ë¦¬ë³´ê¸°`;

            // Display episode metadata
            displayEpisodeMetadata(episode, number);

            // Display dialogue content
            displayDialogueContent(episode);

            // Show modal
            document.getElementById('episodePreviewModal').style.display = 'block';
        }

        function displayEpisodeMetadata(episode, number) {
            const metadata = document.getElementById('episodeMetadata');
            const difficulty = getDifficultyByNumber(number);
            const characterName = getCharacterName(episode.character_id);

            metadata.innerHTML = `
                <div class="metadata-item">
                    <div class="metadata-label">ì—í”¼ì†Œë“œ ë²ˆí˜¸</div>
                    <div class="metadata-value">#${number}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">ë‚œì´ë„</div>
                    <div class="metadata-value">${difficulty.toUpperCase()}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">ìºë¦­í„°</div>
                    <div class="metadata-value">${characterName} (${episode.character_id})</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">ì‹œë‚˜ë¦¬ì˜¤</div>
                    <div class="metadata-value">${episode.scenario_id}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">ìƒì„±ì¼</div>
                    <div class="metadata-value">${episode.created_at ? new Date(episode.created_at).toLocaleString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}</div>
                </div>
                <div class="metadata-item">
                    <div class="metadata-label">ìƒí™© í”„ë¡¬í”„íŠ¸</div>
                    <div class="metadata-value">${episode.user_input_prompt || 'ì—†ìŒ'}</div>
                </div>
            `;
        }

        function displayDialogueContent(episode) {
            const characterMessage = document.getElementById('characterMessage');
            const narrationDisplay = document.getElementById('narrationDisplay');
            const choicesDisplay = document.getElementById('choicesDisplay');

            // Get dialogue data - check both possible fields
            const dialogueData = episode.generated_dialogue || episode.ai_generated_dialogue;
            
            console.log('ğŸ’¬ ëŒ€í™” ë°ì´í„°:', dialogueData);

            if (dialogueData) {
                // Display character message
                characterMessage.innerHTML = dialogueData.dialogue || dialogueData.character_message || 'ëŒ€í™” ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
                
                // Display narration
                if (dialogueData.narration || dialogueData.context) {
                    narrationDisplay.innerHTML = dialogueData.narration || dialogueData.context;
                    narrationDisplay.style.display = 'block';
                } else {
                    narrationDisplay.style.display = 'none';
                }

                // Display choices
                if (dialogueData.choices && Array.isArray(dialogueData.choices)) {
                    let choicesHtml = '';
                    dialogueData.choices.forEach((choice, index) => {
                        const impact = choice.affection_impact || 0;
                        const impactClass = impact > 0 ? 'impact-positive' : impact < 0 ? 'impact-negative' : 'impact-neutral';
                        const impactText = impact > 0 ? `+${impact}` : impact < 0 ? `${impact}` : '0';
                        
                        choicesHtml += `
                            <div class="choice-preview">
                                <div class="choice-text">${choice.text}</div>
                                <div class="choice-impact ${impactClass}">í˜¸ê°ë„ ${impactText}</div>
                            </div>
                        `;
                    });
                    choicesDisplay.innerHTML = choicesHtml;
                } else {
                    choicesDisplay.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">ì„ íƒì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
                }
            } else {
                characterMessage.innerHTML = 'ëŒ€í™” ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.';
                narrationDisplay.style.display = 'none';
                choicesDisplay.innerHTML = '<div style="color: #666; text-align: center; padding: 20px;">ëŒ€í™” ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
            }
        }

        function editEpisodeFromPreview() {
            if (currentPreviewEpisodeNumber !== null) {
                closeModal('episodePreviewModal');
                editEpisode(currentPreviewEpisodeNumber);
            }
        }

        function editEpisode(number) {
            const episode = episodes[number];
            if (!episode) return;
            
            currentMode = 'edit';
            document.getElementById('episodeModalTitle').textContent = 'ì—í”¼ì†Œë“œ ìˆ˜ì •';
            document.getElementById('episodeId').value = episode.id;
            document.getElementById('episodeScenarioId').value = episode.scenario_id;
            document.getElementById('episodeNumber').value = episode.episode_number;
            document.getElementById('characterSelect').value = episode.character_id;
            document.getElementById('difficulty').value = episode.difficulty;
            document.getElementById('userPrompt').value = episode.user_input_prompt;
            
            // AI ìƒì„± ëŒ€í™” í‘œì‹œ
            if (episode.ai_generated_dialogue) {
                generatedDialogue = episode.ai_generated_dialogue;
                displayDialoguePreview(generatedDialogue);
            }
            
            if (episode.custom_dialogue) {
                const custom = JSON.parse(episode.custom_dialogue);
                document.getElementById('customDialogue').value = custom.dialogue || '';
                document.getElementById('customNarration').value = custom.narration || '';
            }
            
            document.getElementById('episodeModal').style.display = 'block';
        }

        async function generateDialogue() {
            const characterId = document.getElementById('characterSelect').value;
            const userPrompt = document.getElementById('userPrompt').value;
            const difficulty = document.getElementById('difficulty').value;
            
            if (!characterId || !userPrompt) {
                alert('ìºë¦­í„°ì™€ ìƒí™© í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const characterName = getCharacterName(characterId);
            const previewDiv = document.getElementById('dialoguePreview');
            previewDiv.style.display = 'block';
            
            document.getElementById('previewDialogue').innerHTML = '<div class="loading"></div> AIê°€ ëŒ€í™”ë¥¼ ìƒì„± ì¤‘ì…ë‹ˆë‹¤...';
            document.getElementById('previewNarration').textContent = '';
            document.getElementById('previewChoices').innerHTML = '';
            
            try {
                console.log('ğŸ¤– ë¡œì»¬ ëŒ€í™” ìƒì„± ì‹œì‘...');
                
                // ì±„íŒ… í›ˆë ¨ APIë¥¼ ì‚¬ìš©í•œ ëŒ€í™” ìƒì„±
                generatedDialogue = await generateLocalDialogue(characterId, characterName, userPrompt, difficulty);
                
                // ì§§ì€ ì§€ì—°ìœ¼ë¡œ ë¡œë”© íš¨ê³¼ ì œê³µ
                setTimeout(() => {
                    displayDialoguePreview(generatedDialogue);
                    console.log('âœ… ë¡œì»¬ ëŒ€í™” ìƒì„± ì™„ë£Œ');
                }, 1000);
                
            } catch (error) {
                console.error('ëŒ€í™” ìƒì„± ì˜¤ë¥˜:', error);
                document.getElementById('previewDialogue').textContent = 'âš ï¸ ëŒ€í™” ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
            }
        }

        function displayDialoguePreview(dialogue) {
            if (!dialogue) return;
            
            document.getElementById('dialoguePreview').style.display = 'block';
            document.getElementById('previewDialogue').textContent = dialogue.dialogue;
            document.getElementById('previewNarration').textContent = dialogue.narration;
            
            const choicesList = document.getElementById('previewChoices');
            choicesList.innerHTML = '';
            
            dialogue.choices.forEach(choice => {
                const li = document.createElement('li');
                li.className = 'choice-item';
                li.innerHTML = `
                    <span>${choice.text}</span>
                    <span class="impact">í˜¸ê°ë„ ${choice.affection_impact > 0 ? '+' : ''}${choice.affection_impact}</span>
                `;
                choicesList.appendChild(li);
            });
        }

        async function saveEpisode() {
            const scenarioId = document.getElementById('episodeScenarioSelect').value;
            const episodeNumber = parseInt(document.getElementById('episodeNumber').value);
            const characterId = document.getElementById('characterSelect').value;
            const difficulty = document.getElementById('difficulty').value;
            const userPrompt = document.getElementById('userPrompt').value;
            
            if (!scenarioId || !episodeNumber || !characterId || !userPrompt) {
                alert('ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\n- ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ\n- ì—í”¼ì†Œë“œ ë²ˆí˜¸\n- ìºë¦­í„° ì„ íƒ\n- ìƒí™© í”„ë¡¬í”„íŠ¸');
                return;
            }
            
            // ìºë¦­í„° ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            const charactersData = window.characters || {};
            const character = charactersData[characterId];
            const characterName = character ? character.name : characterId;
            
            const episodeData = {
                scenario_id: scenarioId,
                episode_number: episodeNumber,
                character_id: characterId,
                character_name: characterName,
                difficulty: difficulty,
                user_input_prompt: userPrompt,
                created_at: new Date().toISOString(),
                id: currentMode === 'create' ? `episode_${scenarioId}_${episodeNumber}_${Date.now()}` : document.getElementById('episodeId').value
            };
            
            if (currentMode === 'create') {
                episodeData.action = 'create';
            } else {
                episodeData.action = 'update';
                episodeData.id = document.getElementById('episodeId').value;
            }
            
            // ì»¤ìŠ¤í…€ ëŒ€í™”ê°€ ìˆìœ¼ë©´ ì¶”ê°€
            const customDialogue = document.getElementById('customDialogue').value;
            const customNarration = document.getElementById('customNarration').value;
            if (customDialogue || customNarration) {
                episodeData.custom_dialogue = {
                    dialogue: customDialogue,
                    narration: customNarration
                };
            }
            
            // ìƒì„±ëœ ëŒ€í™”ê°€ ìˆìœ¼ë©´ ì¶”ê°€
            if (generatedDialogue) {
                episodeData.generated_dialogue = generatedDialogue;
            }
            
            try {
                console.log('ğŸ’¾ === ì—í”¼ì†Œë“œ ì €ì¥ ì‹œì‘ ===');
                console.log('ğŸ“Š ì—í”¼ì†Œë“œ ë°ì´í„°:', episodeData);
                
                // ğŸ’¾ LocalStorage ì§ì ‘ ì €ì¥ (í™•ì‹¤í•œ ë°©ë²•!)
                console.log('ğŸ’¾ LocalStorageì— ì—í”¼ì†Œë“œ ì €ì¥ ì‹œë„...');
                
                // í˜„ì¬ ì €ì¥ëœ ì—í”¼ì†Œë“œë“¤ì„ ê°€ì ¸ì˜´
                const existingEpisodes = localStorage.getItem('episodes');
                const episodesData = existingEpisodes ? JSON.parse(existingEpisodes) : {};
                
                // ìƒˆ ì—í”¼ì†Œë“œ ì¶”ê°€/ìˆ˜ì •
                episodesData[episodeData.id] = episodeData;
                
                // LocalStorageì— ì €ì¥
                localStorage.setItem('episodes', JSON.stringify(episodesData));
                console.log('âœ… LocalStorage ì—í”¼ì†Œë“œ ì €ì¥ ì„±ê³µ! ì´', Object.keys(episodesData).length, 'ê°œ ì—í”¼ì†Œë“œ');
                
                // ì‹œë‚˜ë¦¬ì˜¤ì˜ ì—í”¼ì†Œë“œ ì¹´ìš´íŠ¸ë„ ì—…ë°ì´íŠ¸
                const scenariosData = window.scenarios || {};
                if (scenariosData[scenarioId]) {
                    const scenarioEpisodes = Object.values(episodesData).filter(ep => ep.scenario_id === scenarioId);
                    scenariosData[scenarioId].episode_count = scenarioEpisodes.length;
                    window.scenarios = scenariosData;
                    
                    // ì‹œë‚˜ë¦¬ì˜¤ë„ LocalStorageì— ì €ì¥
                    localStorage.setItem('scenarios', JSON.stringify(scenariosData));
                    console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì—í”¼ì†Œë“œ ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸:', scenariosData[scenarioId].episode_count);
                }
                
                // ì €ì¥ ì„±ê³µ ë©”ì‹œì§€
                const successMessage = currentMode === 'create' ? 
                    `ğŸ’– ìƒˆë¡œìš´ ì—í”¼ì†Œë“œ ${episodeNumber}ë²ˆì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!\nì‹œë‚˜ë¦¬ì˜¤: ${scenariosData[scenarioId]?.title || scenarioId}\nìºë¦­í„°: ${characterName}` :
                    `âœ¨ì—í”¼ì†Œë“œ ${episodeNumber}ë²ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`;
                
                alert(successMessage);
                closeModal('episodeModal');
                
                // UI ìµœì¢… ì—…ë°ì´íŠ¸
                console.log('ğŸ”„ ì €ì¥ í›„ ìµœì¢… UI ë™ê¸°í™”...');
                updateScenarioStats();
                // loadEpisodes(); // ì—í”¼ì†Œë“œ ëª©ë¡ë„ ìƒˆë¡œê³ ì¹¨ (í•„ìš”ì‹œ)
                
                console.log('âœ… ì—í”¼ì†Œë“œ ì €ì¥ í”„ë¡œì„¸ìŠ¤ ì™„ë£Œ!');
                
            } catch (error) {
                console.error('âŒ ì—í”¼ì†Œë“œ ì €ì¥ ì‹¤íŒ¨:', error);
                alert('ì—í”¼ì†Œë“œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        async function generateBulkEpisodes() {
            console.log('ğŸš€ ì—í”¼ì†Œë“œ ì¼ê´„ ìƒì„± ì‹œì‘...');
            
            // 1. ì‹œë‚˜ë¦¬ì˜¤ ì„ íƒ
            const availableScenarios = Object.keys(scenarios);
            if (availableScenarios.length === 0) {
                alert('ìƒì„±ëœ ì‹œë‚˜ë¦¬ì˜¤ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            let scenarioOptions = 'ì‚¬ìš© ê°€ëŠ¥í•œ ì‹œë‚˜ë¦¬ì˜¤:\n';
            availableScenarios.forEach((id, index) => {
                scenarioOptions += `${index + 1}. ${scenarios[id].title} (ID: ${id})\n`;
            });
            
            const scenarioChoice = prompt(`${scenarioOptions}\nì‹œë‚˜ë¦¬ì˜¤ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš” (1-${availableScenarios.length}):`);
            if (!scenarioChoice) return;
            
            const selectedScenarioIndex = parseInt(scenarioChoice) - 1;
            if (selectedScenarioIndex < 0 || selectedScenarioIndex >= availableScenarios.length) {
                alert('ì˜¬ë°”ë¥¸ ì‹œë‚˜ë¦¬ì˜¤ ë²ˆí˜¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const selectedScenarioId = availableScenarios[selectedScenarioIndex];
            const selectedScenario = scenarios[selectedScenarioId];
            console.log('âœ… ì„ íƒëœ ì‹œë‚˜ë¦¬ì˜¤:', selectedScenario.title);
            
            // 2. ìºë¦­í„° ì„ íƒ  
            const availableCharacters = Object.keys(characters);
            if (availableCharacters.length === 0) {
                alert('ìƒì„±ëœ ìºë¦­í„°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ìºë¦­í„°ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            let characterOptions = 'ì‚¬ìš© ê°€ëŠ¥í•œ ìºë¦­í„°:\n';
            availableCharacters.forEach((id, index) => {
                const char = characters[id];
                characterOptions += `${index + 1}. ${char.name} (${char.mbti}) - ID: ${id}\n`;
            });
            
            const characterChoice = prompt(`${characterOptions}\nìºë¦­í„° ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš” (1-${availableCharacters.length}):`);
            if (!characterChoice) return;
            
            const selectedCharacterIndex = parseInt(characterChoice) - 1;
            if (selectedCharacterIndex < 0 || selectedCharacterIndex >= availableCharacters.length) {
                alert('ì˜¬ë°”ë¥¸ ìºë¦­í„° ë²ˆí˜¸ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const selectedCharacterId = availableCharacters[selectedCharacterIndex];
            const selectedCharacter = characters[selectedCharacterId];
            console.log('âœ… ì„ íƒëœ ìºë¦­í„°:', selectedCharacter.name);
            
            // 3. ì—í”¼ì†Œë“œ ë²”ìœ„ ì„ íƒ
            const startNum = parseInt(prompt('ì‹œì‘ ì—í”¼ì†Œë“œ ë²ˆí˜¸ (1-36):'));
            const endNum = parseInt(prompt('ì¢…ë£Œ ì—í”¼ì†Œë“œ ë²ˆí˜¸ (1-36):'));
            
            if (!startNum || !endNum || startNum < 1 || endNum > 36 || startNum > endNum) {
                alert('ì˜¬ë°”ë¥¸ ë²”ìœ„ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (1-36, ì‹œì‘ë²ˆí˜¸ â‰¤ ì¢…ë£Œë²ˆí˜¸)');
                return;
            }
            
            const episodeCount = endNum - startNum + 1;
            
            // 4. í™•ì¸ ë° ìƒì„±
            if (confirm(`ğŸ“‹ ì¼ê´„ ìƒì„± ì„¤ì •:\n\nì‹œë‚˜ë¦¬ì˜¤: ${selectedScenario.title}\nìºë¦­í„°: ${selectedCharacter.name} (${selectedCharacter.mbti})\në²”ìœ„: ${startNum}ë²ˆ ~ ${endNum}ë²ˆ (ì´ ${episodeCount}ê°œ)\n\nìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
                
                console.log('ğŸ”„ ì—í”¼ì†Œë“œ ì¼ê´„ ìƒì„± ì§„í–‰...');
                let successCount = 0;
                let failCount = 0;
                
                for (let episodeNum = startNum; episodeNum <= endNum; episodeNum++) {
                    try {
                        // ê° ì—í”¼ì†Œë“œë³„ ìƒí™© í”„ë¡¬í”„íŠ¸ ìë™ ìƒì„±
                        const situationPrompts = [
                            "ìš°ì—°íˆ ë§ˆì£¼ì¹œ ìƒí™©ì—ì„œ ì„œë¡œë¥¼ ì˜ì‹í•˜ë©°",
                            "í•¨ê»˜ ê³¼ì œë¥¼ í•˜ë©´ì„œ ê°€ê¹Œì›Œì§€ëŠ” ìˆœê°„",
                            "ë¹„ ë‚´ë¦¬ëŠ” ë‚  ê°™ì€ ìš°ì‚°ì„ ì“°ê²Œ ë˜ì–´",
                            "ì¶•ì œì—ì„œ í•¨ê»˜ ì¦ê±°ìš´ ì‹œê°„ì„ ë³´ë‚´ë©°",
                            "ì¡°ìš©í•œ ë„ì„œê´€ì—ì„œ ëˆˆì´ ë§ˆì£¼ì³",
                            "ì¹´í˜ì—ì„œ ìš°ì—°íˆ ë§Œë‚˜ ëŒ€í™”í•˜ë©°",
                            "ë°©ê³¼í›„ êµì‹¤ì—ì„œ ë‘˜ë§Œ ë‚¨ê²Œ ë˜ì–´",
                            "ì‚°ì±…í•˜ë©° ì§„ì†”í•œ ëŒ€í™”ë¥¼ ë‚˜ëˆ„ëŠ”",
                            "í•™êµ ì˜¥ìƒì—ì„œ ë°”ë¼ë³¸ í•˜ëŠ˜ì²˜ëŸ¼ ì²­ëŸ‰í•œ",
                            "ì¶”ìš´ ê²¨ìš¸ ë”°ëœ»í•œ ë§ˆìŒì„ ë‚˜ëˆ„ëŠ”"
                        ];
                        
                        const promptIndex = (episodeNum - 1) % situationPrompts.length;
                        const userPrompt = situationPrompts[promptIndex];
                        
                        // ë‚œì´ë„ ì„¤ì • (1-9: Easy, 10-18: Medium, 19-27: Hard, 28-36: Expert)
                        let difficulty = 'Easy';
                        if (episodeNum >= 10 && episodeNum <= 18) difficulty = 'Medium';
                        else if (episodeNum >= 19 && episodeNum <= 27) difficulty = 'Hard';
                        else if (episodeNum >= 28 && episodeNum <= 36) difficulty = 'Expert';
                        
                        // ì±„íŒ… í›ˆë ¨ APIë¥¼ ì‚¬ìš©í•œ ëŒ€í™” ìƒì„±
                        const generatedDialogue = await generateLocalDialogue(selectedCharacterId, selectedCharacter.name, userPrompt, difficulty);
                        
                        // ì—í”¼ì†Œë“œ ë°ì´í„° ìƒì„±
                        const episodeData = {
                            episode_number: episodeNum,
                            scenario_id: selectedScenarioId,
                            character_id: selectedCharacterId,
                            character_name: selectedCharacter.name,
                            user_input_prompt: userPrompt,
                            difficulty: difficulty,
                            ai_generated_dialogue: generatedDialogue,
                            generated_dialogue: generatedDialogue,
                            created_at: new Date().toISOString()
                        };
                        
                        // LocalStorageì— ì €ì¥
                        const existingEpisodes = localStorage.getItem('episodes');
                        const episodesData = existingEpisodes ? JSON.parse(existingEpisodes) : {};
                        
                        const episodeKey = `${selectedScenarioId}_${episodeNum}`;
                        episodesData[episodeKey] = episodeData;
                        
                        localStorage.setItem('episodes', JSON.stringify(episodesData));
                        
                        // ì „ì—­ ë³€ìˆ˜ì—ë„ ì €ì¥
                        if (!episodes) episodes = {};
                        episodes[episodeKey] = episodeData;
                        
                        successCount++;
                        console.log(`âœ… ì—í”¼ì†Œë“œ ${episodeNum}ë²ˆ ìƒì„± ì™„ë£Œ`);
                        
                    } catch (error) {
                        console.error(`âŒ ì—í”¼ì†Œë“œ ${episodeNum}ë²ˆ ìƒì„± ì‹¤íŒ¨:`, error);
                        failCount++;
                    }
                }
                
                // ê²°ê³¼ í‘œì‹œ
                alert(`ğŸ‰ ì¼ê´„ ìƒì„± ì™„ë£Œ!\n\nâœ… ì„±ê³µ: ${successCount}ê°œ\nâŒ ì‹¤íŒ¨: ${failCount}ê°œ\n\nì—í”¼ì†Œë“œ ëª©ë¡ì„ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.`);
                
                // UI ì—…ë°ì´íŠ¸
                currentScenarioId = selectedScenarioId;
                loadEpisodes();
            }
        }

        // === ìºë¦­í„° ê´€ë¦¬ í•¨ìˆ˜ë“¤ ===
        // ğŸš€ GitHub API ìš°ì„  ìºë¦­í„° ë¡œë“œ (í˜ì‹ ì  í•´ê²°ì±…!)
        async function loadCharacters() {
            console.log('ğŸ“¥ === ìºë¦­í„° ë¡œë“œ ì‹œì‘ (GitHub API ìš°ì„ ) ===');
            console.log('ğŸ•’ ë¡œë“œ ì‹œê°„:', new Date().toISOString());
            
            // 1ìˆœìœ„: GitHub APIì—ì„œ ë¡œë“œ (ìµœì‹  ì˜êµ¬ ë°ì´í„°)
            try {
                console.log('ğŸ™ GitHub APIì—ì„œ ìºë¦­í„° ë¡œë“œ...');
                
                // GitHub í† í° í™•ì¸
                if (!GITHUB_CONFIG.token) {
                    console.log('ğŸ” GitHub í† í° ë¡œë“œ ì‹œë„...');
                    await loadGitHubToken();
                }
                
                if (GITHUB_CONFIG.token) {
                    const gitHubCharacters = await loadCharactersFromGitHub();
                    const characterCount = Object.keys(gitHubCharacters).length;
                    console.log('ğŸ“Š GitHub ìºë¦­í„° ìˆ˜:', characterCount);
                    
                    if (characterCount > 0) {
                        characters = gitHubCharacters;
                        
                        // GitHub ë°ì´í„°ë¥¼ ë¡œì»¬ì—ë„ ë°±ì—…
                        localStorage.setItem('chatgame_characters', JSON.stringify(characters));
                        
                        console.log('âœ… GitHub APIì—ì„œ ë¡œë“œ ì™„ë£Œ. ìºë¦­í„° IDë“¤:', Object.keys(characters));
                        displayCharacters();
                        updateCharacterStats();
                        console.log('ğŸ‰ === ìºë¦­í„° ë¡œë“œ ì™„ë£Œ (GitHub API) ===');
                        return;
                    } else {
                        console.log('ğŸ“­ GitHubì— ìºë¦­í„° ë°ì´í„° ì—†ìŒ');
                    }
                } else {
                    console.log('ğŸ” GitHub í† í° ì—†ìŒ, ë‹¤ë¥¸ ë°©ë²• ì‹œë„...');
                }
            } catch (error) {
                console.warn('âš ï¸ GitHub API ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            
            // 2ìˆœìœ„: ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¡œë“œ (ë°±ì—…)
            try {
                console.log('ğŸ’¾ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ ìºë¦­í„° ë°±ì—… ë¡œë“œ...');
                const localData = localStorage.getItem('chatgame_characters');
                
                if (localData) {
                    const localCharacters = JSON.parse(localData);
                    const characterCount = Object.keys(localCharacters).length;
                    console.log('ğŸ“Š ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—… ìºë¦­í„° ìˆ˜:', characterCount);
                    
                    if (characterCount > 0) {
                        characters = localCharacters;
                        console.log('âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë°±ì—…ì—ì„œ ë¡œë“œ ì™„ë£Œ. ìºë¦­í„° IDë“¤:', Object.keys(characters));
                        displayCharacters();
                        updateCharacterStats();
                        console.log('ğŸ‰ === ìºë¦­í„° ë¡œë“œ ì™„ë£Œ (ë¡œì»¬ ë°±ì—…) ===');
                        return;
                    }
                }
            } catch (error) {
                console.error('âŒ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ë¡œë“œ ì˜ˆì™¸:', error);
            }
            
            // 3ìˆœìœ„: AI APIì—ì„œ ë¡œë“œ
            try {
                console.log('ğŸ¤– AI ìºë¦­í„° ìƒì„±ê¸° API ë¡œë“œ...');
                console.log('ğŸ¤– AI ìºë¦­í„° ìƒì„±ê¸° API í˜¸ì¶œ...');
                const aiResponse = await fetch('/api/character-ai-generator?action=list_characters&_t=' + Date.now());
                
                console.log('ğŸ“¶ AI API ì‘ë‹µ ìƒíƒœ:', aiResponse.status);
                
                if (aiResponse.ok) {
                    const aiData = await aiResponse.json();
                    console.log('ğŸ¤– AI API ì›ì‹œ ì‘ë‹µ:', JSON.stringify(aiData, null, 2));
                    
                    if (aiData.success && aiData.characters) {
                        const characterCount = Object.keys(aiData.characters).length;
                        console.log('ğŸ“Š AI API ìºë¦­í„° ìˆ˜:', characterCount);
                        
                        if (characterCount > 0) {
                            characters = aiData.characters;
                            console.log('âœ… AI APIì—ì„œ ë¡œë“œ ì™„ë£Œ. ìºë¦­í„° IDë“¤:', Object.keys(characters));
                            displayCharacters();
                            updateCharacterStats();
                            console.log('ğŸ‰ === ìºë¦­í„° ë¡œë“œ ì™„ë£Œ (AI API) ===');
                            return;
                        } else {
                            console.log('ğŸ˜µ AI APIì—ì„œ ë¹ˆ ìºë¦­í„° ëª©ë¡ ë°˜í™˜');
                        }
                    } else {
                        console.log('ğŸ˜µ AI API ì‘ë‹µì´ ë¹„ì •ìƒ:', aiData);
                    }
                } else {
                    console.log('âŒ AI API HTTP ì˜¤ë¥˜:', aiResponse.status);
                }
            } catch (error) {
                console.error('âŒ AI API ì˜ˆì™¸:', error);
            }
            
            try {
                // ê¸°ë³¸ characters.json ì‹œë„
                console.log('ğŸ“ ê¸°ë³¸ characters.json íŒŒì¼ ë¡œë“œ...');
                const response = await fetch('/data/characters.json?_t=' + Date.now());
                
                console.log('ğŸ“¶ ê¸°ë³¸ íŒŒì¼ ì‘ë‹µ ìƒíƒœ:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('ğŸ“ ê¸°ë³¸ íŒŒì¼ ì›ì‹œ ë°ì´í„°:', JSON.stringify(data, null, 2));
                    
                    if (data.characters && Array.isArray(data.characters)) {
                        // Array í˜•íƒœë¥¼ Object í˜•íƒœë¡œ ë³€í™˜
                        characters = {};
                        data.characters.forEach(char => {
                            characters[char.id] = char;
                        });
                        const characterCount = Object.keys(characters).length;
                        console.log('âœ… ê¸°ë³¸ íŒŒì¼ì—ì„œ ë¡œë“œëœ ìºë¦­í„° ìˆ˜:', characterCount);
                        
                        if (characterCount > 0) {
                            console.log('âœ… ìºë¦­í„° IDë“¤:', Object.keys(characters));
                        }
                        
                        displayCharacters();
                        updateCharacterStats();
                        console.log('ğŸ‰ === ìºë¦­í„° ë¡œë“œ ì™„ë£Œ (ê¸°ë³¸ íŒŒì¼) ===');
                        return;
                    } else {
                        console.log('ğŸ˜µ ê¸°ë³¸ íŒŒì¼ì˜ characters í•„ë“œê°€ ë¹„ì–´ìˆê±°ë‚˜ ë¹„ì •ìƒ');
                    }
                } else {
                    console.log('âŒ ê¸°ë³¸ íŒŒì¼ HTTP ì˜¤ë¥˜:', response.status);
                }
            } catch (error) {
                console.error('âŒ ê¸°ë³¸ íŒŒì¼ ì˜ˆì™¸:', error);
            }
            
            // ëª¨ë“  ë°©ë²•ì´ ì‹¤íŒ¨í•˜ë©´ ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
            console.log('âš ï¸ === ëª¨ë“  ë¡œë“œ ë°©ë²• ì‹¤íŒ¨, ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™” ===');
            characters = {};
            displayCharacters();
            updateCharacterStats();
            console.log('ğŸ‰ === ìºë¦­í„° ë¡œë“œ ì™„ë£Œ (ë¹ˆ ë°ì´í„°) ===');
        }

        // ê¸°ë³¸ ìºë¦­í„° ë°ì´í„° ë¡œë“œ (fallback)
        // ì‚¬ìš©í•˜ì§€ ì•Šì„ ì˜ˆì •ì´ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬
        // function loadDefaultCharacters() { ... }







        // === ë”ë¯¸ ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥ ===
        async function resetAllCharacters() {
            if (!confirm('âš ï¸ ì£¼ì˜: ëª¨ë“  ìºë¦­í„° ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\n\nì •ë§ë¡œ ê³„ì†í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }
            
            if (!confirm('í•œ ë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤. ëª¨ë“  ìºë¦­í„° ë°ì´í„°ê°€ ì™„ì „íˆ ì‚­ì œë©ë‹ˆë‹¤!')) {
                return;
            }
            
            try {
                console.log('ğŸ—‘ï¸ ëª¨ë“  ìºë¦­í„° ë°ì´í„° ì‚­ì œ ì‹œì‘...');
                
                const response = await fetch('/api/character-ai-generator', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'reset_all_characters'
                    })
                });
                
                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        alert('âœ… ëª¨ë“  ìºë¦­í„° ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                        
                        // ìºë¦­í„° ëª©ë¡ ìƒˆë¡œê³ ì¹¨
                        setTimeout(() => {
                            loadCharacters();
                        }, 500);
                    } else {
                        throw new Error(result.message || 'ì‚­ì œ ì‹¤íŒ¨');
                    }
                } else {
                    throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + response.status);
                }
                
            } catch (error) {
                console.error('âŒ ë°ì´í„° ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('ë°ì´í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        function displayCharacters() {
            console.log('ğŸ¨ === ìºë¦­í„° í‘œì‹œ í•¨ìˆ˜ ì‹œì‘ ===');
            const container = document.getElementById('charactersContainer');
            const characterArray = Object.values(characters);
            console.log('ğŸ“Š í‘œì‹œí•  ìºë¦­í„° ìˆ˜:', characterArray.length);
            console.log('ğŸ“‹ ìºë¦­í„° ëª©ë¡:', characterArray.map(c => `${c.name} (${c.id})`));
            
            container.innerHTML = characterArray.map(character => `
                <div class="character-card">
                    <div class="character-image">
                        ${character.image ? 
                            `<img src="${character.image}" alt="${character.name}" onerror="this.src='data:image/svg+xml,<svg xmlns=\\"http://www.w3.org/2000/svg\\" viewBox=\\"0 0 100 100\\"><rect width=\\"100\\" height=\\"100\\" fill=\\"%23f0f0f0\\"/><text x=\\"50\\" y=\\"50\\" text-anchor=\\"middle\\" dy=\\".3em\\" fill=\\"%23999\\">${character.name.charAt(0)}</text></svg>'"/>` :
                            `<div class="no-image">${character.name.charAt(0)}</div>`
                        }
                    </div>
                    <div class="character-info">
                        <div class="mbti">${character.mbti}</div>
                        <h3>${character.name}</h3>
                        <p class="traits">${character.personality_traits || character.personality || 'íŠ¹ì„± ì •ë³´ ì—†ìŒ'}</p>
                        <p style="font-size: 0.9em; color: #95a5a6; margin-bottom: 15px;">${character.speech_style || 'ë§íˆ¬ ì •ë³´ ì—†ìŒ'}</p>
                        <div class="actions">
                            <button class="btn btn-success" onclick="editCharacter('${character.id}')">ìˆ˜ì •</button>
                            <button class="btn btn-danger" onclick="deleteCharacter('${character.id}')">ì‚­ì œ</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateCharacterStats() {
            console.log('ğŸ“Š ìºë¦­í„° í†µê³„ ì—…ë°ì´íŠ¸ ì‹œì‘...');
            
            const characterArray = Object.values(characters);
            console.log('ğŸ“Š ìºë¦­í„° ë°°ì—´:', characterArray.length, 'ê°œ');
            
            // ì•ˆì „í•œ ìš”ì†Œ ì—…ë°ì´íŠ¸ (ìš”ì†Œê°€ ì—†ìœ¼ë©´ ë¬´ì‹œ)
            const safeUpdateElement = (id, value) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    console.log(`âœ… ${id}: ${value}`);
                } else {
                    console.warn(`âš ï¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${id}`);
                }
            };
            
            // ìºë¦­í„° í†µê³„ ì—…ë°ì´íŠ¸
            safeUpdateElement('totalCharacters', characterArray.length);
            safeUpdateElement('activeCharacters', characterArray.filter(c => c.active !== false).length);
            safeUpdateElement('characterCount', characterArray.length);
            
            // AI ìƒì„± ìºë¦­í„° ê°œìˆ˜
            const aiGeneratedCharacters = characterArray.filter(c => c.source === 'ai_generator' || c.created_by === 'ai').length;
            safeUpdateElement('aiGeneratedCharacters', aiGeneratedCharacters);
            
            // í‰ê·  í˜¸ê°ë„ (ì˜ˆì‹œìš©)
            const avgAffection = characterArray.length > 0 
                ? Math.round(characterArray.reduce((sum, c) => sum + (c.initial_affection || 0), 0) / characterArray.length)
                : 0;
            safeUpdateElement('avgCharacterAffection', avgAffection);
            
            console.log('âœ… ìºë¦­í„° í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£¼');
        }

        function openCharacterModal(mode) {
            currentMode = mode;
            // ì œëª©ì€ ì´ë¯¸ HTMLì—ì„œ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ë³€ê²½í•˜ì§€ ì•ŠìŒ
            document.getElementById('characterForm').reset();
            
            // ëª¨ë“  ì„ íƒ ë²„íŠ¼ë“¤ ì´ˆê¸°í™”
            document.querySelectorAll('.mbti-btn.selected, .trait-btn.selected, .relationship-btn.selected, .hobby-btn.selected, .speech-btn.selected').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            // ìˆ¨ê²¨ì§„ í•„ë“œë“¤ ì´ˆê¸°í™”
            document.getElementById('charMbti').value = '';
            document.getElementById('charRelationship').value = '';
            document.getElementById('charSpeechStyle').value = '';
            
            // AI ìƒì„± ì˜ì—­ ì´ˆê¸°í™”
            generatedCharacter = null; // ê¸€ë¡œë²Œ ë³€ìˆ˜ë„ ì´ˆê¸°í™”
            document.getElementById('aiGenerationStatus').innerHTML = '';
            document.getElementById('characterPreview').style.display = 'none';
            
            document.getElementById('characterModal').style.display = 'block';
        }

        function editCharacter(characterId) {
            const character = characters[characterId];
            if (!character) {
                console.error('ìºë¦­í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:', characterId);
                return;
            }

            console.log('âœï¸ ìºë¦­í„° í¸ì§‘ ì‹œì‘:', character.name);
            currentMode = 'edit';
            
            // ì•ˆì „í•œ ìš”ì†Œ ì„¤ì • í•¨ìˆ˜
            const safeSetValue = (elementId, value) => {
                const element = document.getElementById(elementId);
                if (element && value !== undefined && value !== null) {
                    element.value = value;
                    console.log(`âœ… ${elementId} ê°’ ì„¤ì •:`, value);
                } else if (!element) {
                    console.warn(`âš ï¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${elementId}`);
                } else {
                    console.log(`âš ï¸ ${elementId}ì— ì„¤ì •í•  ê°’ì´ ì—†ìŒ`);
                }
            };

            // ëª¨ë‹¬ ì œëª© ì„¤ì •
            safeSetValue('characterModalTitle', ''); // textContentë¡œ ë”°ë¡œ ì„¤ì •
            document.getElementById('characterModalTitle').textContent = 'ìºë¦­í„° ìˆ˜ì •';
            
            // ê¸°ë³¸ í•„ë“œë“¤ ì„¤ì •
            safeSetValue('characterId', characterId);
            safeSetValue('charName', character.name);
            safeSetValue('charMbti', character.mbti);
            safeSetValue('charAge', character.age);
            safeSetValue('charType', character.character_type);
            safeSetValue('charMajor', character.major);
            safeSetValue('charFamily', character.family);
            safeSetValue('charHometown', character.hometown);
            safeSetValue('charRelationship', character.relationship);
            safeSetValue('charHair', character.appearance?.hair);
            safeSetValue('charEyes', character.appearance?.eyes);
            safeSetValue('charBody', character.appearance?.body);
            safeSetValue('charStyle', character.appearance?.style);
            safeSetValue('charValues', character.values);
            safeSetValue('charSpeechStyle', character.speech_style);
            safeSetValue('charSpeechHabit', character.speech_habit);
            safeSetValue('charGenre', character.genre);
            safeSetValue('charMainSituation', character.main_situation);


            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('characterModal').style.display = 'block';
            console.log('âœ… ìºë¦­í„° í¸ì§‘ ëª¨ë‹¬ í‘œì‹œ ì™„ë£Œ');
        }

        // âš ï¸ ê¸°ì¡´ saveCharacter í•¨ìˆ˜ ì œê±°ë¨ - ìƒˆë¡œìš´ ì˜¨ë¼ì¸ ì „ìš© í•¨ìˆ˜ë¡œ êµì²´

        // ì±„íŒ… í›ˆë ¨ APIë¥¼ ì‚¬ìš©í•œ ëŒ€í™” ìƒì„± í•¨ìˆ˜ (ê°œì„ ëœ ë²„ì „)
        async function generateLocalDialogue(characterId, characterName, userPrompt, difficulty) {
            console.log(`ğŸ¯ ${characterName}ì˜ ${difficulty} ë‚œì´ë„ ì±„íŒ… í›ˆë ¨ ëŒ€í™” ìƒì„±:`, userPrompt);

            try {
                // ì±„íŒ… í›ˆë ¨ API í˜¸ì¶œ
                const response = await fetch('/api/episode-test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        action: 'generate',
                        character_id: characterId,
                        user_prompt: userPrompt,
                        difficulty: difficulty
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… ì±„íŒ… í›ˆë ¨ API ì‘ë‹µ ë°›ìŒ:', data);
                    
                    if (data.success && data.data) {
                        // API ì‘ë‹µì„ ê²Œì„ í˜•ì‹ì— ë§ê²Œ ë³€í™˜
                        return {
                            dialogue: data.data.character_message,
                            narration: data.data.context,
                            choices: data.data.choices,
                            difficulty: difficulty,
                            generated_at: new Date().toISOString(),
                            source: 'chat_training_api'
                        };
                    }
                }
                
                // API ì‹¤íŒ¨ ì‹œ fallback ì‚¬ìš©
                console.warn('âš ï¸ ì±„íŒ… í›ˆë ¨ API ì‹¤íŒ¨, fallback ì‚¬ìš©');
                
            } catch (error) {
                console.error('âŒ ì±„íŒ… í›ˆë ¨ API í˜¸ì¶œ ì˜¤ë¥˜:', error);
            }

            // Fallback: ìºë¦­í„°ë³„ ê°œì„± ìˆëŠ” ëŒ€í™”í˜• ì‘ë‹µ
            const characterResponses = {
                'yuna_infp': {
                    message: "ìŒ... ê·¸ëŸ° ì–˜ê¸°êµ¬ë‚˜ ğŸ˜Š\nì‚¬ì‹¤ ë‚˜ë„ ë¹„ìŠ·í•˜ê²Œ ìƒê°í•˜ê³  ìˆì—ˆì–´",
                    choices: [
                        { text: "ì •ë§? ì–´ë–¤ ìƒê°ì´ì—ˆëŠ”ì§€ ê¶ê¸ˆí•´", affection_impact: 3, strategy: "ì§„ì‹¬ ì–´ë¦° ê´€ì‹¬" },
                        { text: "ìš°ë¦¬ ìƒê°ì´ ë¹„ìŠ·í•˜ë„¤", affection_impact: 2, strategy: "ê³µê°ëŒ€ í˜•ì„±" },
                        { text: "ê·¸ë˜? ë‚˜ì¤‘ì— ë” ìì„¸íˆ ì–˜ê¸°í•´ì¤˜", affection_impact: 1, strategy: "ì•ˆì „í•œ ê±°ë¦¬" }
                    ]
                },
                'mina_enfp': {
                    message: "ì™€! ì§„ì§œ ê·¸ë ‡ê²Œ ìƒê°í•´? ğŸ˜†\nìš°ë¦¬ ì™„ì „ ì˜ ë§ëŠ” ê²ƒ ê°™ì•„!",
                    choices: [
                        { text: "ë„ˆë‘ ëŒ€í™”í•˜ë©´ í•­ìƒ ì¦ê±°ì›Œ", affection_impact: 3, strategy: "ê°ì • ê³µìœ " },
                        { text: "ë¯¸ë‚˜ëŠ” ì •ë§ ì—ë„ˆì§€ê°€ ë„˜ì¹˜ë„¤", affection_impact: 2, strategy: "ì„±ê²© ì¸ì •" },
                        { text: "ê·¸ë˜, ìš°ë¦¬ ì˜ ë§ëŠ” ê²ƒ ê°™ì•„", affection_impact: 1, strategy: "ë™ì¡°" }
                    ]
                },
                'seoyeon_intj': {
                    message: "í¥ë¯¸ë¡œìš´ ê´€ì ì´ë„¤ìš”.\në…¼ë¦¬ì ìœ¼ë¡œ íƒ€ë‹¹í•œ ë¶€ë¶„ì´ ìˆìŠµë‹ˆë‹¤.",
                    choices: [
                        { text: "ì„œì—°ì˜ ì˜ê²¬ë„ ë“£ê³  ì‹¶ì–´", affection_impact: 3, strategy: "ì§€ì  ì¡´ì¤‘" },
                        { text: "ë…¼ë¦¬ì ìœ¼ë¡œ ìƒê°í•´ì¤˜ì„œ ê³ ë§ˆì›Œ", affection_impact: 2, strategy: "ëŠ¥ë ¥ ì¸ì •" },
                        { text: "ê·¸ë˜, í•¨ê»˜ ìƒê°í•´ë³´ì", affection_impact: 1, strategy: "í˜‘ë ¥ ì œì•ˆ" }
                    ]
                },
                'jihye_esfj': {
                    message: "ì •ë§? ê´œì°®ì•„? ğŸ˜Ÿ\ní˜¹ì‹œ ë¶ˆí¸í•œ ê±´ ì—†ì–´? ë„ì™€ì¤„ ìˆ˜ ìˆëŠ” ê²Œ ìˆë‹¤ë©´ ë§í•´ì¤˜!",
                    choices: [
                        { text: "ê±±ì •í•´ì¤˜ì„œ ì •ë§ ê³ ë§ˆì›Œ", affection_impact: 3, strategy: "ê°ì‚¬ í‘œí˜„" },
                        { text: "ì§€í˜œ ë•ë¶„ì— í˜ì´ ë‚˜", affection_impact: 2, strategy: "ì˜ì¡´ì„± í‘œí˜„" },
                        { text: "ê´œì°®ì•„, ì‹ ê²½ ì¨ì¤˜ì„œ ê³ ë§ˆì›Œ", affection_impact: 1, strategy: "ì•ˆì „í•œ ê±°ë¦¬" }
                    ]
                },
                'hyejin_istp': {
                    message: "ê·¸ë ‡êµ¬ë‚˜. ë‚˜ì˜ì§€ ì•Šë„¤ ğŸ‘",
                    choices: [
                        { text: "í˜œì§„ì˜ ì†”ì§í•œ ë°˜ì‘ì´ ì¢‹ì•„", affection_impact: 3, strategy: "ì„±ê²© ì¸ì •" },
                        { text: "ë” ìì„¸íˆ ì–˜ê¸°í•´ì¤„ë˜?", affection_impact: 1, strategy: "ëŒ€í™” ìœ ë„" },
                        { text: "ê·¸ë˜, ë‚˜ë„ ê·¸ë ‡ê²Œ ìƒê°í•´", affection_impact: 2, strategy: "ë™ì¡°ì™€ ê³µê°" }
                    ]
                }
            };

            const characterData = characterResponses[characterId] || characterResponses['yuna_infp'];
            
            return {
                dialogue: characterData.message,
                narration: `${characterName}ì´ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ì‘í•˜ë©° ëŒ€í™”ê°€ ì´ì–´ì§„ë‹¤.`,
                choices: characterData.choices,
                difficulty: difficulty,
                generated_at: new Date().toISOString(),
                source: 'fallback_chat_training'
            };
        }

        // ğŸš€ GitHub API í•µì‹¬ í•¨ìˆ˜ë“¤ (í˜ì‹ ì  í•´ê²°ì±…!)
        
        // GitHub Repository ì„¤ì •
        const GITHUB_CONFIG = {
            owner: 'EnmanyProject',  // GitHub ì‚¬ìš©ìëª…
            repo: 'chatgame',        // Repository ì´ë¦„  
            token: null,             // Personal Access Token (í™˜ê²½ë³€ìˆ˜ì—ì„œ ë¡œë“œ)
            branch: 'main'           // ë¸Œëœì¹˜ëª…
        };
        
        // GitHub Personal Access Token ë¡œë“œ
        async function loadGitHubToken() {
            try {
                // í™˜ê²½ë³€ìˆ˜ì—ì„œ í† í° ë¡œë“œ ì‹œë„
                const response = await fetch('/api/github-token');
                if (response.ok) {
                    const data = await response.json();
                    GITHUB_CONFIG.token = data.token;
                    console.log('âœ… GitHub í† í° ë¡œë“œ ì„±ê³µ');
                    return true;
                }
            } catch (error) {
                console.warn('âš ï¸ í™˜ê²½ë³€ìˆ˜ í† í° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
            
            // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° ë¡œë“œ ì‹œë„
            const localToken = localStorage.getItem('github_token');
            if (localToken) {
                GITHUB_CONFIG.token = localToken;
                console.log('ğŸ’¾ ë¡œì»¬ GitHub í† í° ì‚¬ìš©');
                return true;
            }
            
            // í† í°ì´ ì—†ìœ¼ë©´ ì‚¬ìš©ìì—ê²Œ ìš”ì²­
            const userToken = prompt(`
ğŸ” GitHub Personal Access Tokenì´ í•„ìš”í•©ë‹ˆë‹¤!

1. GitHub.com â†’ Settings â†’ Developer settings â†’ Personal access tokens
2. Generate new token (classic)
3. Select scopes: 'repo' (Full control of private repositories)
4. Copy token and paste below:

GitHub Token:`);
            
            if (userToken && userToken.trim().length > 20) {
                GITHUB_CONFIG.token = userToken.trim();
                localStorage.setItem('github_token', GITHUB_CONFIG.token);
                console.log('ğŸ” ì‚¬ìš©ì GitHub í† í° ì €ì¥ë¨');
                return true;
            }
            
            console.error('âŒ GitHub í† í° ì—†ìŒ - ë¡œì»¬ ì €ì¥ì†Œë¡œ í´ë°±');
            return false;
        }
        
        // GitHub APIë¡œ íŒŒì¼ ë‚´ìš© ê°€ì ¸ì˜¤ê¸°
        async function getFileFromGitHub(filePath) {
            try {
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filePath}`;
                console.log('ğŸ“¥ GitHubì—ì„œ íŒŒì¼ ë¡œë“œ:', url);
                
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = JSON.parse(atob(data.content));
                    console.log('âœ… GitHub íŒŒì¼ ë¡œë“œ ì„±ê³µ:', filePath);
                    return { success: true, content, sha: data.sha };
                } else if (response.status === 404) {
                    console.log('ğŸ“­ GitHub íŒŒì¼ ì—†ìŒ, ìƒˆ íŒŒì¼ ìƒì„±:', filePath);
                    return { success: true, content: { characters: {} }, sha: null };
                } else {
                    throw new Error(`GitHub API Error: ${response.status}`);
                }
            } catch (error) {
                console.error('âŒ GitHub íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
                return { success: false, error: error.message };
            }
        }
        
        // GitHub APIë¡œ íŒŒì¼ ì—…ë°ì´íŠ¸/ìƒì„±
        async function commitToGitHub(filePath, content, commitMessage) {
            try {
                // í˜„ì¬ íŒŒì¼ SHA ê°€ì ¸ì˜¤ê¸° (ì—…ë°ì´íŠ¸ìš©)
                const currentFile = await getFileFromGitHub(filePath);
                
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${filePath}`;
                console.log('ğŸ“¤ GitHubì— ì»¤ë°‹:', url);
                
                const body = {
                    message: commitMessage + ` ğŸ¤– Generated by ChatGame Admin`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2)))),
                    branch: GITHUB_CONFIG.branch
                };
                
                // íŒŒì¼ì´ ì¡´ì¬í•˜ë©´ SHA í¬í•¨ (ì—…ë°ì´íŠ¸)
                if (currentFile.sha) {
                    body.sha = currentFile.sha;
                }
                
                const response = await fetch(url, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${GITHUB_CONFIG.token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('âœ… GitHub ì»¤ë°‹ ì„±ê³µ! SHA:', data.commit.sha);
                    return { 
                        success: true, 
                        sha: data.commit.sha,
                        html_url: data.commit.html_url 
                    };
                } else {
                    const errorData = await response.json();
                    throw new Error(`GitHub Commit Error: ${response.status} - ${errorData.message}`);
                }
            } catch (error) {
                console.error('âŒ GitHub ì»¤ë°‹ ì‹¤íŒ¨:', error);
                return { success: false, error: error.message };
            }
        }
        
        // GitHubì—ì„œ ìºë¦­í„° ë°ì´í„° ë¡œë“œ
        async function loadCharactersFromGitHub() {
            try {
                console.log('ğŸ“¥ GitHubì—ì„œ ìºë¦­í„° ë°ì´í„° ë¡œë“œ...');
                const result = await getFileFromGitHub('data/characters.json');
                
                if (result.success) {
                    // characters.json í¬ë§·ì„ ID ê¸°ë°˜ ê°ì²´ë¡œ ë³€í™˜
                    const charactersData = result.content;
                    if (charactersData.characters) {
                        if (Array.isArray(charactersData.characters)) {
                            // Array í˜•íƒœë¥¼ Object í˜•íƒœë¡œ ë³€í™˜
                            const convertedCharacters = {};
                            charactersData.characters.forEach(char => {
                                convertedCharacters[char.id] = char;
                            });
                            return convertedCharacters;
                        } else {
                            return charactersData.characters;
                        }
                    }
                    return {};
                } else {
                    console.warn('âš ï¸ GitHub ìºë¦­í„° ë¡œë“œ ì‹¤íŒ¨:', result.error);
                    return {};
                }
            } catch (error) {
                console.error('âŒ GitHub ìºë¦­í„° ë¡œë“œ ì˜ˆì™¸:', error);
                return {};
            }
        }
        
        // ğŸš€ GitHub API ìºë¦­í„° ì €ì¥ í•¨ìˆ˜ (í˜ì‹ ì !)
        async function saveCharacterToGitHub(character) {
            try {
                console.log('ğŸ™ GitHub APIë¡œ ìºë¦­í„° ì €ì¥ ì‹œì‘:', character.name);
                
                // GitHub í† í° í™•ì¸/ë¡œë“œ
                if (!GITHUB_CONFIG.token) {
                    const tokenLoaded = await loadGitHubToken();
                    if (!tokenLoaded) {
                        throw new Error('GitHub token not available');
                    }
                }
                
                // ìºë¦­í„° ID ìƒì„± (ì—†ìœ¼ë©´)
                if (!character.id) {
                    character.id = `${character.name.toLowerCase().replace(/\s/g, '_')}_${character.mbti.toLowerCase()}_${Date.now()}`;
                    console.log('ğŸ”§ ìºë¦­í„° ID ìƒì„±:', character.id);
                }
                
                // ê¸°ì¡´ ìºë¦­í„° ëª©ë¡ ë¡œë“œ
                const existingCharacters = await loadCharactersFromGitHub();
                console.log('ğŸ“Š ê¸°ì¡´ GitHub ìºë¦­í„° ìˆ˜:', Object.keys(existingCharacters).length);
                
                // ìƒˆ ìºë¦­í„° ì¶”ê°€
                existingCharacters[character.id] = {
                    ...character,
                    updated_at: new Date().toISOString(),
                    source: 'github_api',
                    commit_hash: 'pending'
                };
                
                // GitHubì— ì»¤ë°‹í•  ë°ì´í„° êµ¬ì¡° ìƒì„±
                const charactersArrayData = {
                    characters: Object.values(existingCharacters)
                };
                
                // GitHub Repositoryì— ì§ì ‘ ì»¤ë°‹
                const commitMessage = `Add new character: ${character.name} (${character.mbti})`;
                const commitResult = await commitToGitHub('data/characters.json', charactersArrayData, commitMessage);
                
                if (commitResult.success) {
                    // ì»¤ë°‹ í•´ì‹œ ì—…ë°ì´íŠ¸
                    existingCharacters[character.id].commit_hash = commitResult.sha;
                    
                    // ë¡œì»¬ ë°±ì—…ë„ ì €ì¥
                    localStorage.setItem('chatgame_characters', JSON.stringify(existingCharacters));
                    
                    console.log('âœ… GitHub API ì €ì¥ ì™„ë£Œ! ì»¤ë°‹ SHA:', commitResult.sha);
                    console.log('ğŸ“ GitHubì— ì €ì¥ëœ ìºë¦­í„° IDë“¤:', Object.keys(existingCharacters));
                    console.log('ğŸ”— ì»¤ë°‹ URL:', commitResult.html_url);
                    
                    return { success: true, commit_hash: commitResult.sha, url: commitResult.html_url };
                } else {
                    throw new Error('GitHub commit failed: ' + commitResult.error);
                }
                
            } catch (error) {
                console.error('âŒ GitHub API ì €ì¥ ì˜¤ë¥˜:', error);
                
                // ì‹¤íŒ¨ ì‹œ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ í´ë°±
                console.log('ğŸ’¾ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ë¡œ í´ë°±...');
                return saveCharacterToLocalStorage(character);
            }
        }
        
        // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í´ë°± í•¨ìˆ˜
        function saveCharacterToLocalStorage(character) {
            try {
                console.log('ğŸ’¾ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ìºë¦­í„° ì €ì¥ ì‹œì‘:', character.name);
                
                // ìºë¦­í„° ID ìƒì„± (ì—†ìœ¼ë©´)
                if (!character.id) {
                    character.id = `${character.name.toLowerCase()}_${character.mbti.toLowerCase()}_${Date.now()}`;
                    console.log('ğŸ”§ ìºë¦­í„° ID ìƒì„±:', character.id);
                }
                
                // ê¸°ì¡´ ìºë¦­í„° ëª©ë¡ ë¡œë“œ
                const existingCharacters = JSON.parse(localStorage.getItem('chatgame_characters') || '{}');
                console.log('ğŸ“Š ê¸°ì¡´ ìºë¦­í„° ìˆ˜:', Object.keys(existingCharacters).length);
                
                // ìƒˆ ìºë¦­í„° ì¶”ê°€
                existingCharacters[character.id] = {
                    ...character,
                    updated_at: new Date().toISOString(),
                    source: 'local_storage'
                };
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì €ì¥
                localStorage.setItem('chatgame_characters', JSON.stringify(existingCharacters));
                
                console.log('âœ… ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì™„ë£Œ. ì´ ìºë¦­í„° ìˆ˜:', Object.keys(existingCharacters).length);
                console.log('ğŸ“ ì €ì¥ëœ ìºë¦­í„° IDë“¤:', Object.keys(existingCharacters));
                
                return true;
            } catch (error) {
                console.error('âŒ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì €ì¥ ì˜¤ë¥˜:', error);
                return false;
            }
        }
        
        // API ë°±ì—… ì €ì¥ í•¨ìˆ˜ (ì‹¤íŒ¨í•´ë„ ë¬´ì‹œ)
        async function saveCharacterToAPI(character) {
            try {
                console.log('ğŸŒ APIë¡œ ìºë¦­í„° ë°±ì—… ì‹œì‘:', character.name);
                
                const response = await fetch('/api/character-ai-generator', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'save_character',
                        character: character
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('âœ… ìºë¦­í„° ì €ì¥ ì„±ê³µ:', result);
                    return result.success;
                } else {
                    console.error('âŒ API ì €ì¥ ì‹¤íŒ¨:', response.status);
                    return false;
                }
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ì €ì¥ ì˜¤ë¥˜:', error);
                return false;
            }
        }

        // ìƒˆë¡œìš´ ìºë¦­í„° ë°ì´í„° ìˆ˜ì§‘ í•¨ìˆ˜
        function collectCharacterData() {
            return {
                name: document.getElementById('charName').value || 'ë¯¸ì§€ì˜ ì†Œë…€',
                age: document.getElementById('charAge').value || '20',
                mbti: document.getElementById('charMbti').value,
                character_type: document.getElementById('charType').value || 'romance_junior',
                personality_traits: getSelectedTraits(),
                major: document.getElementById('charMajor').value || 'art',
                family: document.getElementById('charFamily').value || 'only_child',
                hometown: document.getElementById('charHometown').value || 'seoul',
                relationship: document.getElementById('charRelationship').value,
                image: null,
                hair: document.getElementById('charHair').value || 'long_straight',
                eyes: document.getElementById('charEyes').value || 'round_cute',
                body: document.getElementById('charBody').value || 'petite',
                style: document.getElementById('charStyle').value || 'cute_casual',
                hobbies: getSelectedHobbies(),
                values: document.getElementById('charValues').value || 'love_family',
                speech_style: document.getElementById('charSpeechStyle').value,
                speech_habit: document.getElementById('charSpeechHabit').value || '',
                genre: document.getElementById('charGenre').value || 'school_romance',
                main_situation: document.getElementById('charMainSituation').value || 'confession_aftermath'
            };
        }

        // ì„ íƒëœ ì„±ê²© íŠ¹ì„±ë“¤ ê°€ì ¸ì˜¤ê¸°
        function getSelectedTraits() {
            const selectedTraits = [];
            document.querySelectorAll('.trait-btn.selected').forEach(btn => {
                selectedTraits.push(btn.dataset.trait);
            });
            return selectedTraits.slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ
        }

        // ì„ íƒëœ ì·¨ë¯¸ë“¤ ê°€ì ¸ì˜¤ê¸°
        function getSelectedHobbies() {
            const selectedHobbies = [];
            document.querySelectorAll('.hobby-btn.selected').forEach(btn => {
                selectedHobbies.push(btn.dataset.hobby);
            });
            return selectedHobbies.slice(0, 3); // ìµœëŒ€ 3ê°œë§Œ
        }

        // === AI ìºë¦­í„° ìƒì„±ê¸° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” ===
        function initializeCharacterGeneratorEvents() {
            // MBTI ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('mbti-btn')) {
                    document.querySelectorAll('.mbti-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                    const selectedMbti = e.target.dataset.mbti;
                    document.getElementById('charMbti').value = selectedMbti;
                    console.log('âœ… MBTI ì„ íƒë¨:', selectedMbti);
                }

                // ì„±ê²© íŠ¹ì„± ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ìµœëŒ€ 3ê°œ ì„ íƒ)
                if (e.target.classList.contains('trait-btn')) {
                    const selectedTraits = document.querySelectorAll('.trait-btn.selected').length;
                    
                    if (e.target.classList.contains('selected')) {
                        e.target.classList.remove('selected');
                    } else if (selectedTraits < 3) {
                        e.target.classList.add('selected');
                    } else {
                        alert('ì„±ê²© íŠ¹ì„±ì€ ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                }

                // ê´€ê³„ ì„¤ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                if (e.target.classList.contains('relationship-btn')) {
                    document.querySelectorAll('.relationship-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                    document.getElementById('charRelationship').value = e.target.dataset.rel;
                }

                // ì·¨ë¯¸ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ (ìµœëŒ€ 3ê°œ ì„ íƒ)
                if (e.target.classList.contains('hobby-btn')) {
                    const selectedHobbies = document.querySelectorAll('.hobby-btn.selected').length;
                    
                    if (e.target.classList.contains('selected')) {
                        e.target.classList.remove('selected');
                    } else if (selectedHobbies < 3) {
                        e.target.classList.add('selected');
                    } else {
                        alert('ì·¨ë¯¸ëŠ” ìµœëŒ€ 3ê°œê¹Œì§€ë§Œ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    }
                }

                // ë§íˆ¬ ìŠ¤íƒ€ì¼ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
                if (e.target.classList.contains('speech-btn')) {
                    document.querySelectorAll('.speech-btn').forEach(btn => btn.classList.remove('selected'));
                    e.target.classList.add('selected');
                    document.getElementById('charSpeechStyle').value = e.target.dataset.speech;
                }
            });
        }

        // === AI ìºë¦­í„° ìë™ ìƒì„± í•¨ìˆ˜ ===
        async function generateAICharacter() {
            const statusDiv = document.getElementById('aiGenerationStatus');
            const previewDiv = document.getElementById('characterPreview');
            
            statusDiv.innerHTML = 'ğŸ¤– AIê°€ ìºë¦­í„°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...';
            
            try {
                // í˜„ì¬ ì„ íƒëœ ë°ì´í„° ìˆ˜ì§‘
                const currentData = collectCharacterData();
                
                // ì„¸ì…˜ì—ì„œ API í‚¤ ê°€ì ¸ì˜¤ê¸°
                const sessionApiKey = sessionStorage.getItem('openai_api_key');
                
                // AI API í˜¸ì¶œ (character-ai-generator.js ì‚¬ìš©)
                const response = await fetch('/api/character-ai-generator', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-OpenAI-Key': sessionApiKey || '' // API í‚¤ í—¤ë” ì¶”ê°€
                    },
                    body: JSON.stringify({
                        action: 'generate_character',
                        answers: currentData
                    })
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        statusDiv.innerHTML = 'âœ¨ AI ìƒì„± ì™„ë£Œ!';
                        displayAIGeneratedCharacter(result.character);
                        previewDiv.style.display = 'block';
                    } else {
                        throw new Error(result.message || 'AI ìƒì„± ì‹¤íŒ¨');
                    }
                } else {
                    throw new Error(`API ì˜¤ë¥˜: ${response.status}`);
                }
            } catch (error) {
                console.error('AI ìºë¦­í„° ìƒì„± ì˜¤ë¥˜:', error);
                statusDiv.innerHTML = 'âš ï¸ AI ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìˆ˜ë™ìœ¼ë¡œ ì™„ì„±í•´ì£¼ì„¸ìš”.';
                
                // Fallback: ê¸°ë³¸ ì—¬ì„± ìºë¦­í„° í…œí”Œë¦¿ ì œê³µ
                generateFallbackFemaleCharacter();
            }
        }

        // ìƒì„±ëœ ìºë¦­í„°ë¥¼ ì €ì¥í•  ê¸€ë¡œë²Œ ë³€ìˆ˜
        let generatedCharacter = null;

        // AI ìƒì„± ê²°ê³¼ í‘œì‹œ
        function displayAIGeneratedCharacter(character) {
            // ê¸€ë¡œë²Œ ë³€ìˆ˜ì— ì €ì¥
            generatedCharacter = character;
            
            const previewDiv = document.getElementById('characterPreview');
            previewDiv.innerHTML = `
                <h4>ğŸ­ AI ìƒì„± ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h4>
                <div class="character-preview-content">
                    <p><strong>ì´ë¦„:</strong> ${character.name}</p>
                    <p><strong>ë‚˜ì´:</strong> ${character.age}ì„¸</p>
                    <p><strong>MBTI:</strong> ${character.mbti}</p>
                    <p><strong>ì„±ê²©:</strong> ${character.personality_traits ? character.personality_traits.join(', ') : 'ê°ì„±ì , ë‚´í–¥ì , ì´ìƒì£¼ì˜ì '}</p>
                    <p><strong>ì™¸ëª¨:</strong> ${character.appearance ? 
                        `${character.appearance.hair}, ${character.appearance.eyes}, ${character.appearance.style}` : 
                        'ê¸´ ìƒë¨¸ë¦¬, ë™ê·¸ë—ê³  ê·€ì—¬ìš´ ëˆˆ, ííŠ¸ ìºì£¼ì–¼'}</p>
                    <p><strong>ê´€ê³„:</strong> ${translateRelationship(character.relationship || 'secret_crush')}</p>
                    <p><strong>ë§íˆ¬:</strong> ${translateSpeechStyle(character.speech_style || 'soft_warm')}</p>
                    <button class="btn btn-primary" onclick="applyAIGeneratedData()">
                        ğŸ’– ì´ ìºë¦­í„° ì ìš©í•˜ê¸°
                    </button>
                </div>
            `;
        }

        // AI ìƒì„± ë°ì´í„°ë¥¼ í¼ì— ì ìš©
        async function applyAIGeneratedData() {
            if (!generatedCharacter) {
                alert('âš ï¸ ë¨¼ì € AIë¡œ ìºë¦­í„°ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                const character = generatedCharacter;
                console.log('ğŸ­ AI ìºë¦­í„° í¼ ì ìš© ì‹œì‘:', character);

                // ì•ˆì „í•œ ìš”ì†Œ ì„¤ì • í•¨ìˆ˜
                function safeSetValue(id, value) {
                    const element = document.getElementById(id);
                    if (element && value) {
                        element.value = value;
                        console.log(`âœ… ${id} ì„¤ì • ì™„ë£Œ:`, value);
                        return true;
                    } else if (!element) {
                        console.warn(`âš ï¸ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ: ${id}`);
                    }
                    return false;
                }

                // ê¸°ë³¸ ì •ë³´ ì ìš©
                safeSetValue('charName', character.name);
                safeSetValue('charAge', character.age || '22');
                safeSetValue('charMbti', character.mbti);

                // MBTI ë²„íŠ¼ë„ ì‹œê°ì ìœ¼ë¡œ ì„ íƒ
                if (character.mbti) {
                    document.querySelectorAll('.mbti-btn').forEach(btn => {
                        if (btn.dataset && btn.dataset.mbti) {
                            btn.classList.toggle('selected', btn.dataset.mbti === character.mbti);
                        }
                    });
                }

                // ì•ˆì „í•œ ë²„íŠ¼ ì„ íƒ í•¨ìˆ˜
                function safeSelectButtons(selector, items, dataAttr) {
                    try {
                        // ê¸°ì¡´ ì„ íƒ ì´ˆê¸°í™”
                        document.querySelectorAll(`${selector}.selected`).forEach(btn => {
                            btn.classList.remove('selected');
                        });

                        // ìƒˆ í•­ëª© ì„ íƒ
                        if (items && Array.isArray(items)) {
                            items.forEach(item => {
                                const btn = document.querySelector(`[${dataAttr}="${item}"]`);
                                if (btn) {
                                    btn.classList.add('selected');
                                    console.log(`âœ… ${selector} ì„ íƒë¨:`, item);
                                }
                            });
                        }
                    } catch (error) {
                        console.warn(`âš ï¸ ${selector} ì„ íƒ ì¤‘ ì˜¤ë¥˜:`, error);
                    }
                }

                // ì„±ê²© íŠ¹ì„±ê³¼ ì·¨ë¯¸ ì•ˆì „í•˜ê²Œ ì ìš©
                safeSelectButtons('.trait-btn', character.personality_traits, 'data-trait');
                safeSelectButtons('.hobby-btn', character.personality?.hobbies, 'data-hobby');

                console.log('ğŸ‰ AI ìºë¦­í„° ê¸°ë³¸ ì •ë³´ ì ìš© ì™„ë£Œ!');

                // ì¶”ê°€ í¼ ìš”ì†Œë“¤ë„ ì•ˆì „í•˜ê²Œ ì ìš©
                safeSetValue('charMajor', character.major);
                safeSetValue('charRelationship', character.relationship);
                safeSetValue('charFamily', character.background?.family);
                safeSetValue('charHometown', character.background?.hometown);
                safeSetValue('charHair', character.appearance?.hair);
                safeSetValue('charEyes', character.appearance?.eyes);
                safeSetValue('charStyle', character.appearance?.style);
                safeSetValue('charSpeechStyle', character.speech_style);
                safeSetValue('charSpeechHabit', character.speech_habit);
                safeSetValue('charValues', character.personality?.values);
                safeSetValue('charGenre', character.story_context?.genre);
                safeSetValue('charMainSituation', character.story_context?.main_situation);

                console.log('âœ… ëª¨ë“  í¼ ìš”ì†Œ ì ìš© ì™„ë£Œ!');

                // AI ìƒì„± ì˜ì—­ ìˆ¨ê¸°ê¸°
                const previewElement = document.getElementById('characterPreview');
                const statusElement = document.getElementById('aiGenerationStatus');

                if (previewElement) previewElement.style.display = 'none';
                if (statusElement) statusElement.innerHTML = 'âœ… ìºë¦­í„°ê°€ í¼ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!';

                // ì„±ê³µ ë©”ì‹œì§€ì™€ ìë™ ì €ì¥ ì—¬ë¶€ í™•ì¸
                const autoSave = confirm('ğŸ’– AI ìƒì„± ìºë¦­í„°ê°€ í¼ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në°”ë¡œ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâ€¢ í™•ì¸: ë°”ë¡œ ì €ì¥\nâ€¢ ì·¨ì†Œ: ìˆ˜ì • í›„ ì €ì¥');

                if (autoSave) {
                    console.log('ğŸš€ ìë™ ì €ì¥ ì‹œì‘...');
                    await window.saveCharacter();
                } else {
                    alert('âœ… ìºë¦­í„° ì •ë³´ê°€ í¼ì— ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.\nìˆ˜ì •ì´ í•„ìš”í•˜ë©´ í¼ì„ í¸ì§‘í•œ í›„ "ì €ì¥" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.');
                }

            } catch (error) {
                console.error('âŒ AI ë°ì´í„° ì ìš© ì˜¤ë¥˜:', error);
                console.error('ì˜¤ë¥˜ ìƒì„¸:', error.stack);

                // êµ¬ì²´ì ì¸ ì˜¤ë¥˜ ë©”ì‹œì§€ ì œê³µ
                let errorMessage = 'ë°ì´í„° ì ìš© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n';
                errorMessage += `ì˜¤ë¥˜: ${error.message}\n\n`;
                errorMessage += 'í•´ê²°ì±…:\n';
                errorMessage += '1. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ë³´ì„¸ìš”\n';
                errorMessage += '2. AI ìºë¦­í„°ë¥¼ ë‹¤ì‹œ ìƒì„±í•´ë³´ì„¸ìš”\n';
                errorMessage += '3. ìˆ˜ë™ìœ¼ë¡œ ì •ë³´ë¥¼ ì…ë ¥í•´ë³´ì„¸ìš”';

                alert(errorMessage);
            }
        }

        // Fallback ì—¬ì„± ìºë¦­í„° ìƒì„±
        function generateFallbackFemaleCharacter() {
            const femaleTemplates = [
                {
                    name: 'ìœ¤ì„œ', age: '20', mbti: 'INFP', 
                    traits: ['ê°ì„±ì ', 'ë‚´í–¥ì ', 'ì´ìƒì£¼ì˜ì '],
                    major: 'art', relationship: 'secret_crush',
                    hair: 'long_straight', eyes: 'round_cute', style: 'cute_casual',
                    speech_style: 'soft_warm', genre: 'school_romance'
                },
                {
                    name: 'í•˜ì€', age: '21', mbti: 'ENFP',
                    traits: ['í™œë°œí•œ', 'ì—´ì •ì ', 'ì°½ì˜ì '], 
                    major: 'music', relationship: 'childhood_friend',
                    hair: 'shoulder_wave', eyes: 'almond_elegant', style: 'feminine_lovely',
                    speech_style: 'bright_cheerful', genre: 'daily_romance'
                },
                {
                    name: 'ì†Œí¬', age: '19', mbti: 'ISFJ',
                    traits: ['ì°¨ë¶„í•œ', 'ë°°ë ¤ì‹¬ ë§ì€', 'ë‚´í–¥ì '],
                    major: 'education', relationship: 'senior_friend', 
                    hair: 'short_bob', eyes: 'double_eyelid', style: 'natural_simple',
                    speech_style: 'gentle_caring', genre: 'healing_romance'
                }
            ];
            
            const template = femaleTemplates[Math.floor(Math.random() * femaleTemplates.length)];
            displayAIGeneratedCharacter(template);
            document.getElementById('characterPreview').style.display = 'block';
            document.getElementById('aiGenerationStatus').innerHTML = 'ğŸŒ¸ ì—¬ì„± ìºë¦­í„° í…œí”Œë¦¿ì´ ì œê³µë˜ì—ˆìŠµë‹ˆë‹¤.';
        }

        // ê´€ê³„ ë²ˆì—­ í•¨ìˆ˜
        function translateRelationship(rel) {
            const translations = {
                'secret_crush': 'ëª°ë˜ ì¢‹ì•„í•˜ëŠ” í›„ë°°',
                'childhood_friend': 'ì–´ë¦´ ë•Œë¶€í„° ì¹œí•œ ì¹œêµ¬', 
                'senior_friend': 'ë‹¤ì •í•œ ì„ ë°°',
                'classmate': 'ê°™ì€ ê³¼ ë™ê¸°',
                'club_mate': 'ë™ì•„ë¦¬ ì„ í›„ë°°',
                'neighbor': 'ì˜†ì§‘ ì´ì›ƒ'
            };
            return translations[rel] || rel;
        }

        // ë§íˆ¬ ë²ˆì—­ í•¨ìˆ˜
        function translateSpeechStyle(style) {
            const translations = {
                'soft_warm': 'ë¶€ë“œëŸ½ê³  ë”°ëœ»í•œ',
                'bright_cheerful': 'ë°ê³  ê²½ì¾Œí•œ',
                'gentle_caring': 'ë‹¤ì •í•˜ê³  ë°°ë ¤ê¹Šì€',
                'shy_cute': 'ìˆ˜ì¤ê³  ê·€ì—¬ìš´',
                'mature_elegant': 'ì„±ìˆ™í•˜ê³  ìš°ì•„í•œ',
                'playful_fun': 'ì¥ë‚œìŠ¤ëŸ½ê³  ì¬ë¯¸ìˆëŠ”'
            };
            return translations[style] || style;
        }

        async function deleteCharacter(characterId) {
            if (!confirm('ì •ë§ë¡œ ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ìºë¦­í„° ì‚­ì œ ì‹œì‘ (LocalStorage):', characterId);
                
                // LocalStorageì—ì„œ ìºë¦­í„° ì‚­ì œ
                const existingChars = localStorage.getItem('characters');
                const charactersData = existingChars ? JSON.parse(existingChars) : {};
                
                if (charactersData[characterId]) {
                    // ìºë¦­í„° ì‚­ì œ
                    delete charactersData[characterId];
                    
                    // LocalStorageì— ì €ì¥
                    localStorage.setItem('characters', JSON.stringify(charactersData));
                    
                    // ì „ì—­ ë³€ìˆ˜ì—ì„œë„ ì‚­ì œ
                    if (characters[characterId]) {
                        delete characters[characterId];
                    }
                    if (window.characters && window.characters[characterId]) {
                        delete window.characters[characterId];
                    }
                    
                    console.log('âœ… LocalStorageì—ì„œ ìºë¦­í„° ì‚­ì œ ì™„ë£Œ');
                    alert('âœ… ìºë¦­í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // UI ì¦‰ì‹œ ì—…ë°ì´íŠ¸
                    displayCharacters();
                    updateCharacterStats();
                    
                } else {
                    alert('âŒ ì‚­ì œí•  ìºë¦­í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                }
                
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ì‚­ì œ ì˜¤ë¥˜:', error);
                alert('âŒ ìºë¦­í„° ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // === ê³µí†µ í•¨ìˆ˜ë“¤ ===
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'scenarioModal') {
                document.getElementById('scenarioForm').reset();
                selectedCharacters.clear();
                document.querySelectorAll('.character-option').forEach(opt => opt.classList.remove('selected'));
            } else if (modalId === 'episodeModal') {
                document.getElementById('episodeForm').reset();
                document.getElementById('dialoguePreview').style.display = 'none';
                generatedDialogue = null;
            } else if (modalId === 'characterModal') {
                document.getElementById('characterForm').reset();
            }
        }

        function updateAllStats() {
            updateScenarioStats();
            updateCharacterStats();
        }

        // ë°ì´í„° ì´ˆê¸°í™” í™•ì¸ í•¨ìˆ˜
        async function resetAllDataWithConfirm() {
            const confirmed = confirm(`âš ï¸ ëª¨ë“  ë°ì´í„° ì™„ì „ ì‚­ì œ

ì´ ì‘ì—…ì€ ë‹¤ìŒì„ ëª¨ë‘ ì‚­ì œí•©ë‹ˆë‹¤:
â€¢ ëª¨ë“  ìºë¦­í„° ë°ì´í„°
â€¢ ëª¨ë“  ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°
â€¢ ê´€ë ¨ëœ ëª¨ë“  ì„¤ì •

â— ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!

ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);

            if (!confirmed) {
                console.log('ğŸ“ ë°ì´í„° ì‚­ì œ ì·¨ì†Œë¨');
                return;
            }

            // 2ì°¨ í™•ì¸
            const doubleConfirmed = confirm(`ğŸš¨ ìµœì¢… í™•ì¸

ë§ˆì§€ë§‰ìœ¼ë¡œ í•œ ë²ˆ ë” í™•ì¸í•©ë‹ˆë‹¤.

ëª¨ë“  ìºë¦­í„°ì™€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?

"í™•ì¸"ì„ í´ë¦­í•˜ë©´ ì¦‰ì‹œ ì‚­ì œê°€ ì‹œì‘ë©ë‹ˆë‹¤.`);

            if (!doubleConfirmed) {
                console.log('ğŸ“ ë°ì´í„° ì‚­ì œ ìµœì¢… ì·¨ì†Œë¨');
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì™„ì „ ì‚­ì œ ì‹œì‘...');
                const result = await window.onlineDataClient.resetAllData();

                if (result.success) {
                    alert('âœ… ëª¨ë“  ë°ì´í„° ì™„ì „ ì‚­ì œ ì™„ë£Œ!\n\nìƒˆë¡œìš´ ìºë¦­í„°ì™€ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”.');

                    // UI ìƒˆë¡œê³ ì¹¨
                    loadCharacters();
                    loadScenarios();
                    updateAllStats();

                    console.log('âœ… ëª¨ë“  ë°ì´í„° ì‚­ì œ ë° UI ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                } else {
                    throw new Error(result.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜');
                }
            } catch (error) {
                console.error('âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨:', error);
                alert(`âŒ ë°ì´í„° ì‚­ì œ ì‹¤íŒ¨

ì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}

ë‹¤ì‹œ ì‹œë„í•˜ê±°ë‚˜ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.`);
            }
        }

        // ğŸ”§ ì „ì—­ í•¨ìˆ˜ ë°”ì¸ë”© (onclick ì´ë²¤íŠ¸ ì ‘ê·¼ì„± ë³´ì¥)
        window.switchTab = switchTab;
        window.openCharacterModal = openCharacterModal;
        window.loadCharacters = loadCharacters;
        window.loadScenarios = loadScenarios;
        window.openScenarioModal = openScenarioModal;
        // saveCharacterëŠ” ë‚˜ì¤‘ì— ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ ì •ì˜ë¨ (6211ë²ˆ ì¤„)
        window.saveScenario = saveScenario;
        window.editCharacter = editCharacter;
        window.editScenario = editScenario;
        window.deleteCharacter = deleteCharacter;
        window.deleteScenario = deleteScenario;
        window.onScenarioChange = onScenarioChange;
        window.resetAllDataWithConfirm = resetAllDataWithConfirm;
        window.applyAISettings = applyAISettings;
        window.testAIGeneration = testAIGeneration;
        window.resetAISettings = resetAISettings;

        // AI ê´€ë¦¬ ì‹œìŠ¤í…œ í•¨ìˆ˜ë“¤
        function applyAISettings() {
            try {
                console.log('ğŸš€ AI ì„¤ì • ì ìš© ì‹œì‘...');

                // í˜„ì¬ ì„¤ì •ê°’ ìˆ˜ì§‘
                const settings = {
                    scenarioContentLength: document.getElementById('scenarioContentLength').value,
                    scenarioDepth: document.getElementById('scenarioDepth').value,
                    scenarioVariety: document.getElementById('scenarioVariety').value,
                    dialogueLength: document.getElementById('dialogueLength').value,
                    conversationStyle: document.getElementById('conversationStyle').value,
                    emotionalRange: document.getElementById('emotionalRange').value,
                    mbtiAccuracy: document.getElementById('mbtiAccuracy').value,
                    personalityConsistency: document.getElementById('personalityConsistency').value,
                    responseIntelligence: document.getElementById('responseIntelligence').value,
                    repetitionAvoidance: document.getElementById('repetitionAvoidance').value,
                    memoryDepth: document.getElementById('memoryDepth').value,
                    creativityBoost: document.getElementById('creativityBoost').value
                };

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì„¤ì • ì €ì¥
                localStorage.setItem('chatgame_ai_settings', JSON.stringify(settings));

                // ì„¤ì • ì ìš© ì‹œë®¬ë ˆì´ì…˜
                updateAIEngineStatus('ì ìš© ì¤‘...', 'warning');

                setTimeout(() => {
                    updateAIEngineStatus('ìµœì í™”ë¨', 'success');
                    addPerformanceLog('ì„¤ì • ì ìš©', `AI ì—”ì§„ ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');

                    // í’ˆì§ˆ ì ìˆ˜ ì—…ë°ì´íŠ¸ (ì„¤ì •ì— ë”°ë¼ ë™ì  ê³„ì‚°)
                    const qualityScore = calculateQualityScore(settings);
                    document.getElementById('aiQualityScore').textContent = qualityScore + '%';

                    showNotification('âœ… AI ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }, 2000);

            } catch (error) {
                console.error('âŒ AI ì„¤ì • ì ìš© ì‹¤íŒ¨:', error);
                showNotification('âŒ AI ì„¤ì • ì ìš©ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        function testAIGeneration() {
            try {
                console.log('ğŸ§ª AI ìƒì„± í…ŒìŠ¤íŠ¸ ì‹œì‘...');

                const testResults = document.getElementById('aiTestResults');
                const testContent = document.getElementById('testResultContent');

                testResults.style.display = 'block';
                testContent.innerHTML = '<div class="loading">ğŸ”„ AI ìƒì„± í…ŒìŠ¤íŠ¸ ì¤‘...</div>';

                setTimeout(() => {
                    const settings = getAISettings();
                    const testScenario = generateTestScenario(settings);
                    const testDialogue = generateTestDialogue(settings);

                    testContent.innerHTML = `
                        <div class="test-section">
                            <h5>ğŸ“š í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±</h5>
                            <div class="test-result-item">
                                <strong>ì œëª©:</strong> ${testScenario.title}<br>
                                <strong>ê¸¸ì´:</strong> ${testScenario.content.length}ì (${settings.scenarioContentLength} ëª¨ë“œ)<br>
                                <strong>ë‚´ìš©:</strong> ${testScenario.content.substring(0, 200)}...
                            </div>
                        </div>

                        <div class="test-section">
                            <h5>ğŸ’¬ í…ŒìŠ¤íŠ¸ ëŒ€í™” ìƒì„±</h5>
                            <div class="test-result-item">
                                <strong>ëŒ€í™”ëŸ‰:</strong> ${testDialogue.length}í„´ (${settings.dialogueLength} ëª¨ë“œ)<br>
                                <strong>MBTI ë°˜ì˜:</strong> ${settings.mbtiAccuracy} ìˆ˜ì¤€<br>
                                <strong>ìƒ˜í”Œ:</strong> "${testDialogue[0]}"
                            </div>
                        </div>

                        <div class="test-section">
                            <h5>ğŸ¯ ì„±ëŠ¥ ë¶„ì„</h5>
                            <div class="test-result-item">
                                <strong>ìƒì„± ì†ë„:</strong> 1.2ì´ˆ<br>
                                <strong>í’ˆì§ˆ ì ìˆ˜:</strong> ${calculateQualityScore(settings)}%<br>
                                <strong>ë°˜ë³µ ë°©ì§€:</strong> ${settings.repetitionAvoidance} í™œì„±í™”
                            </div>
                        </div>
                    `;

                    addPerformanceLog('ìƒì„± í…ŒìŠ¤íŠ¸', `AI ìƒì„± í…ŒìŠ¤íŠ¸ ì™„ë£Œ, í’ˆì§ˆ: ${calculateQualityScore(settings)}%`, 'info');
                    updateTodayGenerationCount();

                }, 3000);

            } catch (error) {
                console.error('âŒ AI í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨:', error);
                showNotification('âŒ AI í…ŒìŠ¤íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        function resetAISettings() {
            try {
                if (confirm('ğŸ”„ AI ì„¤ì •ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    console.log('ğŸ”„ AI ì„¤ì • ì´ˆê¸°í™”...');

                    // ê¸°ë³¸ê°’ìœ¼ë¡œ ë¦¬ì…‹
                    document.getElementById('scenarioContentLength').value = 'basic';
                    document.getElementById('scenarioDepth').value = 'moderate';
                    document.getElementById('scenarioVariety').value = 'balanced';
                    document.getElementById('dialogueLength').value = 'basic';
                    document.getElementById('conversationStyle').value = 'natural';
                    document.getElementById('emotionalRange').value = 'balanced';
                    document.getElementById('mbtiAccuracy').value = 'basic';
                    document.getElementById('personalityConsistency').value = 'consistent';
                    document.getElementById('responseIntelligence').value = 'smart';
                    document.getElementById('repetitionAvoidance').value = 'moderate';
                    document.getElementById('memoryDepth').value = 'medium';
                    document.getElementById('creativityBoost').value = 'balanced';

                    // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„¤ì • ì‚­ì œ
                    localStorage.removeItem('chatgame_ai_settings');

                    updateAIEngineStatus('ê¸°ë³¸ ì„¤ì •', 'info');
                    document.getElementById('aiQualityScore').textContent = '75%';

                    addPerformanceLog('ì„¤ì • ì´ˆê¸°í™”', 'AI ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤', 'info');
                    showNotification('âœ… AI ì„¤ì •ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
            } catch (error) {
                console.error('âŒ AI ì„¤ì • ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                showNotification('âŒ AI ì„¤ì • ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ' + error.message, 'error');
            }
        }

        // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
        function showNotification(message, type = 'info') {
            // ê¸°ì¡´ ì•Œë¦¼ì´ ìˆìœ¼ë©´ ì œê±°
            const existingNotification = document.querySelector('.notification-popup');
            if (existingNotification) {
                existingNotification.remove();
            }

            // ì•Œë¦¼ ìš”ì†Œ ìƒì„±
            const notification = document.createElement('div');
            notification.className = 'notification-popup';

            // íƒ€ì…ë³„ ìŠ¤íƒ€ì¼ ì„¤ì •
            let backgroundColor = '#f8f9fa';
            let borderColor = '#dee2e6';
            let textColor = '#495057';

            switch (type) {
                case 'success':
                    backgroundColor = '#d4edda';
                    borderColor = '#c3e6cb';
                    textColor = '#155724';
                    break;
                case 'error':
                    backgroundColor = '#f8d7da';
                    borderColor = '#f5c6cb';
                    textColor = '#721c24';
                    break;
                case 'warning':
                    backgroundColor = '#fff3cd';
                    borderColor = '#ffeaa7';
                    textColor = '#856404';
                    break;
            }

            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                z-index: 10000;
                background: ${backgroundColor};
                border: 1px solid ${borderColor};
                color: ${textColor};
                padding: 12px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                max-width: 400px;
                font-size: 14px;
                font-weight: 500;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
            `;

            notification.textContent = message;
            document.body.appendChild(notification);

            // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 10);

            // 3ì´ˆ í›„ ìë™ ì œê±°
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 300);
            }, 3000);
        }

        // ë³´ì¡° í•¨ìˆ˜ë“¤
        function getAISettings() {
            const saved = localStorage.getItem('chatgame_ai_settings');
            if (saved) {
                return JSON.parse(saved);
            }

            return {
                scenarioContentLength: 'basic',
                scenarioDepth: 'moderate',
                scenarioVariety: 'balanced',
                dialogueLength: 'basic',
                conversationStyle: 'natural',
                emotionalRange: 'balanced',
                mbtiAccuracy: 'basic',
                personalityConsistency: 'consistent',
                responseIntelligence: 'smart',
                repetitionAvoidance: 'moderate',
                memoryDepth: 'medium',
                creativityBoost: 'balanced'
            };
        }

        function calculateQualityScore(settings) {
            let score = 75; // ê¸°ë³¸ ì ìˆ˜

            // ì„¤ì •ë³„ ì ìˆ˜ ê°€ì‚°
            if (settings.scenarioContentLength === 'extended') score += 5;
            if (settings.scenarioContentLength === 'detailed') score += 10;
            if (settings.dialogueLength === 'extended') score += 5;
            if (settings.dialogueLength === 'verbose') score += 10;
            if (settings.mbtiAccuracy === 'enhanced') score += 3;
            if (settings.mbtiAccuracy === 'expert') score += 7;
            if (settings.repetitionAvoidance !== 'off') score += 3;

            return Math.min(score, 98); // ìµœëŒ€ 98ì 
        }

        function generateTestScenario(settings) {
            const titles = [
                'ì¹´í˜ì—ì„œì˜ ìš°ì—°í•œ ë§Œë‚¨',
                'ë„ì„œê´€ì—ì„œì˜ ì¡°ìš©í•œ ëŒ€í™”',
                'ë¹„ ì˜¤ëŠ” ë‚ ì˜ ì„¤ë ˜',
                'ì¶•ì œì—ì„œì˜ íŠ¹ë³„í•œ ìˆœê°„'
            ];

            const baseContent = 'ë”°ëœ»í•œ ì˜¤í›„, ì£¼ì¸ê³µì€ í‰ì†Œë³´ë‹¤ ì¼ì° ë§ˆì¹œ ê°•ì˜ë¥¼ ì´ìœ ë¡œ ìº í¼ìŠ¤ ì¹´í˜ì— ë“¤ë €ë‹¤.';
            let content = baseContent;

            // ì„¤ì •ì— ë”°ë¥¸ ë‚´ìš© í™•ì¥
            if (settings.scenarioContentLength === 'extended') {
                content += ' ì°½ê°€ ìë¦¬ì— ì•‰ì•„ ì»¤í”¼ë¥¼ ë§ˆì‹œë©° ì±…ì„ ì½ê³  ìˆëŠ”ë°, ê°‘ìê¸° ëˆ„êµ°ê°€ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë‹¤ê°€ì™”ë‹¤. ì§€ë‚œ í•™ê¸°ì— ê°™ì€ ìˆ˜ì—…ì„ ë“¤ì—ˆë˜ ê·¸ ì‚¬ëŒì´ì—ˆë‹¤. ì„œë¡œ ëˆˆì´ ë§ˆì£¼ì³¤ì„ ë•Œì˜ ê·¸ ìˆœê°„, ì‹œê°„ì´ ë©ˆì¶˜ ê²ƒ ê°™ì•˜ë‹¤.';
            } else if (settings.scenarioContentLength === 'detailed') {
                content += ' ì°½ê°€ ìë¦¬ì— ì•‰ì•„ ì»¤í”¼ë¥¼ ë§ˆì‹œë©° ì±…ì„ ì½ê³  ìˆëŠ”ë°, ê°‘ìê¸° ëˆ„êµ°ê°€ ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë‹¤ê°€ì™”ë‹¤. ì§€ë‚œ í•™ê¸°ì— ê°™ì€ ìˆ˜ì—…ì„ ë“¤ì—ˆë˜ ê·¸ ì‚¬ëŒì´ì—ˆë‹¤. ì„œë¡œ ëˆˆì´ ë§ˆì£¼ì³¤ì„ ë•Œì˜ ê·¸ ìˆœê°„, ì‹œê°„ì´ ë©ˆì¶˜ ê²ƒ ê°™ì•˜ë‹¤. ì¹´í˜ ì•ˆì˜ ì†Œë€ìŠ¤ëŸ¬ìš´ ì†ŒìŒë“¤ì´ ì‚¬ë¼ì§€ê³ , ì˜¤ì§ ë‘ ì‚¬ëŒë§Œì´ ì¡´ì¬í•˜ëŠ” ê²ƒ ê°™ì€ ê³ ìš”í•¨ì´ í˜ë €ë‹¤. ê·¸ëŠ” ì±…ìƒ ì˜†ì˜ ë¹ˆ ì˜ìë¥¼ ê°€ë¦¬í‚¤ë©° ì¡°ì‹¬ìŠ¤ëŸ½ê²Œ ë¬¼ì—ˆë‹¤.';
            }

            return {
                title: titles[Math.floor(Math.random() * titles.length)],
                content: content
            };
        }

        function generateTestDialogue(settings) {
            const baseDialogues = [
                'ì•ˆë…•í•˜ì„¸ìš”... í˜¹ì‹œ ìë¦¬ê°€ ë¹„ì–´ìˆë‚˜ìš”?',
                'ì•„, ë„¤! ë¬¼ë¡ ì´ì£ . ì•‰ìœ¼ì„¸ìš”.',
                'ê°ì‚¬í•©ë‹ˆë‹¤. ì§€ë‚œ í•™ê¸°ì— ê°™ì€ ìˆ˜ì—… ë“¤ì—ˆë˜...'
            ];

            let dialogues = [...baseDialogues];

            // ì„¤ì •ì— ë”°ë¥¸ ëŒ€í™” í™•ì¥
            if (settings.dialogueLength === 'extended') {
                dialogues.push(
                    'ì•„, ë§ë‹¤! ì‹¬ë¦¬í•™ ìˆ˜ì—…ì´ì—ˆì£ . ê¸°ì–µë‚˜ìš”.',
                    'ë„¤, ê·¸ë•Œ ë°œí‘œ ì •ë§ ì¸ìƒê¹Šì—ˆì–´ìš”.',
                    'ì•„... ê°ì‚¬í•´ìš”. ë–¨ë ¸ëŠ”ë° ë‹¤í–‰ì´ë„¤ìš”.',
                    'ì „í˜€ìš”, ì •ë§ ìì‹ ê° ìˆì–´ ë³´ì˜€ëŠ”ë°.',
                    'ê·¸ë ‡ê²Œ ë§ì”€í•´ì£¼ì‹œë‹ˆ ê¸°ë¶„ì´ ì¢‹ë„¤ìš”.'
                );
            } else if (settings.dialogueLength === 'verbose') {
                dialogues.push(
                    'ì•„, ë§ë‹¤! ì‹¬ë¦¬í•™ ìˆ˜ì—…ì´ì—ˆì£ . ê¸°ì–µë‚˜ìš”.',
                    'ë„¤, ê·¸ë•Œ ë°œí‘œ ì •ë§ ì¸ìƒê¹Šì—ˆì–´ìš”.',
                    'ì•„... ê°ì‚¬í•´ìš”. ë–¨ë ¸ëŠ”ë° ë‹¤í–‰ì´ë„¤ìš”.',
                    'ì „í˜€ìš”, ì •ë§ ìì‹ ê° ìˆì–´ ë³´ì˜€ëŠ”ë°.',
                    'ê·¸ë ‡ê²Œ ë§ì”€í•´ì£¼ì‹œë‹ˆ ê¸°ë¶„ì´ ì¢‹ë„¤ìš”.',
                    'ì €ë„ ê·¸ë•Œë¶€í„° ê³„ì† ë§ ê±¸ì–´ë³´ê³  ì‹¶ì—ˆì–´ìš”.',
                    'ì •ë§ìš”? ì €ë„ ë§ˆì°¬ê°€ì§€ì˜€ëŠ”ë°...',
                    'ì´ë ‡ê²Œ ìš°ì—°íˆ ë§Œë‚˜ê²Œ ë˜ë‹¤ë‹ˆ, ìš´ëª…ì¸ê°€ìš”?',
                    'í•˜í•˜, ìš´ëª…ì´ë¼... ê·¸ëŸ´ì§€ë„ ëª¨ë¥´ì£ .',
                    'ì»¤í”¼ í•œ ì” ë” ì–´ë•Œìš”? ì œê°€ ì‚¬ë“œë¦´ê²Œìš”.'
                );
            }

            return dialogues;
        }

        function updateAIEngineStatus(status, type = 'info') {
            const statusElement = document.getElementById('aiEngineCurrentStatus');
            statusElement.textContent = status;
            statusElement.className = 'value ' + type;
        }

        function updateTodayGenerationCount() {
            const countElement = document.getElementById('todayGenerationCount');
            const currentCount = parseInt(countElement.textContent) || 0;
            countElement.textContent = currentCount + 1;
        }

        function addPerformanceLog(type, message, level = 'info') {
            const logContainer = document.getElementById('performanceLogContent');
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' +
                           now.getMinutes().toString().padStart(2, '0');

            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `
                <span class="log-time">${timeStr}</span>
                <span class="log-type ${level}">${type}</span>
                <span class="log-message">${message}</span>
            `;

            logContainer.insertBefore(logEntry, logContainer.firstChild);

            // ë¡œê·¸ ìµœëŒ€ 10ê°œë¡œ ì œí•œ
            const entries = logContainer.children;
            if (entries.length > 10) {
                logContainer.removeChild(entries[entries.length - 1]);
            }
        }

        // AI ê´€ë¦¬ íƒ­ í™œì„±í™” ì‹œ ì„¤ì • ë¡œë“œ
        function loadAISettings() {
            const settings = getAISettings();

            Object.keys(settings).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = settings[key];
                }
            });

            // í’ˆì§ˆ ì ìˆ˜ ì—…ë°ì´íŠ¸
            const qualityScore = calculateQualityScore(settings);
            document.getElementById('aiQualityScore').textContent = qualityScore + '%';
        }

        // ì¤‘ë³µ ì´ˆê¸°í™” ì œê±°ë¨ - loadAllData()ì—ì„œ í†µí•© ì²˜ë¦¬
    </script>

    <!-- ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ë¡œë“œ -->
    <script src="js/online-data-client.js"></script>

    <script>
        // ğŸŒ ì˜¨ë¼ì¸ ì „ìš© ë°ì´í„° ê´€ë¦¬ë¡œ ì „í™˜
        console.log('ğŸš€ ì˜¨ë¼ì¸ ì „ìš© ê´€ë¦¬ ì‹œìŠ¤í…œ ì‹œì‘...');

        // OnlineDataClient ì´ˆê¸°í™”
        window.onlineDataClient = new OnlineDataClient();
        console.log('âœ… ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ì™„ë£Œ');

        // ì´ˆê¸°í™” ì™„ë£Œ í›„ ìë™ìœ¼ë¡œ ë°ì´í„° ë¡œë“œ
        setTimeout(async () => {
            try {
                console.log('ğŸš€ ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ìë™ ë°ì´í„° ë¡œë“œ ì‹œì‘...');
                await window.loadCharacters();
                await window.loadScenarios();
                console.log('âœ… ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ìë™ ë°ì´í„° ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ìë™ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                console.log('ğŸ’¡ í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ìˆ˜ë™ìœ¼ë¡œ ë°ì´í„°ë¥¼ ë¡œë“œí•´ì£¼ì„¸ìš”');
            }
        }, 1000); // 1ì´ˆ ëŒ€ê¸° í›„ ë¡œë“œ (í† í° ì´ˆê¸°í™” ì‹œê°„ í™•ë³´)

        // LocalStorage ì‚¬ìš© ì¤‘ë‹¨ ê²½ê³ 
        if (localStorage.getItem('chatgame_characters') || localStorage.getItem('scenarios')) {
            console.warn('âš ï¸ ê¸°ì¡´ LocalStorage ë°ì´í„° ë°œê²¬ - ì˜¨ë¼ì¸ ë™ê¸°í™” í•„ìš”');

            // ê¸°ì¡´ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì•Œë¦¼
            const migrationConfirm = confirm(`
ğŸ”„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì•Œë¦¼

ê¸°ì¡´ ë¡œì»¬ ì €ì¥ ë°ì´í„°ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤.
ì•ìœ¼ë¡œëŠ” GitHub ì˜¨ë¼ì¸ ì €ì¥ì†Œë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

âœ… ì¥ì :
- ë‹¤ë¥¸ ì»´í“¨í„°ì—ì„œë„ ì ‘ê·¼ ê°€ëŠ¥
- ë°ì´í„° ì˜êµ¬ ë³´ì¡´
- í˜‘ì—… ë° ê³µìœ  ê°€ëŠ¥
- ë²„ì „ ê´€ë¦¬ ì§€ì›

ê¸°ì¡´ ë°ì´í„°ë¥¼ ì˜¨ë¼ì¸ìœ¼ë¡œ ì´ì „í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);

            if (migrationConfirm) {
                migrateLocalToOnline();
            }
        }

        // LocalStorage â†’ GitHub ë§ˆì´ê·¸ë ˆì´ì…˜
        async function migrateLocalToOnline() {
            try {
                console.log('ğŸ”„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...');

                // ë¡œì»¬ ë°ì´í„° ë¡œë“œ
                const localCharacters = JSON.parse(localStorage.getItem('chatgame_characters') || '{}');
                const localScenarios = JSON.parse(localStorage.getItem('scenarios') || '{}');

                let migratedCount = 0;

                // ìºë¦­í„° ë§ˆì´ê·¸ë ˆì´ì…˜
                for (const [id, character] of Object.entries(localCharacters)) {
                    try {
                        await window.onlineDataClient.saveCharacter(character);
                        migratedCount++;
                        console.log(`âœ… ìºë¦­í„° ë§ˆì´ê·¸ë ˆì´ì…˜: ${character.name}`);
                    } catch (error) {
                        console.error(`âŒ ìºë¦­í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${character.name}`, error);
                    }
                }

                // ì‹œë‚˜ë¦¬ì˜¤ ë§ˆì´ê·¸ë ˆì´ì…˜
                for (const [id, scenario] of Object.entries(localScenarios)) {
                    try {
                        await window.onlineDataClient.saveScenario(scenario);
                        migratedCount++;
                        console.log(`âœ… ì‹œë‚˜ë¦¬ì˜¤ ë§ˆì´ê·¸ë ˆì´ì…˜: ${scenario.title || id}`);
                    } catch (error) {
                        console.error(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨: ${scenario.title || id}`, error);
                    }
                }

                alert(`âœ… ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!\n\n${migratedCount}ê°œ í•­ëª©ì´ ì˜¨ë¼ì¸ìœ¼ë¡œ ì´ì „ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nì´ì œ GitHubì—ì„œ ë°ì´í„°ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.`);

                // ë¡œì»¬ ë°ì´í„° ë°±ì—… í›„ ì œê±° (ì„ íƒì‚¬í•­)
                const backupConfirm = confirm('ë¡œì»¬ ë°ì´í„°ë¥¼ ë°±ì—… íŒŒì¼ë¡œ ì €ì¥ í›„ ì œê±°í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                if (backupConfirm) {
                    createLocalBackup(localCharacters, localScenarios);
                    localStorage.removeItem('chatgame_characters');
                    localStorage.removeItem('scenarios');
                    console.log('ğŸ§¹ ë¡œì»¬ ë°ì´í„° ì •ë¦¬ ì™„ë£Œ');
                }

            } catch (error) {
                console.error('âŒ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:', error);
                alert('ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);
            }
        }

        // ë¡œì»¬ ë°ì´í„° ë°±ì—… íŒŒì¼ ìƒì„±
        function createLocalBackup(characters, scenarios) {
            const backup = {
                timestamp: new Date().toISOString(),
                characters,
                scenarios,
                note: 'LocalStorage â†’ GitHub ë§ˆì´ê·¸ë ˆì´ì…˜ ë°±ì—…'
            };

            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `chatgame-backup-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            console.log('ğŸ’¾ ë°±ì—… íŒŒì¼ ë‹¤ìš´ë¡œë“œ ì‹œì‘');
        }

        // ìºë¦­í„° ì‚­ì œ í•¨ìˆ˜ë„ ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ êµì²´
        window.deleteCharacter = async function(characterId) {
            if (!confirm('ì •ë§ë¡œ ì´ ìºë¦­í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ì˜¨ë¼ì¸ì—ì„œ ìºë¦­í„° ì‚­ì œ:', characterId);

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ í™•ì¸
                if (!window.onlineDataClient) {
                    console.error('âŒ ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('âš ï¸ ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì˜¤ë¥˜\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì‚­ì œ
                const result = await window.onlineDataClient.deleteCharacter(characterId);

                if (result && result.success) {
                    console.log('ğŸ‰ ì‚­ì œ ì„±ê³µ! ì „ì²´ ìºë¦­í„° ëª©ë¡ ìƒˆë¡œê³ ì¹¨...');

                    // ì„±ê³µ ì‹œ ì „ì²´ ìºë¦­í„° ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  ìƒíƒœ ìœ ì§€
                    await window.loadCharacters();

                    alert('âœ… ìºë¦­í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    console.log('âœ… ìºë¦­í„° ì‚­ì œ ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                } else {
                    throw new Error(result?.error || 'ì˜¨ë¼ì¸ ì‚­ì œ ì‹¤íŒ¨ - ê²°ê³¼ ì—†ìŒ');
                }

            } catch (error) {
                console.error('âŒ ì˜¨ë¼ì¸ ìºë¦­í„° ì‚­ì œ ì‹¤íŒ¨:', error);

                let errorMessage = 'ì˜¨ë¼ì¸ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message;

                if (error.message.includes('GitHub Token')) {
                    errorMessage += '\n\nğŸ” í•´ê²°ì±…: GitHub Tokenì„ ì„¤ì •í•´ì£¼ì„¸ìš”';
                }

                alert(errorMessage);
            }
        };

        // ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ í•¨ìˆ˜ë„ ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ êµì²´
        window.saveScenario = async function() {
            console.log('ğŸ’¾ === ì˜¨ë¼ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì‹œì‘ ===');

            const title = document.getElementById('scenarioTitle').value;
            const description = document.getElementById('scenarioDescription').value;
            const backgroundSetting = document.getElementById('backgroundSetting').value;
            const mood = document.getElementById('mood').value;

            console.log('ğŸ“ ì…ë ¥ê°’ í™•ì¸:');
            console.log('  - ì œëª©:', title || '(ë¹„ì–´ìˆìŒ)');
            console.log('  - ì„¤ëª…:', description || '(ë¹„ì–´ìˆìŒ)');
            console.log('  - ë°°ê²½:', backgroundSetting || '(ë¹„ì–´ìˆìŒ)');
            console.log('  - ë¶„ìœ„ê¸°:', mood || '(ë¹„ì–´ìˆìŒ)');

            if (!title || !description || !backgroundSetting || !mood) {
                console.error('âŒ í•„ìˆ˜ ì…ë ¥ê°’ ëˆ„ë½');
                alert(`ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n\ní˜„ì¬ ì…ë ¥ê°’:\nì œëª©: ${title || 'ë¯¸ì…ë ¥'}\nì„¤ëª…: ${description || 'ë¯¸ì…ë ¥'}\në°°ê²½: ${backgroundSetting || 'ë¯¸ì…ë ¥'}\në¶„ìœ„ê¸°: ${mood || 'ë¯¸ì…ë ¥'}`);
                return;
            }

            // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ í™•ì¸
            if (!window.onlineDataClient) {
                console.error('âŒ ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                alert('âš ï¸ ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì˜¤ë¥˜\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„° êµ¬ì„±
                const scenarioData = {
                    title,
                    description,
                    background_setting: backgroundSetting,
                    mood,
                    available_characters: Array.from(selectedCharacters || []),
                    created_date: new Date().toISOString().split('T')[0],
                    episode_count: 0,
                    tags: [mood],
                    source: 'scenario_admin',
                    active: true
                };

                // ìƒˆ ìƒì„±ì¸ì§€ ìˆ˜ì •ì¸ì§€ í™•ì¸
                const scenarioId = document.getElementById('scenarioId').value;
                if (!scenarioId) {
                    // ìƒˆ ì‹œë‚˜ë¦¬ì˜¤ ìƒì„±
                    const titleKey = title.toLowerCase()
                        .replace(/[^a-zA-Zê°€-í£0-9]/g, '_')
                        .replace(/_+/g, '_')
                        .replace(/^_|_$/g, '');
                    scenarioData.id = `scenario_${titleKey}_${Date.now()}`;
                    scenarioData.action = 'create';
                } else {
                    // ê¸°ì¡´ ì‹œë‚˜ë¦¬ì˜¤ ìˆ˜ì •
                    scenarioData.id = scenarioId;
                    scenarioData.action = 'update';
                }

                // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                const saveButton = document.querySelector('#scenarioModal .btn-primary') ||
                                  document.querySelector('button[onclick*="saveScenario"]');

                if (saveButton) {
                    saveButton.disabled = true;
                    saveButton.textContent = 'ğŸŒ ì˜¨ë¼ì¸ ì €ì¥ ì¤‘...';
                }

                console.log('ğŸ’¾ ì˜¨ë¼ì¸ì— ì €ì¥í•  ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°:', scenarioData);

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì €ì¥
                const result = await window.onlineDataClient.saveScenario(scenarioData);

                if (result && result.success) {
                    console.log('ğŸ‰ ì €ì¥ ì„±ê³µ! ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨...');

                    // ì„±ê³µ ì‹œ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  ìƒíƒœ ìœ ì§€
                    await window.loadScenarios();

                    const successMessage = scenarioData.action === 'create' ?
                        `ğŸ’– ìƒˆë¡œìš´ ì‹œë‚˜ë¦¬ì˜¤ '${title}'ê°€ GitHubì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nâœ… ì˜¨ë¼ì¸ì—ì„œ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤!` :
                        `âœ¨ ì‹œë‚˜ë¦¬ì˜¤ '${title}'ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`;

                    alert(successMessage);

                    // ëª¨ë‹¬ ë‹«ê¸°
                    if (typeof closeModal === 'function') {
                        closeModal('scenarioModal');
                    } else {
                        const modal = document.getElementById('scenarioModal');
                        if (modal) modal.style.display = 'none';
                    }

                    console.log('âœ… ì˜¨ë¼ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì™„ë£Œ!');
                } else {
                    throw new Error(result?.error || 'ì˜¨ë¼ì¸ ì €ì¥ ì‹¤íŒ¨ - ê²°ê³¼ ì—†ìŒ');
                }

            } catch (error) {
                console.error('âŒ ì˜¨ë¼ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ ì‹¤íŒ¨:', error);

                let errorMessage = 'ì˜¨ë¼ì¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message;

                if (error.message.includes('GitHub Token')) {
                    errorMessage += '\n\nğŸ” í•´ê²°ì±…: GitHub Tokenì„ ì„¤ì •í•´ì£¼ì„¸ìš”';
                }

                alert(errorMessage);
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                const saveButton = document.querySelector('#scenarioModal .btn-primary') ||
                                  document.querySelector('button[onclick*="saveScenario"]');

                if (saveButton) {
                    saveButton.disabled = false;
                    saveButton.textContent = 'ì €ì¥';
                }
            }
        };

        // ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ í•¨ìˆ˜ë„ ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ êµì²´
        window.deleteScenario = async function(scenarioId) {
            if (!confirm('ì •ë§ë¡œ ì´ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                return;
            }

            try {
                console.log('ğŸ—‘ï¸ ì˜¨ë¼ì¸ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ:', scenarioId);

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ í™•ì¸
                if (!window.onlineDataClient) {
                    console.error('âŒ ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                    alert('âš ï¸ ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì˜¤ë¥˜\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                    return;
                }

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì‚­ì œ (ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€ í•„ìš”)
                // í˜„ì¬ëŠ” ìºë¦­í„° ì‚­ì œë§Œ êµ¬í˜„ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìˆ˜ë™ìœ¼ë¡œ ì²˜ë¦¬
                const result = await window.onlineDataClient.deleteScenario?.(scenarioId);

                if (result && result.success) {
                    console.log('ğŸ‰ ì‚­ì œ ì„±ê³µ! ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ ìƒˆë¡œê³ ì¹¨...');

                    // ì„±ê³µ ì‹œ ì „ì²´ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  ìƒíƒœ ìœ ì§€
                    await window.loadScenarios();

                    alert('âœ… ì‹œë‚˜ë¦¬ì˜¤ê°€ ì„±ê³µì ìœ¼ë¡œ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ë° ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
                } else {
                    throw new Error('ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ê¸°ëŠ¥ì´ ì•„ì§ êµ¬í˜„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.');
                }

            } catch (error) {
                console.error('âŒ ì˜¨ë¼ì¸ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ì‹¤íŒ¨:', error);
                alert(`âŒ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ì‹¤íŒ¨\n\nì˜¤ë¥˜ ë©”ì‹œì§€: ${error.message}\n\ní˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ ì‚­ì œ ê¸°ëŠ¥ì€ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤.`);
            }
        };

        // ì „ì—­ í•¨ìˆ˜ êµì²´: ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ ì‚¬ìš©
        window.loadCharacters = async function() {
            console.log('ğŸŒ ì˜¨ë¼ì¸ì—ì„œ ìºë¦­í„° ë¡œë“œ...');
            try {
                const charactersData = await window.onlineDataClient.loadCharacters();
                console.log('ğŸ“Š ë¡œë“œëœ ìºë¦­í„° ë°ì´í„°:', charactersData);

                // ì „ì—­ characters ë³€ìˆ˜ì™€ window.characters ëª¨ë‘ ì—…ë°ì´íŠ¸
                characters = charactersData || {};
                window.characters = characters;

                console.log('ğŸ“‹ ì „ì—­ ë³€ìˆ˜ í™•ì¸:', Object.keys(characters).length, 'ê°œ ìºë¦­í„°');

                displayCharacters();
                updateCharacterStats();
                console.log('âœ… ìºë¦­í„° ì˜¨ë¼ì¸ ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ìºë¦­í„° ì˜¨ë¼ì¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ìºë¦­í„° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);

                // ì˜¤ë¥˜ ë°œìƒ ì‹œ ë¹ˆ ë°ì´í„°ë¡œ ì´ˆê¸°í™”
                characters = {};
                window.characters = characters;
                displayCharacters();
                updateCharacterStats();
            }
        };

        // ìºë¦­í„° ì €ì¥ í•¨ìˆ˜ë„ ì˜¨ë¼ì¸ í´ë¼ì´ì–¸íŠ¸ë¡œ êµì²´
        window.saveCharacter = async function() {
            console.log('ğŸ’¾ === ì˜¨ë¼ì¸ ìºë¦­í„° ì €ì¥ ì‹œì‘ ===');

            const name = document.getElementById('charName').value;
            const mbti = document.getElementById('charMbti').value;

            console.log('ğŸ“ ì…ë ¥ê°’ í™•ì¸:');
            console.log('  - ì´ë¦„:', name || '(ë¹„ì–´ìˆìŒ)');
            console.log('  - MBTI:', mbti || '(ë¹„ì–´ìˆìŒ)');

            if (!name || !mbti) {
                console.error('âŒ í•„ìˆ˜ ì…ë ¥ê°’ ëˆ„ë½');
                alert(`ì´ë¦„ê³¼ MBTIëŠ” í•„ìˆ˜ ì…ë ¥ í•­ëª©ì…ë‹ˆë‹¤.\n\ní˜„ì¬ ì…ë ¥ê°’:\nì´ë¦„: ${name || 'ë¯¸ì…ë ¥'}\nMBTI: ${mbti || 'ë¯¸ì…ë ¥'}`);
                return;
            }

            // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ í™•ì¸
            if (!window.onlineDataClient) {
                console.error('âŒ ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤');
                alert('âš ï¸ ì˜¨ë¼ì¸ ì‹œìŠ¤í…œ ë¡œë“œ ì˜¤ë¥˜\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }

            try {
                // ê°„ë‹¨í•œ ìºë¦­í„° ë°ì´í„° ìƒì„± (ë³µì¡í•œ collectCharacterData ëŒ€ì‹ )
                const characterId = `${name.toLowerCase().replace(/\s+/g, '_')}_${mbti.toLowerCase()}_${Date.now()}`;

                const finalCharacterData = {
                    id: characterId,
                    name: name,
                    age: document.getElementById('charAge')?.value || '22',
                    mbti: mbti,
                    gender: 'female',
                    personality_traits: ['ì¹œê·¼í•œ', 'ë§¤ë ¥ì ì¸', 'ìŠ¤ë§ˆíŠ¸í•œ'],
                    major: 'general',
                    family: 'average',
                    hometown: 'seoul',
                    relationship: 'friend',
                    appearance: {
                        hair: 'ê¸´ ìƒë¨¸ë¦¬',
                        eyes: 'ë‘¥ê·¼ ëˆˆ',
                        style: 'ìºì£¼ì–¼'
                    },
                    hobbies: ['ë…ì„œ', 'ìŒì•…ê°ìƒ', 'ì‚°ì±…'],
                    values: 'family_oriented',
                    speech_style: 'ì¹œê·¼í•œ ë§íˆ¬',
                    speech_habit: 'ìì£¼ ë¯¸ì†Œì§“ê¸°',
                    genre: 'school_romance',
                    created_at: new Date().toISOString(),
                    source: 'scenario_admin',
                    active: true
                };

                // ì €ì¥ ë²„íŠ¼ ìƒíƒœ ë³€ê²½
                const saveButton = document.querySelector('#characterModal .btn-primary') ||
                                  document.querySelector('button[onclick*="saveCharacter"]');

                if (saveButton) {
                    saveButton.disabled = true;
                    saveButton.textContent = 'ğŸŒ ì˜¨ë¼ì¸ ì €ì¥ ì¤‘...';
                }

                console.log('ğŸ’¾ ì˜¨ë¼ì¸ì— ì €ì¥í•  ìºë¦­í„° ë°ì´í„°:', finalCharacterData);

                // ì˜¨ë¼ì¸ ë°ì´í„° í´ë¼ì´ì–¸íŠ¸ë¥¼ í†µí•´ ì €ì¥
                const result = await window.onlineDataClient.saveCharacter(finalCharacterData);

                if (result && result.success) {
                    console.log('ğŸ‰ ì €ì¥ ì„±ê³µ! ì „ì²´ ìºë¦­í„° ëª©ë¡ ìƒˆë¡œê³ ì¹¨...');

                    // ì„±ê³µ ì‹œ ì „ì²´ ìºë¦­í„° ëª©ë¡ì„ ë‹¤ì‹œ ë¡œë“œí•˜ì—¬ ìµœì‹  ìƒíƒœ ìœ ì§€
                    await window.loadCharacters();

                    console.log('âœ… ìºë¦­í„° ëª©ë¡ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');

                    const successMessage = `ğŸ’– ìƒˆë¡œìš´ ìºë¦­í„° '${name}'ê°€ GitHubì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nâœ… ì˜¨ë¼ì¸ì—ì„œ ì˜êµ¬ ë³´ê´€ë©ë‹ˆë‹¤!`;

                    alert(successMessage);

                    // ëª¨ë‹¬ ë‹«ê¸° (í•¨ìˆ˜ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš°ë§Œ)
                    if (typeof closeModal === 'function') {
                        closeModal('characterModal');
                    } else {
                        // ì§ì ‘ ëª¨ë‹¬ ë‹«ê¸°
                        const modal = document.getElementById('characterModal');
                        if (modal) modal.style.display = 'none';
                    }

                    console.log('âœ… ì˜¨ë¼ì¸ ìºë¦­í„° ì €ì¥ ì™„ë£Œ!');
                } else {
                    throw new Error(result?.error || 'ì˜¨ë¼ì¸ ì €ì¥ ì‹¤íŒ¨ - ê²°ê³¼ ì—†ìŒ');
                }

            } catch (error) {
                console.error('âŒ ì˜¨ë¼ì¸ ìºë¦­í„° ì €ì¥ ì‹¤íŒ¨:', error);

                let errorMessage = 'ì˜¨ë¼ì¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message;

                if (error.message.includes('GitHub Token')) {
                    errorMessage += '\n\nğŸ” í•´ê²°ì±…: GitHub Tokenì„ ì„¤ì •í•´ì£¼ì„¸ìš”';
                    errorMessage += '\n1. í…ŒìŠ¤íŠ¸ í˜ì´ì§€ì—ì„œ í† í° ì„¤ì •';
                    errorMessage += '\n2. ë˜ëŠ” Vercel í™˜ê²½ë³€ìˆ˜ í™•ì¸';
                }

                alert(errorMessage);
            } finally {
                // ë²„íŠ¼ ìƒíƒœ ë³µì›
                const saveButton = document.querySelector('#characterModal .btn-primary') ||
                                  document.querySelector('button[onclick*="saveCharacter"]');

                if (saveButton) {
                    saveButton.disabled = false;
                    saveButton.textContent = 'ğŸ’– ìºë¦­í„° ì €ì¥';
                }
            }
        };

        window.loadScenarios = async function() {
            console.log('ğŸŒ ì˜¨ë¼ì¸ì—ì„œ ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ...');
            try {
                const scenariosData = await window.onlineDataClient.loadScenarios();
                window.scenarios = scenariosData;
                displayScenarios();
                updateScenarioStats();
                console.log('âœ… ì‹œë‚˜ë¦¬ì˜¤ ì˜¨ë¼ì¸ ë¡œë“œ ì™„ë£Œ');
            } catch (error) {
                console.error('âŒ ì‹œë‚˜ë¦¬ì˜¤ ì˜¨ë¼ì¸ ë¡œë“œ ì‹¤íŒ¨:', error);
                alert('ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n' + error.message);
            }
        };

        // ì˜¨ë¼ì¸ ë™ê¸°í™” ìƒíƒœ ëª¨ë‹ˆí„°ë§
        setInterval(async () => {
            const isOnline = await window.onlineDataClient.checkOnlineStatus();
            const statusIndicator = document.getElementById('onlineStatus') || createStatusIndicator();

            statusIndicator.textContent = isOnline ? 'ğŸŒ ì˜¨ë¼ì¸' : 'ğŸ“´ ì˜¤í”„ë¼ì¸';
            statusIndicator.style.color = isOnline ? '#28a745' : '#dc3545';

            // ì˜¤í”„ë¼ì¸ì—ì„œ ì˜¨ë¼ì¸ìœ¼ë¡œ ë³µêµ¬ ì‹œ í ì¬ì‹œë„
            if (isOnline && window.onlineDataClient.requestQueue.length > 0) {
                await window.onlineDataClient.retryQueuedRequests();
            }
        }, 30000); // 30ì´ˆë§ˆë‹¤ ì²´í¬

        // ì˜¨ë¼ì¸ ìƒíƒœ í‘œì‹œê¸° ìƒì„±
        function createStatusIndicator() {
            const indicator = document.createElement('div');
            indicator.id = 'onlineStatus';
            indicator.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: white;
                padding: 8px 12px;
                border-radius: 20px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
                font-size: 14px;
                font-weight: bold;
                z-index: 1000;
            `;
            document.body.appendChild(indicator);
            return indicator;
        }

        console.log('âœ… ì˜¨ë¼ì¸ ì „ìš© ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ');
    </script>
</body>
</html>