<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬ - Admin Panel</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #121212;
            color: #ffffff;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border-radius: 15px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .admin-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .panel-section {
            background: #1a1a1a;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #333;
        }

        .section-title {
            color: #ff69b4;
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .metadata-form, .message-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            color: #ccc;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea, .form-group select {
            background: #222;
            border: 2px solid #444;
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: #ff69b4;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #ff69b4, #ff1493);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 105, 180, 0.3);
        }

        .btn-secondary {
            background: #666;
        }

        .btn-danger {
            background: #dc3545;
        }

        .messages-list {
            max-height: 400px;
            overflow-y: auto;
            background: #222;
            border-radius: 8px;
            padding: 15px;
        }

        .message-item {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid #ff69b4;
        }

        .message-item:last-child {
            margin-bottom: 0;
        }

        .message-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .message-id {
            color: #ff69b4;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .message-type {
            background: #444;
            color: #ccc;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .message-text {
            color: #fff;
            margin: 10px 0;
        }

        .message-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .status-bar {
            background: #1a1a1a;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .status-text {
            color: #ff69b4;
            font-weight: 600;
        }

        .choices-preview {
            background: #333;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .choice-item {
            background: #444;
            padding: 8px 12px;
            border-radius: 6px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .choice-text {
            color: #fff;
        }

        .choice-delta {
            color: #ff69b4;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .admin-panel {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬</h1>
            <p>ì±„íŒ… ê²Œì„ì˜ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ìƒì„±, í¸ì§‘, ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>

        <div class="status-bar">
            <span class="status-text" id="statusText">ì‹œë‚˜ë¦¬ì˜¤ ë¡œë“œ ì¤‘...</span>
        </div>

        <div class="admin-panel">
            <!-- AI ì„¤ì • ì„¹ì…˜ -->
            <div class="panel-section">
                <h2 class="section-title">
                    ğŸ¤– AI ì„œë²„ ê´€ë¦¬
                </h2>
                <div class="form-group">
                    <label for="adminPassword">ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="adminPassword" placeholder="ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                </div>
                <button type="button" class="btn" onclick="connectToServer()">ì„œë²„ ì—°ê²°</button>
                
                <div id="serverStatus" style="margin: 15px 0; padding: 10px; background: #333; border-radius: 8px; display: none;">
                    <div class="status-text" id="serverStatusText">ì—°ê²° ìƒíƒœ í™•ì¸ ì¤‘...</div>
                </div>
                
                <div id="aiSettings" style="display: none;">
                    <h3 style="color: #ff69b4; margin: 20px 0 10px 0;">AI ëª¨ë¸ ì„¤ì •</h3>
                    <div class="form-group">
                        <label for="aiModel">AI ëª¨ë¸</label>
                        <select id="aiModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                            <option value="gpt-4">GPT-4</option>
                            <option value="gpt-4-turbo-preview">GPT-4 Turbo Preview</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="aiTemperature">Temperature (0.0-2.0)</label>
                        <input type="number" id="aiTemperature" min="0" max="2" step="0.1" value="0.8">
                    </div>
                    <div class="form-group">
                        <label for="aiMaxTokens">ìµœëŒ€ í† í° ìˆ˜</label>
                        <input type="number" id="aiMaxTokens" min="10" max="1000" value="150">
                    </div>
                    <div class="form-group">
                        <label for="aiSystemPrompt">ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸</label>
                        <textarea id="aiSystemPrompt" rows="8" placeholder="AI ìºë¦­í„° ì„¤ì • í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea>
                    </div>
                    <button type="button" class="btn" onclick="updateAISettings()">AI ì„¤ì • ì €ì¥</button>
                    
                    <h3 style="color: #ff69b4; margin: 20px 0 10px 0;">ì„œë²„ í†µê³„</h3>
                    <div id="serverStats" style="background: #333; padding: 15px; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; color: #ccc;">
                            <div>ì´ ìš”ì²­ ìˆ˜: <span id="totalRequests">-</span></div>
                            <div>ì‚¬ìš©ëœ í† í°: <span id="totalTokens">-</span></div>
                            <div>ê³ ìœ  ì‚¬ìš©ì: <span id="uniqueUsers">-</span></div>
                            <div>ê°€ë™ ì‹œê°„: <span id="uptime">-</span></div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="refreshStats()" style="margin-top: 10px;">í†µê³„ ìƒˆë¡œê³ ì¹¨</button>
                    </div>
                </div>
            </div>
            
            <!-- ë©”íƒ€ë°ì´í„° ì„¹ì…˜ -->
            <div class="panel-section">
                <h2 class="section-title">
                    âš™ï¸ ê²Œì„ ë©”íƒ€ë°ì´í„°
                </h2>
                <form class="metadata-form" id="metadataForm">
                    <div class="form-group">
                        <label for="gameTitle">ê²Œì„ ì œëª©</label>
                        <input type="text" id="gameTitle" placeholder="ê²Œì„ì˜ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterName">ìºë¦­í„° ì´ë¦„</label>
                        <input type="text" id="characterName" placeholder="ì£¼ì¸ê³µ ì´ë¦„">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterAge">ìºë¦­í„° ë‚˜ì´</label>
                        <input type="number" id="characterAge" placeholder="ë‚˜ì´">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterRelation">ê´€ê³„</label>
                        <input type="text" id="characterRelation" placeholder="ì£¼ì¸ê³µê³¼ì˜ ê´€ê³„">
                    </div>
                    
                    <div class="form-group">
                        <label for="characterPersonality">ì„±ê²©</label>
                        <textarea id="characterPersonality" placeholder="ìºë¦­í„°ì˜ ì„±ê²©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="initialAffection">ì´ˆê¸° í˜¸ê°ë„</label>
                        <input type="number" id="initialAffection" min="0" max="100" placeholder="0-100">
                    </div>
                    
                    <div class="form-group">
                        <label for="gameSetting">ê²Œì„ ì„¤ì •</label>
                        <textarea id="gameSetting" placeholder="ê²Œì„ì˜ ë°°ê²½ê³¼ ìƒí™©ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”"></textarea>
                    </div>
                    
                    <button type="button" class="btn" onclick="updateMetadata()">ë©”íƒ€ë°ì´í„° ì €ì¥</button>
                </form>
            </div>

            <!-- ë©”ì‹œì§€ ê´€ë¦¬ ì„¹ì…˜ -->
            <div class="panel-section">
                <h2 class="section-title">
                    ğŸ’¬ ë©”ì‹œì§€ ê´€ë¦¬
                </h2>
                <form class="message-form" id="messageForm">
                    <div class="form-group">
                        <label for="messageType">ë©”ì‹œì§€ íƒ€ì…</label>
                        <select id="messageType" onchange="toggleFormFields()">
                            <option value="received">ë°›ì€ ë©”ì‹œì§€</option>
                            <option value="stage_direction">ìƒí™© ì„¤ëª…</option>
                            <option value="choice">ì„ íƒì§€</option>
                            <option value="input">ì…ë ¥ ìš”ì²­</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="textGroup">
                        <label for="messageText">ë©”ì‹œì§€ ë‚´ìš©</label>
                        <textarea id="messageText" placeholder="ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    
                    <div class="form-group" id="emotionGroup">
                        <label for="messageEmotion">ê°ì • ìƒíƒœ</label>
                        <select id="messageEmotion">
                            <option value="neutral">ì¤‘ë¦½</option>
                            <option value="excited">í¥ë¶„</option>
                            <option value="happy">ê¸°ì¨</option>
                            <option value="shy">ë¶€ë„ëŸ¬ì›€</option>
                            <option value="sad">ìŠ¬í””</option>
                            <option value="angry">í™”ë‚¨</option>
                            <option value="nervous">ê¸´ì¥</option>
                            <option value="romantic">ë¡œë§¨í‹±</option>
                            <option value="playful">ì¥ë‚œìŠ¤ëŸ¬ì›€</option>
                        </select>
                    </div>
                    
                    <!-- ì„ íƒì§€ìš© í¼ -->
                    <div id="choiceFields" style="display: none;">
                        <div class="form-group">
                            <label for="choicePrompt">ì„ íƒì§€ í”„ë¡¬í”„íŠ¸</label>
                            <input type="text" id="choicePrompt" placeholder="ì˜ˆ: ì°½ìš©ì´ ë­ë¼ê³  ë‹µí• ê¹Œìš”?">
                        </div>
                        <div id="choiceOptions">
                            <h4 style="color: #ff69b4; margin-bottom: 10px;">ì„ íƒì§€ ì˜µì…˜ë“¤</h4>
                            <div class="choice-option">
                                <input type="text" placeholder="ì„ íƒì§€ 1 í…ìŠ¤íŠ¸" class="choice-text">
                                <input type="number" placeholder="í˜¸ê°ë„ ë³€í™”" class="choice-delta" min="-10" max="10">
                            </div>
                            <div class="choice-option">
                                <input type="text" placeholder="ì„ íƒì§€ 2 í…ìŠ¤íŠ¸" class="choice-text">
                                <input type="number" placeholder="í˜¸ê°ë„ ë³€í™”" class="choice-delta" min="-10" max="10">
                            </div>
                            <div class="choice-option">
                                <input type="text" placeholder="ì„ íƒì§€ 3 í…ìŠ¤íŠ¸" class="choice-text">
                                <input type="number" placeholder="í˜¸ê°ë„ ë³€í™”" class="choice-delta" min="-10" max="10">
                            </div>
                        </div>
                    </div>
                    
                    <!-- ì…ë ¥ ìš”ì²­ìš© í¼ -->
                    <div id="inputFields" style="display: none;">
                        <div class="form-group">
                            <label for="inputPrompt">ì…ë ¥ í”„ë¡¬í”„íŠ¸</label>
                            <input type="text" id="inputPrompt" placeholder="ì˜ˆ: ì°½ìš©ì´ ìœ¤ì•„ì—ê²Œ í•˜ê³  ì‹¶ì€ ë§ì´ ìˆë‚˜ìš”?">
                        </div>
                        <div class="form-group">
                            <label for="inputPlaceholder">ì…ë ¥ì°½ íŒíŠ¸</label>
                            <input type="text" id="inputPlaceholder" placeholder="ì˜ˆ: ìœ¤ì•„ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë§...">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <button type="button" class="btn" onclick="addMessage()">ë©”ì‹œì§€ ì¶”ê°€</button>
                        <button type="button" class="btn btn-secondary" onclick="clearForm()">í¼ ì´ˆê¸°í™”</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- ë©”ì‹œì§€ ëª©ë¡ -->
        <div class="panel-section" style="margin-top: 30px;">
            <h2 class="section-title">
                ğŸ“‹ í˜„ì¬ ì‹œë‚˜ë¦¬ì˜¤ ë©”ì‹œì§€ ëª©ë¡
            </h2>
            <div class="messages-list" id="messagesList">
                <!-- ë©”ì‹œì§€ë“¤ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
            </div>
            <div style="margin-top: 20px; text-align: center;">
                <button type="button" class="btn" onclick="saveScenario()">ğŸ’¾ ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥</button>
                <button type="button" class="btn btn-secondary" onclick="loadScenario()">ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸°</button>
                <button type="button" class="btn btn-secondary" onclick="exportScenario()">ğŸ“¤ JSON ë‚´ë³´ë‚´ê¸°</button>
                <button type="button" class="btn btn-danger" onclick="clearAllMessages()">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <script>
        let scenarioData = {
            metadata: {
                title: "",
                character: {
                    name: "",
                    age: 0,
                    relationship: "",
                    personality: "",
                    initialAffection: 75
                },
                setting: ""
            },
            messages: []
        };

        let currentMessageId = 1;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            loadScenario();
            updateStatus('ì‹œë‚˜ë¦¬ì˜¤ ê´€ë¦¬ìê°€ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.');
        });

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(message) {
            document.getElementById('statusText').textContent = message;
        }

        // ë©”ì‹œì§€ íƒ€ì…ì— ë”°ë¥¸ í¼ í•„ë“œ í† ê¸€
        function toggleFormFields() {
            const messageType = document.getElementById('messageType').value;
            const choiceFields = document.getElementById('choiceFields');
            const inputFields = document.getElementById('inputFields');
            const emotionGroup = document.getElementById('emotionGroup');
            
            choiceFields.style.display = messageType === 'choice' ? 'block' : 'none';
            inputFields.style.display = messageType === 'input' ? 'block' : 'none';
            emotionGroup.style.display = messageType === 'received' ? 'block' : 'none';
        }

        // ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
        function updateMetadata() {
            scenarioData.metadata = {
                title: document.getElementById('gameTitle').value,
                character: {
                    name: document.getElementById('characterName').value,
                    age: parseInt(document.getElementById('characterAge').value) || 0,
                    relationship: document.getElementById('characterRelation').value,
                    personality: document.getElementById('characterPersonality').value,
                    initialAffection: parseInt(document.getElementById('initialAffection').value) || 75
                },
                setting: document.getElementById('gameSetting').value
            };
            
            updateStatus('ë©”íƒ€ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
            updateMessagesList();
        }

        // ë©”ì‹œì§€ ì¶”ê°€
        function addMessage() {
            const messageType = document.getElementById('messageType').value;
            const messageText = document.getElementById('messageText').value;
            
            if (!messageText.trim() && messageType !== 'choice' && messageType !== 'input') {
                alert('ë©”ì‹œì§€ ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const newMessage = {
                id: currentMessageId++,
                type: messageType,
                text: messageText
            };

            // íƒ€ì…ë³„ ì¶”ê°€ í•„ë“œ
            if (messageType === 'received') {
                newMessage.timestamp = new Date().toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'});
                newMessage.emotion = document.getElementById('messageEmotion').value;
            } else if (messageType === 'choice') {
                newMessage.prompt = document.getElementById('choicePrompt').value;
                newMessage.options = [];
                
                const choiceTexts = document.querySelectorAll('.choice-text');
                const choiceDeltas = document.querySelectorAll('.choice-delta');
                
                for (let i = 0; i < choiceTexts.length; i++) {
                    if (choiceTexts[i].value.trim()) {
                        newMessage.options.push({
                            text: choiceTexts[i].value,
                            affection_delta: parseInt(choiceDeltas[i].value) || 0,
                            next: currentMessageId
                        });
                    }
                }
            } else if (messageType === 'input') {
                newMessage.prompt = document.getElementById('inputPrompt').value;
                newMessage.placeholder = document.getElementById('inputPlaceholder').value;
                newMessage.next = currentMessageId;
            }

            scenarioData.messages.push(newMessage);
            updateMessagesList();
            clearForm();
            updateStatus(`ë©”ì‹œì§€ ID ${newMessage.id}ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ë©”ì‹œì§€ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateMessagesList() {
            const messagesList = document.getElementById('messagesList');
            messagesList.innerHTML = '';

            scenarioData.messages.forEach(message => {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message-item';
                
                let messageContent = `
                    <div class="message-header">
                        <span class="message-id">ID: ${message.id}</span>
                        <span class="message-type">${message.type}</span>
                    </div>
                    <div class="message-text">${message.text || message.prompt || '(ì‹œìŠ¤í…œ ë©”ì‹œì§€)'}</div>
                `;

                // ì„ íƒì§€ ë¯¸ë¦¬ë³´ê¸°
                if (message.type === 'choice' && message.options) {
                    messageContent += '<div class="choices-preview">';
                    message.options.forEach(option => {
                        messageContent += `
                            <div class="choice-item">
                                <span class="choice-text">${option.text}</span>
                                <span class="choice-delta">${option.affection_delta > 0 ? '+' : ''}${option.affection_delta}</span>
                            </div>
                        `;
                    });
                    messageContent += '</div>';
                }

                messageContent += `
                    <div class="message-actions">
                        <button class="btn btn-small" onclick="editMessage(${message.id})">âœï¸ í¸ì§‘</button>
                        <button class="btn btn-danger btn-small" onclick="deleteMessage(${message.id})">ğŸ—‘ï¸ ì‚­ì œ</button>
                    </div>
                `;

                messageDiv.innerHTML = messageContent;
                messagesList.appendChild(messageDiv);
            });
        }

        // ë©”ì‹œì§€ ì‚­ì œ
        function deleteMessage(messageId) {
            if (confirm('ì´ ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                scenarioData.messages = scenarioData.messages.filter(msg => msg.id !== messageId);
                updateMessagesList();
                updateStatus(`ë©”ì‹œì§€ ID ${messageId}ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`);
            }
        }

        // í¼ ì´ˆê¸°í™”
        function clearForm() {
            document.getElementById('messageText').value = '';
            document.getElementById('choicePrompt').value = '';
            document.getElementById('inputPrompt').value = '';
            document.getElementById('inputPlaceholder').value = '';
            
            // ì„ íƒì§€ ì´ˆê¸°í™”
            document.querySelectorAll('.choice-text').forEach(input => input.value = '');
            document.querySelectorAll('.choice-delta').forEach(input => input.value = '');
        }

        // ëª¨ë“  ë©”ì‹œì§€ ì‚­ì œ
        function clearAllMessages() {
            if (confirm('ëª¨ë“  ë©”ì‹œì§€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                scenarioData.messages = [];
                currentMessageId = 1;
                updateMessagesList();
                updateStatus('ëª¨ë“  ë©”ì‹œì§€ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ì‹œë‚˜ë¦¬ì˜¤ ì €ì¥ (ë¡œì»¬ ìŠ¤í† ë¦¬ì§€)
        function saveScenario() {
            try {
                localStorage.setItem('chat_scenario_data', JSON.stringify(scenarioData));
                updateStatus('ì‹œë‚˜ë¦¬ì˜¤ê°€ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            } catch (error) {
                alert('ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ì‹œë‚˜ë¦¬ì˜¤ ë¶ˆëŸ¬ì˜¤ê¸°
        function loadScenario() {
            try {
                // ë¨¼ì € ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì‹œë„
                const localData = localStorage.getItem('chat_scenario_data');
                if (localData) {
                    scenarioData = JSON.parse(localData);
                    loadDataToForm();
                    updateStatus('ë¡œì»¬ ì €ì¥ëœ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                } else {
                    // ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼ì—ì„œ ë¡œë“œ
                    fetch('assets/scenarios/chat_story.json')
                        .then(response => response.json())
                        .then(data => {
                            scenarioData = data;
                            loadDataToForm();
                            updateStatus('ê¸°ë³¸ ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼ì„ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤.');
                        })
                        .catch(error => {
                            updateStatus('ì‹œë‚˜ë¦¬ì˜¤ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                            console.error('Error loading scenario:', error);
                        });
                }
            } catch (error) {
                updateStatus('ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error('Error:', error);
            }
        }

        // ë°ì´í„°ë¥¼ í¼ì— ë¡œë“œ
        function loadDataToForm() {
            if (scenarioData.metadata) {
                document.getElementById('gameTitle').value = scenarioData.metadata.title || '';
                if (scenarioData.metadata.character) {
                    document.getElementById('characterName').value = scenarioData.metadata.character.name || '';
                    document.getElementById('characterAge').value = scenarioData.metadata.character.age || '';
                    document.getElementById('characterRelation').value = scenarioData.metadata.character.relationship || '';
                    document.getElementById('characterPersonality').value = scenarioData.metadata.character.personality || '';
                    document.getElementById('initialAffection').value = scenarioData.metadata.character.initialAffection || 75;
                }
                document.getElementById('gameSetting').value = scenarioData.metadata.setting || '';
            }
            
            if (scenarioData.messages && scenarioData.messages.length > 0) {
                currentMessageId = Math.max(...scenarioData.messages.map(msg => msg.id)) + 1;
            }
            
            updateMessagesList();
        }

        // JSON ë‚´ë³´ë‚´ê¸°
        function exportScenario() {
            const jsonData = JSON.stringify(scenarioData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'chat_story.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            updateStatus('ì‹œë‚˜ë¦¬ì˜¤ JSON íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí–ˆìŠµë‹ˆë‹¤.');
        }

        // AI ì„œë²„ ê´€ë¦¬ ê¸°ëŠ¥
        let serverUrl = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000' 
            : 'https://your-server-domain.com';
        
        let adminPassword = '';
        let serverConnected = false;
        
        // ì„œë²„ ì—°ê²°
        async function connectToServer() {
            const password = document.getElementById('adminPassword').value;
            if (!password) {
                alert('ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            adminPassword = password;
            document.getElementById('serverStatus').style.display = 'block';
            document.getElementById('serverStatusText').textContent = 'ì„œë²„ ì—°ê²° ì¤‘...';
            
            try {
                // ì„œë²„ ìƒíƒœ í™•ì¸
                const healthResponse = await fetch(`${serverUrl}/health`);
                if (!healthResponse.ok) {
                    throw new Error('Server not responding');
                }
                
                // ê´€ë¦¬ì ì¸ì¦ í™•ì¸
                const settingsResponse = await fetch(`${serverUrl}/api/admin/settings`, {
                    headers: {
                        'admin-password': adminPassword
                    }
                });
                
                if (!settingsResponse.ok) {
                    throw new Error('Authentication failed');
                }
                
                const data = await settingsResponse.json();
                serverConnected = true;
                
                document.getElementById('serverStatusText').textContent = 'âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!';
                document.getElementById('aiSettings').style.display = 'block';
                
                // í˜„ì¬ ì„¤ì • ë¡œë“œ
                loadAISettings(data.settings);
                loadServerStats(data.stats);
                
                updateStatus('AI ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                document.getElementById('serverStatusText').textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨: ' + error.message;
                serverConnected = false;
            }
        }
        
        // AI ì„¤ì • ë¡œë“œ
        function loadAISettings(settings) {
            document.getElementById('aiModel').value = settings.model || 'gpt-3.5-turbo';
            document.getElementById('aiTemperature').value = settings.temperature || 0.8;
            document.getElementById('aiMaxTokens').value = settings.max_tokens || 150;
            document.getElementById('aiSystemPrompt').value = settings.system_prompt || '';
        }
        
        // ì„œë²„ í†µê³„ ë¡œë“œ
        function loadServerStats(stats) {
            document.getElementById('totalRequests').textContent = stats.totalRequests || 0;
            document.getElementById('totalTokens').textContent = stats.totalTokensUsed || 0;
            document.getElementById('uniqueUsers').textContent = stats.uniqueUsers || 0;
            document.getElementById('uptime').textContent = stats.uptimeFormatted || '-';
        }
        
        // AI ì„¤ì • ì—…ë°ì´íŠ¸
        async function updateAISettings() {
            if (!serverConnected) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            const settings = {
                model: document.getElementById('aiModel').value,
                temperature: parseFloat(document.getElementById('aiTemperature').value),
                max_tokens: parseInt(document.getElementById('aiMaxTokens').value),
                system_prompt: document.getElementById('aiSystemPrompt').value
            };
            
            try {
                const response = await fetch(`${serverUrl}/api/admin/settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'admin-password': adminPassword
                    },
                    body: JSON.stringify(settings)
                });
                
                if (!response.ok) {
                    throw new Error('Failed to update settings');
                }
                
                const data = await response.json();
                updateStatus('AI ì„¤ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                // ì•Œë¦¼ í‘œì‹œ
                alert('AI ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
                
            } catch (error) {
                alert('ì„¤ì • ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // í†µê³„ ìƒˆë¡œê³ ì¹¨
        async function refreshStats() {
            if (!serverConnected) {
                alert('ë¨¼ì € ì„œë²„ì— ì—°ê²°í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            try {
                const response = await fetch(`${serverUrl}/api/admin/stats`, {
                    headers: {
                        'admin-password': adminPassword
                    }
                });
                
                if (!response.ok) {
                    throw new Error('Failed to fetch stats');
                }
                
                const data = await response.json();
                loadServerStats(data.stats);
                updateStatus('ì„œë²„ í†µê³„ë¥¼ ìƒˆë¡œê³ ì¹¨í–ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                alert('í†µê³„ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë©”ì‹œì§€ í¸ì§‘ (ê°„ë‹¨í•œ êµ¬í˜„)
        function editMessage(messageId) {
            const message = scenarioData.messages.find(msg => msg.id === messageId);
            if (message) {
                const newText = prompt('ë©”ì‹œì§€ ë‚´ìš©ì„ ìˆ˜ì •í•˜ì„¸ìš”:', message.text || message.prompt);
                if (newText !== null) {
                    if (message.text !== undefined) {
                        message.text = newText;
                    } else if (message.prompt !== undefined) {
                        message.prompt = newText;
                    }
                    updateMessagesList();
                    updateStatus(`ë©”ì‹œì§€ ID ${messageId}ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }
            }
        }
    </script>
</body>
</html>