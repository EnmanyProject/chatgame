<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ğŸ§ª ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ v2.2.0 - ê°„ì†Œí™” ë²„ì „</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #2d2d2d;
        }
        
        .test-section h3 {
            color: #569cd6;
            margin: 0 0 15px 0;
        }
        
        .success {
            color: #4ec9b0;
            background: rgba(78, 201, 176, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #4ec9b0;
        }
        
        .error {
            color: #f44747;
            background: rgba(244, 71, 71, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #f44747;
        }
        
        .warning {
            color: #ffcc02;
            background: rgba(255, 204, 2, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ffcc02;
        }
        
        .info {
            color: #9cdcfe;
            background: rgba(156, 220, 254, 0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #9cdcfe;
        }
        
        .test-result {
            margin: 10px 0;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #4ec9b0;
        }
        
        .stat-label {
            color: #cccccc;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ğŸ§ª ìµœì¢… í†µí•© í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ (ê°„ì†Œí™”)</h1>
        <p>MBTI ë¡œë§¨ìŠ¤ ì±„íŒ… ê²Œì„ v2.2.0 - ëª¨ë“ˆ ì—†ëŠ” ë…ë¦½ í…ŒìŠ¤íŠ¸</p>
    </div>
    
    <div class="test-section">
        <h3>ğŸ® í…ŒìŠ¤íŠ¸ ì œì–´íŒ</h3>
        <button class="btn" onclick="runAllTests()">ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰</button>
        <button class="btn" onclick="runAPITests()">API í…ŒìŠ¤íŠ¸</button>
        <button class="btn" onclick="runGameTests()">ê²Œì„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸</button>
        <button class="btn" onclick="runPerformanceTests()">ì„±ëŠ¥ í…ŒìŠ¤íŠ¸</button>
        <button class="btn" onclick="clearResults()">ê²°ê³¼ ì´ˆê¸°í™”</button>
    </div>

    <div id="results-container">
        <!-- í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
    </div>

    <script>
        // í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œ - ëª¨ë“ˆ ì˜ì¡´ì„± ì—†ëŠ” ë…ë¦½ ë²„ì „
        const resultsContainer = document.getElementById('results-container');
        
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0,
            startTime: null,
            endTime: null
        };

        function clearResults() {
            resultsContainer.innerHTML = '';
            testStats = { total: 0, passed: 0, failed: 0, warnings: 0, startTime: null, endTime: null };
        }

        function addTestSection(title, icon = 'ğŸ§ª') {
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `<h3>${icon} ${title}</h3><div class="test-content"></div>`;
            resultsContainer.appendChild(section);
            return section.querySelector('.test-content');
        }

        function addTestResult(container, message, type = 'info') {
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = message;
            container.appendChild(result);
            
            testStats.total++;
            if (type === 'success') testStats.passed++;
            else if (type === 'error') testStats.failed++;
            else if (type === 'warning') testStats.warnings++;
        }

        function displayStats() {
            const duration = testStats.endTime - testStats.startTime;
            const statsSection = addTestSection('ğŸ“Š í…ŒìŠ¤íŠ¸ í†µê³„', 'ğŸ“Š');
            statsSection.innerHTML = `
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${testStats.total}</div>
                        <div class="stat-label">ì´ í…ŒìŠ¤íŠ¸</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: #4ec9b0;">${testStats.passed}</div>
                        <div class="stat-label">ì„±ê³µ</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: #f44747;">${testStats.failed}</div>
                        <div class="stat-label">ì‹¤íŒ¨</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" style="color: #ffcc02;">${testStats.warnings}</div>
                        <div class="stat-label">ê²½ê³ </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${duration}ms</div>
                        <div class="stat-label">ì‹¤í–‰ ì‹œê°„</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${Math.round((testStats.passed / testStats.total) * 100)}%</div>
                        <div class="stat-label">ì„±ê³µë¥ </div>
                    </div>
                </div>
            `;
        }

        async function runAllTests() {
            clearResults();
            testStats.startTime = Date.now();
            
            addTestResult(addTestSection('ğŸ¯ í…ŒìŠ¤íŠ¸ ì‹œì‘'), 'ëª¨ë“ˆ ì˜ì¡´ì„± ì—†ëŠ” ë…ë¦½ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...', 'info');
            
            await runAPITests();
            await runGameTests();  
            await runPerformanceTests();
            await runCompatibilityTests();
            
            testStats.endTime = Date.now();
            displayStats();
            
            addTestResult(addTestSection('âœ… í…ŒìŠ¤íŠ¸ ì™„ë£Œ'), 'ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        async function runAPITests() {
            const container = addTestSection('ğŸŒ API í…ŒìŠ¤íŠ¸');
            
            // 1. ê¸°ë³¸ API ìƒíƒœ í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('/api/scenario?action=test');
                if (response.ok) {
                    const data = await response.json();
                    if (data.success) {
                        addTestResult(container, 'âœ… API ì„œë²„ ê¸°ë³¸ ì—°ê²° í…ŒìŠ¤íŠ¸ ì„±ê³µ', 'success');
                    } else {
                        addTestResult(container, `âš ï¸ API ì‘ë‹µ í™•ì¸ í•„ìš”: ${data.message}`, 'warning');
                    }
                } else {
                    addTestResult(container, `âš ï¸ API ì‘ë‹µ ìƒíƒœ: ${response.status}`, 'warning');
                }
            } catch (error) {
                addTestResult(container, `âŒ API ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 2. ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ API í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('/api/scenario?action=list&type=scenarios');
                if (response.ok) {
                    const scenarios = await response.json();
                    if (Array.isArray(scenarios) && scenarios.length > 0) {
                        addTestResult(container, `âœ… ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ API ì„±ê³µ (${scenarios.length}ê°œ)`, 'success');
                    } else {
                        addTestResult(container, 'âš ï¸ ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
                    }
                } else {
                    addTestResult(container, 'âŒ ì‹œë‚˜ë¦¬ì˜¤ ëª©ë¡ API ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                addTestResult(container, `âŒ ì‹œë‚˜ë¦¬ì˜¤ API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 3. ìºë¦­í„° ëª©ë¡ API í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('/api/scenario?action=list&type=characters');
                if (response.ok) {
                    const characters = await response.json();
                    if (Array.isArray(characters) && characters.length > 0) {
                        addTestResult(container, `âœ… ìºë¦­í„° ëª©ë¡ API ì„±ê³µ (${characters.length}ê°œ)`, 'success');
                    } else {
                        addTestResult(container, 'âš ï¸ ìºë¦­í„° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤', 'warning');
                    }
                } else {
                    addTestResult(container, 'âŒ ìºë¦­í„° ëª©ë¡ API ì‹¤íŒ¨', 'error');
                }
            } catch (error) {
                addTestResult(container, `âŒ ìºë¦­í„° API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 4. ëŒ€í™” ìƒì„± API í…ŒìŠ¤íŠ¸
            try {
                const response = await fetch('/api/scenario', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        action: 'generate_character_dialogue',
                        scenario_id: 'hangover_confession',
                        character_id: 'yuna_infp',
                        game_state: { affection: 50, choiceNumber: 0 }
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.success && data.generated) {
                        addTestResult(container, 'âœ… ëŒ€í™” ìƒì„± API ì„±ê³µ', 'success');
                    } else {
                        addTestResult(container, `âš ï¸ ëŒ€í™” ìƒì„± ê²°ê³¼ í™•ì¸ í•„ìš”: ${data.error || 'Unknown'}`, 'warning');
                    }
                } else {
                    addTestResult(container, `âŒ ëŒ€í™” ìƒì„± API ì‹¤íŒ¨: ${response.status}`, 'error');
                }
            } catch (error) {
                addTestResult(container, `âŒ ëŒ€í™” ìƒì„± í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 500));
        }

        async function runGameTests() {
            const container = addTestSection('ğŸ® ê²Œì„ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸');
            
            // 1. LocalStorage ì €ì¥ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
            try {
                const testData = { test: true, timestamp: Date.now() };
                localStorage.setItem('test_save', JSON.stringify(testData));
                const loaded = JSON.parse(localStorage.getItem('test_save'));
                
                if (loaded && loaded.test === true) {
                    addTestResult(container, 'âœ… LocalStorage ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸° ì„±ê³µ', 'success');
                    localStorage.removeItem('test_save');
                } else {
                    throw new Error('ë°ì´í„° ë¶ˆì¼ì¹˜');
                }
            } catch (error) {
                addTestResult(container, `âŒ LocalStorage í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 2. ê²Œì„ ìƒíƒœ ê´€ë¦¬ í…ŒìŠ¤íŠ¸
            try {
                const gameState = {
                    affection: 50,
                    choiceNumber: 0,
                    isFreeChatMode: false,
                    canInput: true
                };
                
                // í˜¸ê°ë„ ë³€ê²½ ì‹œë®¬ë ˆì´ì…˜
                gameState.affection = Math.max(0, Math.min(100, gameState.affection + 5));
                gameState.choiceNumber++;
                
                if (gameState.affection === 55 && gameState.choiceNumber === 1) {
                    addTestResult(container, 'âœ… ê²Œì„ ìƒíƒœ ê´€ë¦¬ ë¡œì§ ì„±ê³µ', 'success');
                } else {
                    throw new Error('ìƒíƒœ ë³€ê²½ ë¡œì§ ì˜¤ë¥˜');
                }
            } catch (error) {
                addTestResult(container, `âŒ ê²Œì„ ìƒíƒœ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 3. ëŒ€í™” ì²˜ë¦¬ ë¡œì§ í…ŒìŠ¤íŠ¸
            try {
                const testDialogue = {
                    dialogue: "ì•ˆë…•í•˜ì„¸ìš” ğŸ˜Š",
                    choices: [
                        { text: "ì¸ì‚¬í•œë‹¤", affection_impact: 1 },
                        { text: "ë¬´ì‹œí•œë‹¤", affection_impact: -1 }
                    ]
                };
                
                if (testDialogue.choices && testDialogue.choices.length === 2) {
                    addTestResult(container, 'âœ… ëŒ€í™” ë°ì´í„° êµ¬ì¡° ê²€ì¦ ì„±ê³µ', 'success');
                } else {
                    throw new Error('ëŒ€í™” ë°ì´í„° êµ¬ì¡° ì˜¤ë¥˜');
                }
            } catch (error) {
                addTestResult(container, `âŒ ëŒ€í™” ì²˜ë¦¬ í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            // 4. MBTI ê¸°ë°˜ í˜¸ê°ë„ ê³„ì‚° í…ŒìŠ¤íŠ¸
            try {
                function calculateAffectionChange(mbti, choiceType) {
                    const mbtiWeights = {
                        'INFP': { romantic: 2, friendly: 1, ignore: -2 },
                        'ENFP': { romantic: 1, friendly: 2, ignore: -1 }
                    };
                    return mbtiWeights[mbti] && mbtiWeights[mbti][choiceType] || 0;
                }
                
                const infpRomantic = calculateAffectionChange('INFP', 'romantic');
                const enfpFriendly = calculateAffectionChange('ENFP', 'friendly');
                
                if (infpRomantic === 2 && enfpFriendly === 2) {
                    addTestResult(container, 'âœ… MBTI ê¸°ë°˜ í˜¸ê°ë„ ê³„ì‚° ì„±ê³µ', 'success');
                } else {
                    throw new Error('MBTI ê³„ì‚° ë¡œì§ ì˜¤ë¥˜');
                }
            } catch (error) {
                addTestResult(container, `âŒ MBTI ê³„ì‚° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: ${error.message}`, 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 500));
        }

        async function runPerformanceTests() {
            const container = addTestSection('âš¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸');
            
            // 1. í˜ì´ì§€ ë¡œë”© ì‹œê°„ ì¸¡ì •
            const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
            if (loadTime < 3000) {
                addTestResult(container, `âœ… í˜ì´ì§€ ë¡œë”© ì‹œê°„: ${loadTime}ms (ìš°ìˆ˜)`, 'success');
            } else if (loadTime < 5000) {
                addTestResult(container, `âš ï¸ í˜ì´ì§€ ë¡œë”© ì‹œê°„: ${loadTime}ms (ë³´í†µ)`, 'warning');
            } else {
                addTestResult(container, `âŒ í˜ì´ì§€ ë¡œë”© ì‹œê°„: ${loadTime}ms (ëŠë¦¼)`, 'error');
            }

            // 2. ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì²´í¬
            if (performance.memory) {
                const memoryInfo = performance.memory;
                const usedMB = (memoryInfo.usedJSHeapSize / 1024 / 1024).toFixed(2);
                const limitMB = (memoryInfo.jsHeapSizeLimit / 1024 / 1024).toFixed(2);
                
                addTestResult(container, `ğŸ“Š ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰: ${usedMB}MB / ${limitMB}MB`, 'info');
                
                if (memoryInfo.usedJSHeapSize < memoryInfo.jsHeapSizeLimit * 0.5) {
                    addTestResult(container, 'âœ… ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ : ì–‘í˜¸ (50% ë¯¸ë§Œ)', 'success');
                } else {
                    addTestResult(container, 'âš ï¸ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  ì£¼ì˜', 'warning');
                }
            } else {
                addTestResult(container, 'âš ï¸ ë©”ëª¨ë¦¬ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤', 'warning');
            }

            // 3. DOM ì¡°ì‘ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
            const startTime = performance.now();
            for (let i = 0; i < 100; i++) {
                const element = document.createElement('div');
                element.textContent = `Test ${i}`;
                document.body.appendChild(element);
                document.body.removeChild(element);
            }
            const domTime = performance.now() - startTime;
            
            if (domTime < 10) {
                addTestResult(container, `âœ… DOM ì¡°ì‘ ì„±ëŠ¥: ${domTime.toFixed(2)}ms (ìš°ìˆ˜)`, 'success');
            } else {
                addTestResult(container, `âš ï¸ DOM ì¡°ì‘ ì„±ëŠ¥: ${domTime.toFixed(2)}ms`, 'warning');
            }

            await new Promise(resolve => setTimeout(resolve, 300));
        }

        async function runCompatibilityTests() {
            const container = addTestSection('ğŸ”§ í˜¸í™˜ì„± í…ŒìŠ¤íŠ¸');
            
            // 1. ë¸Œë¼ìš°ì € ê¸°ëŠ¥ ì§€ì› í™•ì¸
            const features = {
                'ES6 ëª¨ë“ˆ': typeof Symbol !== 'undefined',
                'Fetch API': typeof fetch !== 'undefined',
                'LocalStorage': typeof localStorage !== 'undefined',
                'Promise': typeof Promise !== 'undefined',
                'Array.includes': Array.prototype.includes !== undefined
            };
            
            Object.entries(features).forEach(([feature, supported]) => {
                if (supported) {
                    addTestResult(container, `âœ… ${feature} ì§€ì›ë¨`, 'success');
                } else {
                    addTestResult(container, `âŒ ${feature} ì§€ì›ë˜ì§€ ì•ŠìŒ`, 'error');
                }
            });

            // 2. ë°˜ì‘í˜• ë””ìì¸ í…ŒìŠ¤íŠ¸
            const screenWidth = window.innerWidth;
            if (screenWidth >= 800) {
                addTestResult(container, `âœ… ë°ìŠ¤í¬í†± í•´ìƒë„ (${screenWidth}px)`, 'success');
            } else if (screenWidth >= 600) {
                addTestResult(container, `âœ… íƒœë¸”ë¦¿ í•´ìƒë„ (${screenWidth}px)`, 'success');
            } else {
                addTestResult(container, `âœ… ëª¨ë°”ì¼ í•´ìƒë„ (${screenWidth}px)`, 'success');
            }

            // 3. ë„¤íŠ¸ì›Œí¬ ìƒíƒœ í™•ì¸
            if (navigator.onLine) {
                addTestResult(container, 'âœ… ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì •ìƒ', 'success');
            } else {
                addTestResult(container, 'âŒ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì—†ìŒ', 'error');
            }

            await new Promise(resolve => setTimeout(resolve, 300));
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸° ë©”ì‹œì§€ í‘œì‹œ
        document.addEventListener('DOMContentLoaded', () => {
            const container = addTestSection('ğŸš€ ì‹œìŠ¤í…œ ì¤€ë¹„');
            addTestResult(container, 'ê°„ì†Œí™” í†µí•© í…ŒìŠ¤íŠ¸ ì‹œìŠ¤í…œì´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            addTestResult(container, 'ëª¨ë“ˆ ì˜ì¡´ì„±ì´ ì œê±°ë˜ì–´ ì•ˆì •ì ìœ¼ë¡œ ì‹¤í–‰ë©ë‹ˆë‹¤.', 'info');
            addTestResult(container, 'ìœ„ì˜ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.', 'info');
        });
    </script>
</body>
</html>