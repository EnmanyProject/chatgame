# 시나리오 시스템 업그레이드 - 요약 문서

## 📋 한눈에 보는 변경사항

### 현재 시스템 (v1.0)
```
시나리오 = 소설 텍스트 (600-900자)
         ↓
에피소드 생성 시마다 AI 호출 (시간/비용 발생)
         ↓
dialogue_flow 실시간 생성
```

### 새 시스템 (v2.0)
```
시나리오 = 대화 블록 배열 (15-150개)
         ↓
에피소드 생성 시 dialogue_script 재사용
         ↓
캐릭터별 톤만 적용 (AI 호출 불필요)
```

---

## 🎯 핵심 목표

1. **시나리오 = 대화 스크립트**
   - 소설 텍스트 → 메신저 대화 블록 배열
   - 직접 편집 가능한 구조

2. **선택지 개수 기반 길이 관리**
   - 4개 (5-10분) ~ 36개 (45-60분)
   - 명확한 플레이 시간 예측

3. **AI 자동 생성 v2.0**
   - dialogue_script 직접 생성
   - JSON Mode로 안정성 보장

4. **에피소드 생성 효율화**
   - dialogue_script 재사용
   - 매번 AI 호출 불필요 (비용 90% 절감)

---

## 📊 주요 변경사항

### 데이터 구조

**제거:**
- `ai_generated_context` (소설 텍스트)
- `story_structure` (기승전결)

**추가:**
- `dialogue_script` (대화 블록 배열)
- `total_choices` (4~36)
- `estimated_duration` (short/medium/long)

### dialogue_script 구조

```javascript
[
  // 메시지 블록
  {
    "id": 1,
    "type": "message",
    "speaker": "소라",
    "text": "집에 왔는데 갑자기 네 생각나서 톡해.",
    "emotion": "neutral",
    "timestamp": "19:23"
  },

  // 선택지 블록
  {
    "id": 4,
    "type": "choice",
    "question": "솔직히 말해봐. 그날 무슨 생각했어?",
    "options": [
      { "id": "A", "text": "너도 나 생각했어?", "affection_change": 3 },
      { "id": "B", "text": "뭐 먹었어?", "affection_change": 0 },
      { "id": "C", "text": "그냥 좀 피곤했어", "affection_change": 1 }
    ]
  },

  // 주관식 블록
  {
    "id": 8,
    "type": "user_input",
    "placeholder": "답장을 입력하세요...",
    "evaluation_keywords": ["궁금", "걱정", "관심"]
  }
]
```

---

## 🛠️ 구현 계획 (6개 Step, 5시간)

### Step 1: 데이터 스키마 재정의 (30분)
- scenario-database.json 새 구조 적용
- 예시 시나리오 1개 생성

### Step 2: 대화 스크립트 편집기 UI (2시간)
- 탭 추가 ("📋 기본 정보" + "📝 대화 스크립트")
- 블록 추가/삭제 기능
- 메시지/선택지/주관식 컴포넌트

### Step 3: AI 자동 생성 v2 (1시간)
- ai-prompts.json v2.0
- generateDialogueScript() API
- JSON Mode 안정성

### Step 4: 저장/로드 수정 (1시간)
- collectDialogueScript()
- renderDialogueBlocks()
- 시나리오 카드 대화 미리보기

### Step 5: 미리보기 기능 (30분)
- 메신저 스타일 렌더링
- 감정 이모티콘 표시
- 모달 UI

### Step 6: 기존 데이터 제거 (10분)
- clearAllScenarios() 실행
- v2.0.0 시작

---

## 🎨 UI/UX 변경사항

### 시나리오 생성 모달

**기본 정보 탭:**
```
- 제목 (input)
- 설명 (textarea)
- 장르 (15개 감정 장르)
- 섹시 레벨 (1-10)
- 분위기 (light/balanced/serious)
- 선택지 개수 (4~36) ← 신규
```

**대화 스크립트 탭:** ← 신규
```
[💬 대사 추가] [🎯 선택지 추가] [⌨️ 주관식 추가] [👁️ 미리보기]

#1 💬 대사 [🗑️]
화자: 소라
내용: [대사 입력]
감정: [neutral ▼]  시간: [19:23]

#4 🎯 선택지 [🗑️]
질문: [질문 입력]
A) [선택지 1] 호감도: [+3]
B) [선택지 2] 호감도: [0]
C) [선택지 3] 호감도: [+1]
```

### 사용자 워크플로우 (추천)

```
1. 기본 정보 입력
   ↓
2. "🤖 AI 자동 생성" 클릭 (5-10초)
   ↓
3. 대화 스크립트 자동 생성
   ↓
4. (선택) 수정
   ↓
5. "👁️ 미리보기" 확인
   ↓
6. 저장
```

---

## 📈 예상 효과

### 시나리오 생성
- **시간 절감:** 10분 → 5분 (50% 단축)
- **품질 향상:** AI가 일관된 구조 생성
- **관리 편의:** 직접 편집 가능

### 에피소드 생성
- **비용 절감:** 매번 AI 호출 → dialogue_script 재사용 (90% 절감)
- **속도 향상:** 10-15초 → 1-2초 (85% 단축)
- **일관성:** 동일 시나리오에서 동일한 기본 구조

### 사용자 경험
- **플레이 시간 예측:** 선택지 개수로 명확한 시간 안내
- **다양한 길이:** 4개 (5분) ~ 36개 (60분)
- **높은 몰입도:** 대화 블록 구조로 자연스러운 흐름

---

## ⚠️ 주요 리스크 및 완화 전략

### 리스크 1: AI 생성 불안정성
- **문제:** JSON 파싱 실패
- **완화:** JSON Mode, speaker 필드 후처리, Fallback

### 리스크 2: 하위 호환성
- **문제:** 기존 시나리오 dialogue_script 없음
- **완화:** 빈 배열 자동 초기화, 읽기 전용 표시

### 리스크 3: UI 복잡성
- **문제:** 대화 블록 편집기 학습 곡선
- **완화:** AI 자동 생성 강조, 튜토리얼 메시지

---

## 📅 타임라인

```
2025-10-11 (금) - 구현 및 배포
├─ 09:00-11:30: Step 1-2 (스키마 + UI)
├─ 11:30-12:00: 중간 점검
├─ 12:00-14:00: Step 3-4 (AI + 저장)
├─ 14:00-14:30: 통합 테스트
├─ 14:30-15:10: Step 5-6 (미리보기 + 초기화)
├─ 15:10-15:40: 최종 검수
└─ 15:40-16:00: 배포 ✅

2025-10-12 (토) - 모니터링
└─ 사용자 피드백 수집 및 버그 수정
```

---

## 🔗 관련 문서

- **상세 설계:** `docs/SCENARIO_SYSTEM_UPGRADE_DESIGN.md`
- **요구사항:** `upgrade.md`
- **프로젝트 개요:** `.claude-code/PROJECT.md`
- **현재 작업:** `.claude-code/MASTER.md`
- **히스토리:** `CLAUDE.md`

---

## ✅ 체크리스트

**구현 전:**
- [ ] 설계 문서 리뷰 완료
- [ ] scenario-database.json 백업
- [ ] Git 브랜치 생성 (`feature/dialogue-script-system`)

**구현 중:**
- [ ] Step 1-6 각 단계마다 Git 커밋
- [ ] 단위 테스트 작성
- [ ] 통합 테스트 실행

**구현 후:**
- [ ] UAT 체크리스트 통과
- [ ] 에피소드 생성 연동 테스트
- [ ] CLAUDE.md 버전 히스토리 업데이트
- [ ] 배포 및 모니터링

---

**문서 버전:** 1.0.0
**작성일:** 2025-10-11
**작성자:** Claude Code (Sonnet 4.5)
**참조:** SCENARIO_SYSTEM_UPGRADE_DESIGN.md
