{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Romantic Messenger Scenario Schema",
  "description": "로맨틱 메신저 대화 시나리오 템플릿 스키마 - 캐릭터 변수 치환 지원",
  "version": "1.0.0",

  "definitions": {
    "metadata": {
      "type": "object",
      "required": ["title", "genre", "sexy_level", "tags"],
      "properties": {
        "title": {
          "type": "string",
          "description": "시나리오 제목",
          "example": "늦은 밤의 고백"
        },
        "genre": {
          "type": "string",
          "enum": ["sensual_romance", "sweet_romance", "passionate_love", "playful_flirt", "emotional_connection"],
          "description": "시나리오 장르"
        },
        "sexy_level": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "섹시/야한 정도 (1=순수 10=야함)"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "시나리오 태그 (검색용)",
          "example": ["술", "고백", "메신저", "밤"]
        },
        "estimated_duration": {
          "type": "string",
          "description": "예상 플레이 시간",
          "example": "5-10분"
        }
      }
    },

    "choice_template": {
      "type": "object",
      "required": ["text_template", "affection_range", "tone"],
      "properties": {
        "text_template": {
          "type": "string",
          "description": "선택지 텍스트 (변수 치환 가능)",
          "example": "${char_name}에게 다가간다"
        },
        "affection_range": {
          "type": "string",
          "enum": ["negative", "neutral", "low", "medium", "high", "critical"],
          "description": "호감도 범위 (negative: -5~-1, neutral: 0, low: 1-3, medium: 4-6, high: 7-10, critical: 11-15)"
        },
        "tone": {
          "type": "string",
          "enum": ["caring", "playful", "passionate", "respectful", "bold", "gentle"],
          "description": "선택지 톤"
        },
        "next_beat_hint": {
          "type": "string",
          "description": "다음 Beat으로의 전환 힌트 (선택사항)",
          "example": "confession_response"
        }
      }
    },

    "beat_template": {
      "type": "object",
      "required": ["beat_number", "beat_type", "template"],
      "properties": {
        "beat_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Beat 번호 (Act 내에서 순차적)"
        },
        "beat_type": {
          "type": "string",
          "enum": ["introduction", "flirtation", "confession", "response", "escalation", "resolution"],
          "description": "Beat 유형"
        },
        "template": {
          "type": "object",
          "required": ["npc_dialogue_template", "narration_template", "choice_templates"],
          "properties": {
            "npc_dialogue_template": {
              "type": "string",
              "description": "NPC(캐릭터) 대사 템플릿 - 변수 치환됨",
              "example": "${char_name}: 오빠... 어제 술 마시고 한 말 기억나? 😳"
            },
            "narration_template": {
              "type": "string",
              "description": "상황 설명 텍스트 템플릿",
              "example": "${char_name}(이)가 부끄러워하며 메시지를 보낸다."
            },
            "choice_templates": {
              "type": "array",
              "minItems": 2,
              "maxItems": 4,
              "items": {
                "$ref": "#/definitions/choice_template"
              },
              "description": "선택지 템플릿 목록 (최소 2개, 최대 4개)"
            },
            "emotion_hint": {
              "type": "string",
              "description": "캐릭터 감정 힌트 (선택사항)",
              "example": "부끄러움, 설렘"
            }
          }
        }
      }
    },

    "act": {
      "type": "object",
      "required": ["act_number", "beats"],
      "properties": {
        "act_number": {
          "type": "integer",
          "minimum": 1,
          "description": "Act 번호 (순차적)"
        },
        "act_title": {
          "type": "string",
          "description": "Act 제목 (선택사항)",
          "example": "어색한 아침 인사"
        },
        "beats": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/beat_template"
          },
          "description": "Beat 목록"
        }
      }
    },

    "compatibility": {
      "type": "object",
      "required": ["mbti_best_fit"],
      "properties": {
        "mbti_best_fit": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["INFP", "ENFP", "INTJ", "ENTJ", "INFJ", "ENFJ", "INTP", "ENTP", "ISFP", "ESFP", "ISTP", "ESTP", "ISFJ", "ESFJ", "ISTJ", "ESTJ"]
          },
          "description": "최적 MBTI 타입 목록"
        },
        "personality_requirements": {
          "type": "object",
          "properties": {
            "min_sexual_comfort": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "최소 성적 편안함 (character.appeal_profile.sexual_comfort)"
            },
            "min_confidence": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "최소 자신감 (character.appeal_profile.confidence_level)"
            },
            "required_hobbies": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "필수 취미 (선택사항)"
            }
          }
        }
      }
    }
  },

  "type": "object",
  "required": ["id", "metadata", "structure", "compatibility"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z0-9_]+$",
      "description": "시나리오 고유 ID (소문자, 숫자, 언더스코어만)",
      "example": "late_night_confession_v1"
    },
    "metadata": {
      "$ref": "#/definitions/metadata"
    },
    "structure": {
      "type": "object",
      "required": ["acts"],
      "properties": {
        "acts": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/act"
          },
          "description": "Act 목록 (최소 1개)"
        }
      }
    },
    "compatibility": {
      "$ref": "#/definitions/compatibility"
    },
    "variables": {
      "type": "object",
      "description": "사용 가능한 템플릿 변수 목록 (문서용)",
      "example": {
        "${char_name}": "character.basic_info.name",
        "${char_age}": "character.basic_info.age",
        "${char_mbti}": "character.basic_info.mbti",
        "${char_style}": "character.physical_allure.appearance.style",
        "${char_hobby}": "character.appeal_profile.hobbies[0]",
        "${user_name}": "gameState.userName",
        "${affection}": "gameState.affection",
        "${time_of_day}": "context.timeOfDay"
      }
    }
  },

  "examples": [
    {
      "id": "late_night_confession_v1",
      "metadata": {
        "title": "늦은 밤의 고백",
        "genre": "sensual_romance",
        "sexy_level": 6,
        "tags": ["술", "고백", "메신저", "밤"],
        "estimated_duration": "5-7분"
      },
      "structure": {
        "acts": [
          {
            "act_number": 1,
            "act_title": "어색한 아침 인사",
            "beats": [
              {
                "beat_number": 1,
                "beat_type": "introduction",
                "template": {
                  "npc_dialogue_template": "${char_name}: 오빠... 어제 술 마시고 한 말 기억나? 😳",
                  "narration_template": "${char_name}(이)가 부끄러워하며 메시지를 보낸다.",
                  "choice_templates": [
                    {
                      "text_template": "기억 안 난다고 솔직하게 말한다",
                      "affection_range": "neutral",
                      "tone": "respectful"
                    },
                    {
                      "text_template": "\"무슨 말 했는데?\" 장난스럽게 묻는다",
                      "affection_range": "low",
                      "tone": "playful"
                    },
                    {
                      "text_template": "\"다 기억해... 너도 진심이었어?\" 조심스럽게 묻는다",
                      "affection_range": "high",
                      "tone": "caring"
                    }
                  ],
                  "emotion_hint": "부끄러움, 설렘"
                }
              }
            ]
          }
        ]
      },
      "compatibility": {
        "mbti_best_fit": ["INFP", "ENFP", "ISFJ"],
        "personality_requirements": {
          "min_sexual_comfort": 5,
          "min_confidence": 3
        }
      }
    }
  ]
}
